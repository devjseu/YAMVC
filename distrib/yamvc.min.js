/*! yamvc v0.2.0 - 2014-03-14 
 *  License:  */
(function(){"use strict";function e(){for(var e=0,t=i.length;t>e;e++)i[e]()}var t,n=window.ya||{},r="app",i=[];n.$onReady=function(n){i.push(n),t||"complete"===document.readyState||(t=setInterval(function(){"complete"===document.readyState&&(clearInterval(t),e())},10))},n.$merge=function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},n.$clone=function(e){return JSON.parse(JSON.stringify(e))},n.$set=function(){for(var e,t=3>arguments.length?r:arguments[0],n=3>arguments.length?arguments[0].split("."):arguments[1].split("."),i=3>arguments.length?arguments[1]:arguments[2],a=window[t]=window[t]||{};n.length;)e=n.shift(),0===n.length?a[e]=i:a=a[e]=a[e]||{};return this},n.$get=function(){var e,t=2>arguments.length?r:arguments[0],n=2>arguments.length?arguments[0]:arguments[1],i=n?n.search(/\./)>0?n.split("."):[n]:[],a=null;for(i.length&&(a=window[t]=window[t]||{});i.length;)if(e=i.shift(),a[e])a=a[e];else{if(!(e in window)){a=null;break}a=window[e]}return a},n.$factory=function(e){var t,i,a;if(!e.alias)throw n.Error.$create("Factory method needs alias property","YA1");return t=n.$get(e.module||r,e.alias),a=e.methods||{},a.config=e,delete e.alias,delete e.module,delete e.methods,i=t.$create(a)},n.$module=function(){var e=arguments.length?arguments[0]:null;return e&&(r=e),r},window.ya=n})(),ya.$set("ya","mixins.Array",{find:function(e,t){var n,r=e.length,i=arguments.length,a=i>2?arguments[2]:null;if(i>1)for(;r--&&(n=e[r],n[t]!==a););else for(;r--&&(n=e[r],n!==t););return r},findAll:function(e,t){for(var n,r=e.length,i=arguments.length,a=i>2?arguments[2]:null,s=[];r--;)n=e[r],i>1?n[t]===a&&s.push(r):n===t&&s.push(r);return s},findAllByFn:function(e,t){for(var n=e.length,r=[];n--;)t(e[n])&&r.push(n);return r},each:Array.prototype.forEach?function(e,t){Array.prototype.forEach.call(e,t)}:function(e,t){if(void 0===e||null===e)throw new TypeError;var n=Object(e),r=n.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=0;r>i;i++)i in n&&t.call(e,n[i],i,n)},some:Array.prototype.some?function(e,t){Array.prototype.some.call(e,t)}:function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1}}),ya.$set("ya","mixins.CoreStatic",{$extend:function(e){e=e||{};var t,n,r=this,i=this.prototype,a=ya.$merge(r.__defaults__||{},e.defaults),s=(r.__mixins__||[]).concat(e.mixins||[]),o=e.static||{},u=/xyz/.test(function(){})?/\b__super\b/:/.*/,l=function(e,t){return function(){var n=this.__super;this.__super=i[e];var r=t.apply(this,arguments);return this.__super=n,r}},c={}.hasOwnProperty;return t=function(){var e;this._config={};for(e in a)c.call(a,e)&&(this._config[e]=a[e]);ya.Core.apply(this,arguments)},n=function(t,n){function r(){this.constructor=t}for(var f in n)c.call(n,f)&&(t[f]=n[f]);r.prototype=n.prototype,t.prototype=new r,t.prototype.__class__=(e.module||ya.$module())+"."+e.alias;for(var d in ya.mixins.CoreStatic)ya.mixins.CoreStatic.hasOwnProperty(d)&&(t[d]=ya.mixins.CoreStatic[d]);for(var h in e)t.prototype[h]="function"==typeof e[h]&&"function"==typeof i[h]&&u.test(e[h])?l(h,e[h]):e[h];for(t.__mixins__=s.slice(),t.__defaults__=a;s.length;){var p=s.pop();t.$mixin(p)}for(var g in o)c.call(o,g)&&(t["$"+g]=o[g]);return t},n(t,r),e.alias&&ya.$set(e.module||ya.$module(),e.alias,e.singleton?new t:t),t},$create:function(){var e=this,t=Array.prototype.concat.apply([e],arguments);return new(Function.prototype.bind.apply(e,t))},$mixin:function(e,t){var n,r;t?n="function"==typeof e?e.prototype:e:(t="function"==typeof e?e.prototype:e,n=this.prototype);for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r])}}),function(){"use strict";function e(e){for(var t={},n=e.split(","),r=0;n.length>r;r++)t[n[r]]=!0;return t}var t;t=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),ya.$set("ya","mixins.CSSStyle",{isFillAttr:function(e){return t[e]!==undefined},get:function(){}})}(),ya.$set("ya","mixins.DOM",{isQueryMatch:function(e,t){var n,r,i,a=!0;if(t=this._el||t,-1===e.search(" ")){if(n=e.match(/^[^\.#]+/gi),r=e.match(/#[^\.#]+/gi),i=e.match(/\.[^\.#]+/gi),n&&t.nodeName.toLowerCase()!==n.pop()&&(a=!1),i)for(;i.length;)if(!t.classList.contains(i.pop().substring(1))){a=!1;break}r&&t.getAttribute("id")!==r.pop().substring(1)&&(a=!1)}else a=!1;return a},isElement:function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},removeChildren:function(e){for(var t=document.createDocumentFragment();e.hasChildNodes();)t.appendChild(e.removeChild(e.firstChild));return t},toString:function(e){var t,n=function(e){var t;if("undefined"!=typeof XMLSerializer){var n=new XMLSerializer;t=n.serializeToString(e)}else e.xml&&(t=e.xml);return t},r=0,i="";if(e instanceof DocumentFragment)for(e=e.firstChild;e;)i+=n(e),e=e.nextSibling;else if(e instanceof NodeList)for(t=e.length;t>r;)i+=n(e);else e instanceof HTMLElement&&(i=n(e));return i}}),ya.$set("ya","mixins.GetSet",{set:function(e,t){var n="_"+e,r=this[n];return t!==r&&(this[n]=t,this.fireEvent(e+"Change",this,t,r)),this},get:function(e){return this["_"+e]}}),ya.$set("ya","mixins.Observable",{init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(){if(this._suspendEvents)return!0;var e,t=!0,n=Array.prototype.shift,r=n.call(arguments);e=n.call(arguments);for(var i=0,a=this._listeners[r]||[],s=a.length;s>i;i++)t&&(t=a[i].apply(e,arguments),t=t===void 0?!0:t);return t},addEventListener:function(e,t){var n=this._listeners[e]||[];return n.push(t),this._listeners[e]=n,this},removeEventListener:function(e,t){var n,r=this._listeners[e]||[];if(r)if(t){if("function"==typeof t)for(var i=0,a=r.length;a>i;i++)r[i]===t&&(n=i);else n=t;r.splice(n,1)}else this._listeners[e]=[];return this},suspendEvents:function(){return this.set("suspendEvents",!0),this},resumeEvents:function(){return this.set("suspendEvents",!1),this}}),ya.$set("ya","Core",function(){"use strict";function e(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}var t=window.ya;e.prototype.init=function(){},e.prototype.initDefaults=function(){},e.prototype.initRequired=function(){},e.prototype.initConfig=function(e){var n,r,i,a,s=this,o=function(e){n="get"+e.charAt(0).toUpperCase()+e.slice(1),r="set"+e.charAt(0).toUpperCase()+e.slice(1),s[n]=function(){return s.get("config")[e]},s[r]=function(t){var n=s.get("config")[e];t!==n&&(s.get("config")[e]=t,s.fireEvent(e+"Change",this,t,n))}};e=e||{},i=t.$merge(s._config,e.config),s.set("initOpts",e),s.set("config",i);for(a in i)i.hasOwnProperty(a)&&o(a);return s},e.prototype.bindMethods=function(e){var t=this;for(var n in e)e.hasOwnProperty(n)&&"function"==typeof e[n]&&(t[n]=e[n].bind(t),delete e[n]);return t},e.prototype.onChange=function(e,t){var n=this;return n.addEventListener(e+"Change",t),n},e.prototype.unbindOnChange=function(e,t){for(var n=this,r=n._listeners[e+"Change"]||[],i=0,a=r.length;a>i;i++)r[i]===t&&r.splice(i,1);return this._listeners[e+"Change"]=r,n},e.__mixins__=[],e.__defaults__={};for(var n in t.mixins.CoreStatic)t.mixins.CoreStatic.hasOwnProperty(n)&&(e[n]=t.mixins.CoreStatic[n]);return e.$mixin(t.mixins.GetSet),e.$mixin(t.mixins.Observable),e}()),ya.Core.$extend({module:"ya",alias:"Error",defaults:{id:null,message:null,stack:null},init:function(){var e=this;e.initConfig(arguments).initDefaults()},initConfig:function(e){var t=this;return t.__super({config:{message:e[0],id:e[1]}}),t},initDefaults:function(){var e=this;return e.setStack(Error(e.getMessage()).stack),e},toString:function(){var e=this;return"ya.Error("+e.getId()+"): "+e.getMessage()}}),ya.Core.$extend({module:"ya",alias:"Manager",defaults:{items:null},mixins:[ya.mixins.Array],init:function(e){var t=this;t.initConfig(e).initDefaults()},initDefaults:function(){var e=this;return e.setItems([]),e},getItem:function(e){var t,n=this,r=n.getItems();return t=n.find(r,"id",e),t>-1?r[t].item:null},getCount:function(){return this.getItems().length},register:function(e,t){var n=this;if(n.isRegistered(e))throw ya.Error.$create(this.__class__+": ID "+e+" already registered.","YVTM1");return n.getItems().push({id:e,item:t}),n.fireEvent("registered",t),n},deregister:function(e){var t,n=this,r=n.getItems();return t=n.find(r,"id",e),t>-1&&n.fireEvent("unregistered",r.slice(t,1)),n},isRegistered:function(e){return this.find(this.getItems(),"id",e)>-1?!0:!1}}),ya.Core.$extend({module:"ya",alias:"Collection",defaults:{id:null,namespace:null,model:null,proxy:null},init:function(e){var t=this;return t.__super(e),t.initConfig(e).initDefaults().initData(),ya.collection.$Manager.register(t.getId(),t),t},initDefaults:function(){var e=this;return e.setId(e.getId()||"collection-"+ya.collection.$Manager.getCount()),e.setModel(e.getModel()||ya.$get("ya.Model")),e.set("set",[]),e.set("cache",[]),e.set("removed",[]),e.set("filters",[]),e.set("raw",e.getData()||[]),e},initData:function(){var e=this;return e.prepareData(e._raw),e},each:function(e){var t,n,r=this,i=r._set;if(t=Object(i),n=t.length>>>0,"function"!=typeof e)throw ya.Error.$create("forEach argument should be a function","COL1");for(var a=0;n>a;a++)a in t&&e.call(r,t[a],a,t);return r},push:function(e){var t,n=this,r=n.getModel(),i=n.getNamespace();for(Array.isArray(e)||(e=[e]);e.length;){if(t=e.pop(),t instanceof r||(t=new r({config:{namespace:i,data:t}})),t.getNamespace()!==n.getNamespace())throw ya.Error.$create("Model should have same namespace as collection","COL2");n._cache.push(t),n.fireEvent("pushed",n,t)}return n.filter(),n},count:function(){return this._set.length},clear:function(){var e=this;return e.set("set",[]),e.set("cache",[]),e.set("removed",[]),e},clearFilters:function(){var e=this;return e.set("filters",[]),e.filter(),e},clearFilter:function(e){var t,n,r=this,i=r._filters;for(t=i.length;t--;)if(n=i[t],"function"!=typeof n&&n.id===e){i.splice(t,1);break}return r.filter(),r},filter:function(e){var t,n=this,r=n._filters,i=!0,a=[],s=n._cache,o=0,u=null;arguments.length>1&&(u=arguments[0],e=arguments[1]),"function"==typeof e&&(u?r.push({id:u,fn:e}):r.push(e),n.fireEvent("beforeFilter",n,r));for(var l=0,c=s.length;c>l;l++){for(i=!0,o=r.length;o--;)t="function"==typeof r[o]?r[o]:r[o].fn,i=i&&t(s[l]);i&&a.push(s[l])}return n.set("set",a),n.fireEvent("afterFilter",n,r),n},getAt:function(e){return this._set[e]},getBy:function(e){for(var t=this,n=t._set,r=[],i=0,a=n.length;a>i;i++)e(n[i])&&r.push(n[i]);return r},findOneBy:function(e){for(var t=this,n=t._set,r=n.length;r--&&!e(n[r]););return r},getOneBy:function(e){for(var t,n=this,r=n._set,i=r.length;i--;)if(e(r[i])){t=r[i];break}return t},getTotal:function(){return this._total},load:function(e){var t,n,r=this,i=(r.get("data"),r.get("idProperty"),ya.$Promise.deferred()),a=r.getNamespace(),s=ya.data.Action.$create(),o=0;for(n in e)o++;if(0===o)throw ya.Error.$create("You need to pass at least one condition to load model collection","COLLECTION2");if(!r.getProxy())throw ya.Error.$create("To load collection you need to set proxy","COLLECTION3");return t=function(){"success"===r.getProxy().getStatus()?r.fireEvent("loaded",r,s.getResponse(),"read"):r.fireEvent("error",r,"read")},s.setOptions({callback:t,params:e,namespace:a}),r.getProxy().read(s),i.promise},save:function(){for(var e,t,n,r,i=this,a=ya.$Promise.deferred(),s=[],o=[],u=i._removed,l=i._cache,c=i.getNamespace(),f=i.getProxy(),d=0,h=[],p=0,g=l.length;g>p;p++)n=l[p],n._isDirty&&(n.hasId()?o.push(n._data):(n._data.__clientId__=n.get("clientId"),s.push(n._data)));return r=function(e){return function(t){return e.__clientId__?t.data("__clientId__")===e.__clientId__:t.data("id")===e.id}},t=function(e,t){if(d--,t.getStatus()===ya.data.Action.$status.SUCCESS){var s,o=t.getResponse(),u=o.result;if(n=u[0],s=u.length,n&&(n.__clientId__||n.id))for(;s--;)n=i.getOneBy(r(u[s])),n.setDirty(!1),delete n._data.__clientId__;else i.set("removed",[])}else h.push(t.getResponse().error);0===d&&(h.length?(i.fireEvent("error",i,h),a.reject({errors:h})):(i.fireEvent("success",i),a.resolve({scope:i})))},s.length&&(d++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(s),f.create(e)),o.length&&(d++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(o),f.update(e)),u.length&&(d++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(u),f.destroy(e)),a.promise},prepareData:function(e,t){var n=this,r=n.getModel(),i={namespace:n.getNamespace()},a=e.length,s=[];t=t||a;for(var o=0;a>o;o++)i.data=e[o],s.push(new r({config:i}));return n.set("cache",s),n.set("total",t),n.filter(),n},setData:function(){var e=this;return e.setRawData(data),e.prepareData(data),e},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(e){return this.set("raw",e),this},isDirty:function(){for(var e=this._cache,t=e.length,n=!1;t--;)e[t]._isDirty&&(n=!0);return this._remove&&(n=!0),n}}),ya.Manager.$extend({module:"ya",alias:"collection.$Manager",singleton:!0}),ya.Core.$extend({module:"ya",alias:"Controller",defaults:{routes:null,events:null},"static":{router:null,getRouter:function(){return ya.Controller.$router=ya.Controller.$router||new ya.Router,ya.Controller.$router}},init:function(e){var t=this;return t.__super(e),t.initConfig(e).initDefaults().initEvents().initRoutes(),ya.$onReady(function(){t.restoreRouter()}),t},initDefaults:function(){var e=this;return e.set("router",ya.Controller.$getRouter()),e.set("dispatcher",ya.event.$dispatcher),e},initEvents:function(){var e,t,n,r,i=this,a=i.getEvents(),s=[],o=RegExp("\\$([^\\s]+)"),u=i._dispatcher;if(a){for(var l in a)if(a.hasOwnProperty(l)){if(r={},r[l]=a[l],u.add(i,r),e=l.match(o),!e)throw ya.Error.$create("Event query should begin from id of the view (current query: "+l+")","CONTROLLER1");0>s.indexOf(e[1])&&s.push(e[1])}for(n=s.length;n--;)t=ya.view.$Manager.getItem(s[n]),t&&(t.isInDOM()?i.resolveEvents(t):t.addEventListener("render",i.resolveEvents.bind(i)))}return i},initRoutes:function(){var e=this,t=e.getRoutes(),n=e._router;if(t)for(var r in t)if(t.hasOwnProperty(r)){var i=e[t[r]].bind(e);n.when(r,i)}return e},resolveEvents:function(e){var t,n,r,i,a,s=this.getEvents(),o=function(e,t,n){return e.bind(t,n)},u=RegExp("\\$([^\\s]+)");for(var l in s)if(s.hasOwnProperty(l)&&(t=l.match(u),t&&t[1]===e.getId())){n=s[l],i=l.split(" ").slice(1),r=i.length?e.get("el").querySelectorAll(i.join(" ")):[e.get("el")];for(var c=0,f=r.length;f>c;c++)for(var d in n)n.hasOwnProperty(d)&&(a=o(n[d],this,e),r[c].addEventListener(d,a))}},getRouter:function(){return router},restoreRouter:function(){var e=this;return e.getRouter().restore(),e},redirectTo:function(e){return window.location.hash=e,this}}),ya.Core.$extend({module:"ya",alias:"data.Action","static":{status:{PENDING:0,SUCCESS:1,FAIL:2}},init:function(e){var t=this;t.initConfig(e).initDefaults()},initDefaults:function(){var e=this;return e.set("response",{}),e.set("status",ya.data.Action.$status.PENDING),e},setData:function(e){return this.set("data",e),this},getData:function(){return this._data},setOptions:function(e){return this.set("options",e),this},getOptions:function(){return this._options},getOption:function(e){return this._options[e]},setResponse:function(e){return this.set("response",e)},getResponse:function(){return this.get("response")},setStatus:function(e){var t,n=ya.data.Action.$status,r=!1;for(t in n)n.hasOwnProperty(t)&&n[t]===e&&(r=!0);if(!r)throw ya.Error.$create("ya.data.Action: Wrong status","ACTION1");return this.set("status",e)},getStatus:function(){return this.get("status")}}),ya.Core.$extend({module:"ya",alias:"data.Proxy",init:function(e){var t,n=this;e=e||{},n.__super(e),t=ya.$merge(n._config,e.config),n.set("initOpts",e),n.set("config",t),n.initConfig()},read:function(e){var t,n,r=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: read argument action should be instance of ya.data.Action");if(t=e.getOptions(),n=t.params&&t.params.id,!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");return n===void 0?r.readBy(e):r.readById(e),r},create:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: create argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("ya.data.Proxy: Data should be object");return t},update:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: update argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("ya.data.Proxy: Data should be object");return t},destroy:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: destroy argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("Data should be pass as object");return t}}),ya.data.Proxy.$extend({module:"ya",alias:"data.proxy.Localstorage","static":{clear:function(e){var t,n=0;if(e)for(Array.isArray(e)||(e=[e]),n=e.length;n--;)t=e[n],delete localStorage[t],delete localStorage[t+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},readBy:function(e){var t,n,r,i,a,s,o,u=this,l=e.getOptions(),c=l.namespace,f=l.callback,d=l.limit||null,h=l.offset||0,p=l.filters||[],g=l.sorters||[],y={},v=[],m=[],w=!0,_=0;return a=function(e,t){var n=""+e[r],i=""+t[r],a=n.toLowerCase(),o=i.toLowerCase();return(a>o?1:o>a?-1:n>i?1:i>n?-1:0)*("desc"===s.toLowerCase()?-1:1)},t=function(){if(localStorage[c]){m=JSON.parse(localStorage[c]);for(var t=0,l=m.length;l>t;t++){for(w=!0,o=p.length;o--;)n=p[o].length>3?p[o][0]:"&&","&&"===n?w=u.executeCondition(m[t],p[o])&&w:"||"===n&&(w=u.executeCondition(m[t],p[o])||w);w&&v.push(m[t])}for(m=v,_=v.length,o=g.length;o--;)i=g[o],r=i[0],s=i[1]||"ASC",m.sort(a);d||(d=m.length-h),(h>0||d)&&(m=m.splice(h,d))}y.total=_,y.result=m,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(y),f(u,e)},setTimeout(function(){try{t()}catch(n){y.error=n,f(u,e)}},0),u},readById:function(e){var t,n=this,r=e.getOptions(),i=r.params,a=r.namespace,s=r.callback,o=i.id,u=[],l={},c={};return t=function(){if(localStorage[a]){u=JSON.parse(localStorage[a]);for(var t=0,r=u.length;r>t;t++)u[t].id===o&&(l=u[t]);if(l.id!==void 0)return c.total=1,c.result=l,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(c),s(n,e),n}n.setStatus(ya.data.Action.$status.FAIL),c.error=ya.Error.$create("Not found"),s(n,e)},setTimeout(t,0),n},create:function(e){var t,n,r=this,i=e.getData(),a=e.getOption("namespace"),s=e.getOption("callback"),o=[],u=1,l={};if(r.__super.apply(this,arguments),localStorage[a]&&(o=JSON.parse(localStorage[a]),u=localStorage[a+"$Sequence"]),Array.isArray(i)){t=[];for(var c=0,f=i.length;f>c;c++)i[c].id=u++,delete i[c].__clientId__,o.push(i[c]),t.push(i[c])}else i.id=u++,delete i.__clientId__,o.push(i),t=i;return n=function(){try{localStorage[a]=JSON.stringify(o),localStorage[a+"$Sequence"]=u,l.result=t,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(l)}catch(n){l.error=n,e.setStatus(ya.data.Action.$status.FAIL).setResponse(l)}s(r,e)},setTimeout(n,0),r},update:function(e){var t,n,r,i,a,s=this,o=e.getData(),u=e.getOption("namespace"),l=e.getOption("callback"),c=[],f={};return a=function(){if(localStorage[u]){if(c=JSON.parse(localStorage[u]),Array.isArray(o))for(t=[],r=o.length;r--;)for(i=c.length,n=o[r].id;i--;)c[i].id===n&&(c[i]=o[r],t.splice(0,0,o[r]));else for(r=c.length,n=o.id;r--;)c[r].id===n&&(t=c[r]=o);try{localStorage[u]=JSON.stringify(c),f.success=!0,f.result=t,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(f)}catch(a){f.success=!1,f.error=a,e.setStatus(ya.data.Action.$status.FAIL).setResponse(f)}return l(s,e),s}f.success=!1,f.error=ya.Error.$create("Not found"),e.setStatus(ya.data.Action.$status.FAIL).setResponse(f),l(s,e)},setTimeout(a,0),s},destroy:function(e){var t,n,r,i,a=this,s=e.getData(),o=e.getOption("namespace"),u=e.getOption("callback"),l=[],c={};return i=function(){if(localStorage[o]){if(l=JSON.parse(localStorage[o]),Array.isArray(s))for(n=s.length;n--;)for(r=l.length,t=s[n].id;r--;)l[r].id===t&&l.splice(r,1);else for(n=l.length,t=s.id;n--;)l[n].id===t&&l.splice(n,1);try{localStorage[o]=JSON.stringify(l),c.success=!0,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(c)}catch(i){c.success=!1,c.error=i,e.setStatus(ya.data.Action.$status.FAIL).setResponse(c)}return u(a,e),a}c.success=!1,c.error=ya.Error.$create("Not found"),e.setStatus(ya.data.Action.$status.FAIL).setResponse(c),u(a,e)},setTimeout(i,0),a},executeCondition:function(e,t){var n,r,i,a,s=!1;switch(t.length>3?(r=t[1],n=t[2],i=t[3]):(r=t[0],n=t[1],i=t[2]),n){case">":e[r]>i&&(s=!0);break;case"<":i>e[r]&&(s=!0);break;case">=":e[r]>=i&&(s=!0);break;case"<=":i>=e[r]&&(s=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),a=RegExp(i),a.test(e[r])&&(s=!0)}return s}}),ya.Core.$extend({module:"ya",singleton:!0,alias:"event.$dispatcher",defaults:{delegates:null},init:function(e){var t=this;return t.__super(),t.initConfig(e).initDefaults(),t},initDefaults:function(){var e=this;return e.setDelegates([]),e},add:function(e,t){var n=this,r=Object.keys(t).pop();return n.getDelegates().push({selector:r,scope:e,events:t[r]}),n},apply:function(e){for(var t,n,r,i,a=this,s=a.getDelegates(),o=[],u=e,l=[],c=function(e){return e.selector.search(r)>=0},f=ya.mixins.DOM.isQueryMatch,d=ya.mixins.Array.findAllByFn,h=ya.mixins.Array.each;e;)r=RegExp("^\\$"+e.getId()+"[\\s]"),o=d(s,c),o.length&&h(o,function(r){l.length=0,n=s[r],t=n.selector.split(" "),t.shift(),t.length&&(l=u.querySelectorAll(t.pop()),i=t.slice(),h(l,function(t){if(i.length)for(var r=t,s=i.pop();e.getId()!==r.getAttribute("id");){if(f(s,r)){if(0===i.length){a.assignEvents(t,n,e);break}s=i.pop()}r=r.parentNode}else a.assignEvents(t,n,e)}))}),e=e.getParent()},assignEvents:function(e,t,n){var r,i=t.events;for(r in i)i.hasOwnProperty(r)&&e.addEventListener(r,i[r].bind(t.scope,n),!1)},clear:function(){return this.getDelegates().length=0,this}}),ya.Core.$extend({module:"ya",alias:"Job","static":{id:0},defaults:{id:null,delay:0,tasks:null,repeat:1,spawn:!1},init:function(e){var t=this;return t.initConfig(e).initRequired().initDefaults(),t},initRequired:function(){var e=this;if(!e.getTasks()&&!e._config.task)throw ya.Error.$create("At least one task should be defined","YJ1");return e},initDefaults:function(){var e=this,t=e._config,n=t.tasks||[],r=t.task;return r&&n.push(r),e.setId(ya.Job.$id++),e.setTasks(n),e},doit:function(){var e,t,n=this,r=ya.$Promise.deferred();return e=n.getRepeat()>1||"infinity"===n.getRepeat()?{run:function(e,t){n.set("clear",setInterval(e,t))},clear:function(e){return clearInterval(n._clear),e||r.reject({id:"YJ2",message:"Task terminated"}),n}}:{run:function(e,t){n.set("clear",setTimeout(e,t))},clear:function(e){return clearTimeout(n._clear),e||r.reject({id:"YJ2",message:"Task terminated"}),n}},n.set("engine",e),t=function(){var t,i=n.getRepeat(),a=n.getTasks(),s=0;if("infinity"!==i&&(n.setRepeat(--i),0>i))return e.clear(!0),r.resolve({success:!0,message:"Task finished"});for(t=a.length;t>s;)a[s](),s++},e.run(t,n.getDelay()),r.promise},terminate:function(){return this._engine.clear()}}),ya.Core.$extend({module:"ya",alias:"Model","static":{id:0,idGenerator:function(){return ya.Model.$id++}},defaults:{idProperty:"id",proxy:null,namespace:null,data:null},init:function(e){var t=this;t.__super(),t.initConfig(e).initRequired().initDefaults()},initRequired:function(){var e=this;if(!e.getNamespace())throw ya.Error.$create("Model need to have namespace");return e},initDefaults:function(){var e=this;return e.set("isDirty",!0),e.set("clientId",e.getNamespace()+"-"+ya.Model.$idGenerator()),e.set("data",e.getData()||{}),e},setDataProperty:function(e,t){var n=this,r=n._data,i=r[e];t!==i&&(r[e]=t,n.set("isDirty",!0),n.fireEvent("data"+e.charAt(0).toUpperCase()+e.slice(1)+"Change",n,t,i))},getDataProperty:function(e){return this.get("data")[e]},data:function(e){var t,n=this,r=arguments.length;if(r>1)this.setDataProperty.apply(this,arguments);else{if("object"!=typeof e)return this.getDataProperty.apply(this,arguments);for(t in e)e.hasOwnProperty(t)&&n.setDataProperty(t,e[t])}return n},clear:function(){var e,t=this,n=t.get("data");for(e in n)n.hasOwnProperty(e)&&t.data(e,null);t.set("data",{}),t.fireEvent("dataChange",t,n)},load:function(e){var t,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.$Promise.deferred(),s=new ya.data.Action,o={};if(e[i]===void 0&&r[i]===void 0)throw ya.Error.$create("You need to pass id to load model");return e[i]=r[i],o.namespace=n.getNamespace(),o.params=e,o.callback=function(){t=n.getProxy().getResponse(),"success"===n.getProxy().getStatus()?(n.set("isDirty",!1),n.set("data",t),a.resolve({scope:n,response:t,action:"read"}),n.fireEvent("loaded",n,t,"read")):(a.reject({scope:n,response:t,action:"read"}),n.fireEvent("error",n,t,"read"))},s.setOptions(o),n.getProxy().read(s),a.promise},save:function(){var e,t,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.$Promise.deferred(),s=new ya.data.Action,o=n.getProxy(),u={};return n.get("isProcessing")||!n.get("isDirty")?!1:(n.set("isProcessing",!0),u.namespace=n.getNamespace(),u.callback=function(r,i){e=i.getResponse(),n.set("isProcessing",!1),i.getStatus()===ya.data.Action.$status.SUCCESS?(n.set("isDirty",!1),n.set("data",e.result),a.resolve({scope:n,action:i,type:t}),n.fireEvent("saved",n,i,t)):(a.reject({scope:n,action:i,type:t}),n.fireEvent("error",n,i,t))},s.setOptions(u).setData(r),r[i]===void 0?(t="create",o.create(s)):(t="update",o.update(s)),a.promise)},remove:function(){var e,t=this,n=t.get("data"),r=t.getIdProperty(),i=ya.$Promise.deferred(),a=new ya.data.Action,s=t.getProxy(),o={};if(n[r]===void 0)throw ya.Error.$create("Can not remove empty model");return o.namespace=t.getNamespace(),o.callback=function(n,r){e=r.getResponse(),r.getStatus()===ya.data.Action.$status.SUCCESS?(t.set("isDirty",!1),t.set("data",{}),i.resolve({scope:t,action:r,type:"remove"}),t.fireEvent("removed",t,"remove")):(i.reject({scope:t,action:r,type:"remove"}),t.fireEvent("error",t,"remove"))},a.setOptions(o).setData(n),s.destroy(a),s.destroy(a),i.promise},hasId:function(){return!!this._data[this._config.idProperty]},setDirty:function(e){return this.set("isDirty",!!e),this},isDirty:function(){return this._isDirty}}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),"document"in self&&!("classList"in document.createElement("_"))&&function(e){"use strict";if("Element"in e){var t="classList",n="prototype",r=e.Element[n],i=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},o=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},u=function(e,t){if(""===t)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},l=function(e){for(var t=a.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",""+this)}},c=l[n]=[],f=function(){return new l(this)};if(o[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",-1!==u(this,e)},c.add=function(){var e,t=arguments,n=0,r=t.length,i=!1;do e=t[n]+"",-1===u(this,e)&&(this.push(e),i=!0);while(r>++n);i&&this._updateClassName()},c.remove=function(){var e,t=arguments,n=0,r=t.length,i=!1;do{e=t[n]+"";var a=u(this,e);-1!==a&&(this.splice(a,1),i=!0)}while(r>++n);i&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),!n},c.toString=function(){return this.join(" ")},i.defineProperty){var d={get:f,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,d)}catch(h){-2146823252===h.number&&(d.enumerable=!1,i.defineProperty(r,t,d))}}else i[n].__defineGetter__&&r.__defineGetter__(t,f)}}(self),ya.$set("ya","$Promise",function(e){"use strict";function t(t){function n(e){return e}function r(e){return l(e)}function s(e){var t=o(),n=0,r=isArray(e)?[]:{};return a(e,function(e,i){n++,u(e).then(function(e){r.hasOwnProperty(i)||(r[i]=e,--n||t.resolve(r))},function(e){r.hasOwnProperty(i)||t.reject(e)})}),0===n&&t.resolve(r),t.promise}var o=function(){var a,s,l=[];return s={resolve:function(t){if(l){var n=l;l=e,a=u(t),n.length&&setTimeout(function(){for(var e,t=0,r=n.length;r>t;t++)e=n[t],a.then(e[0],e[1],e[2])},0)}},reject:function(e){s.resolve(c(e))},notify:function(e){if(l){var t=l;l.length&&setTimeout(function(){for(var n,r=0,i=t.length;i>r;r++)n=t[r],n[2](e)},0)}},promise:{then:function(e,s,u){var c=o(),f=function(r){try{c.resolve((i(e)?e:n)(r))}catch(a){c.reject(a),t(a)}},d=function(e){try{c.resolve((i(s)?s:r)(e))}catch(n){c.reject(n),t(n)}},h=function(e){try{c.notify((i(u)?u:n)(e))}catch(r){t(r)}};return l?l.push([f,d,h]):a.then(f,d,h),c.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=o();return t?n.resolve(e):n.reject(e),n.promise}function r(r,a){var s=null;try{s=(e||n)()}catch(o){return t(o,!1)}return s&&i(s.then)?s.then(function(){return t(r,a)},function(e){return t(e,!1)}):t(r,a)}return this.then(function(e){return r(e,!0)},function(e){return r(e,!1)})}}}},u=function(e){return e&&i(e.then)?e:{then:function(t){var n=o();return setTimeout(function(){n.resolve(t(e))},0),n.promise}}},l=function(e){var t=o();return t.reject(e),t.promise},c=function(e){return{then:function(n,a){var s=o();return setTimeout(function(){try{s.resolve((i(a)?a:r)(e))}catch(n){s.reject(n),t(n)}}),s.promise}}},f=function(e,a,s,c){var f,d=o(),h=function(e){try{return(i(a)?a:n)(e)}catch(r){return t(r),l(r)}},p=function(e){try{return(i(s)?s:r)(e)}catch(n){return t(n),l(n)}},g=function(e){try{return(i(c)?c:n)(e)}catch(r){t(r)}};return setTimeout(function(){u(e).then(function(e){f||(f=!0,d.resolve(u(e).then(h,p,g)))},function(e){f||(f=!0,d.resolve(p(e)))},function(e){f||d.notify(g(e))})}),d.promise};return{deferred:o,reject:l,when:f,all:s}}var n,r=window.ya||{},i=function(e){return"function"==typeof e},a=r.mixins.Array.each,s=[];return n=t(function(e){s.push(e)}),n.getStack=function(){return s},n}()),ya.Core.$extend({module:"ya",alias:"Router",init:function(e){var t=this;return t.__super(),t.initConfig(e).initDefaults().bindEvents(),t},initDefaults:function(){var e=this;return e.set("routing",{}),e},bindEvents:function(){var e=this;return window.onhashchange=e.onHashChange.bind(e),this},onHashChange:function(){var e=this.get("routing"),t=window.location.hash.substr(1),n=t.split("/"),r=n.shift();if(e[r]){var i=[];if(e[r].params)for(var a=0,s=e[r].params.length;s>a;a++){var o=e[r].params[a],u=n[a],l=RegExp(o.substr(1,o.length-2));i.push(u.match(l).input)}e[r].callback.apply(null,i)}return this},restore:function(){return this.onHashChange(),this},when:function(e,t){var n=this,r=n.get("routing"),i=e.split("/"),a=i.shift();
return r[a]={callback:t,params:i},n.set("routing",r),n}}),function(){"use strict";function e(){0===a&&(s=setInterval(t,32)),a=+new Date}function t(){var e,t,r,i=+new Date;if(i-a>=32)for(clearInterval(s),a=0,e=n.view.$Manager.getItems(),t=e.length,r=0;t>r;)e[r].item.getFit()&&e[r].item.fireEvent("resize",e[r]),r++}var n=window.ya,r=document.createElement("style"),i=Array.prototype.slice,a=0,s=0;r.innerHTML=".ya.inline {display:inline;} .ya.hidden {display: none !important;}",r.setAttribute("type","text/css"),document.body.appendChild(r),window.addEventListener("resize",e),n.Core.$extend({module:"ya",alias:"View",defaults:{id:null,parent:null,children:null,fit:!1,hidden:!1,models:null,collections:null,autoCreate:!1,tpl:null},mixins:[n.mixins.DOM],init:function(e){var t=this;return t.__super(),t.initConfig(e).initDefaults().initRequired().initTemplate().initParent(),n.view.$Manager.register(t.getId(),t),t},initRequired:function(){var e=this;if(!e.getTpl())throw n.Error.$create("ya.View: no tpl set for "+config.getId());return e},initDefaults:function(){var e=this;return e.setId(e.getId()||"view-"+n.view.$Manager.getCount()),e.setChildren(e.getChildren()||[]),e.setModels(e.getModels()||[]),e.setCollections(e.getCollections()||[]),e},initTemplate:function(){var e=this,t=e.getTpl();return document.createElement("div"),t instanceof n.view.Template||(t instanceof Array||"array"==typeof t||"string"==typeof t||t instanceof String?t=n.$factory({module:"ya",alias:"view.Template",tpl:t}):(t instanceof Object||"object"==typeof t)&&(t.alias||(t.module="ya",t.alias="view.Template"),t=n.$factory(t))),e.setTpl(t),e},initParent:function(){var e=this,t=e.getParent();t&&t.getChildren().push(e)},setModel:function(e){var t=this,r=t.getModels();return e instanceof n.Model||(e.alias||(e.module="ya",e.alias="Model"),e=n.$factory(e)),t.hasModel(e.getNamespace())||(r.push(e),t.setModels(r)),t},hasModel:function(e){var t,n=this.getModels();for(t=n.length;t--;)if(n[t].getNamespace()===e)return!0;return!1},getModel:function(e){var t,n=this,r=n.getModels(),i=null;for(t=r.length;t--;)if(r[t].getNamespace()===e){i=r[t];break}return i},setCollection:function(e){var t=this,r=t.getCollections();return e instanceof n.Collection||(e.alias||(e.module="ya",e.alias="Model"),e=n.$factory(e)),t.hasCollection(e.getId())||(r.push(e),t.setCollections(r)),t},hasCollection:function(e){var t,n=this.getCollections();for(t=n.length;t--;)if(n[t].getId()===e)return!0;return!1},getCollection:function(e){var t,n=this,r=n.getCollections(),i=null;for(t=r.length;t--;)if(r[t].getNamespace()===e){i=r[t];break}return r},render:function(){var e,t,n=this,r=n._config,i=r.parent,a=r.renderTo;return e=n.getParentEl(a,!0),n.isInDOM()&&n.removeRendered(),t=n.getTpl().getTDOMInstance(n).getEDOM(),n.set("el",t),n.getHidden()&&n.hide(),e&&(e.appendChild(t),i&&0>i.findChild(n.getId())&&i.getChildren().push(n),n.set("isInDOM",!0),n.reAppendChildren(),n.fireEvent("render",null,n)),t},partialRender:function(e){for(var t,n=this,r=3===e.type,i=r?e.original:e.fillAttr?!0:e.original,a=e.headers,s=a.length;s--;)t=a[s],i=r||!e.fillAttr?i.replace("{{"+t.join(".")+"}}",n.getModel(t[0]).data(t[1])):i&&n.getModel(t[0]).data(t[1]);return r?e.pointer.textContent=i:e.fillAttr&&!i?e.pointer.removeAttribute(e.attrName):e.pointer.setAttribute(e.attrName,i),n},removeRendered:function(){var e=this;return e._el.parentNode.removeChild(e._el),e.set("el",null),e.set("isInDOM",!1),e},querySelector:function(e){return this.get("el").querySelector(e)||(this.isQueryMatch(e)?this.get("el"):null)},querySelectorAll:function(e){var t=i.call(this.get("el").querySelectorAll(e)||[],0);return this.isQueryMatch(e)&&t.push(this.get("el")),t},addChild:function(e,t){var r=this;return e.appendTo(r,t),n.event.$dispatcher.apply(e),r.fireEvent("elementAdded",r,e),r},getChild:function(e){var t=this;return 0>t.findChild(e)?!1:t.findChild(e)},findChild:function(e){for(var t=this.getChildren(),n=t.length;n--&&t[n].getId()!==e;);return n},removeChild:function(e){for(var t=this.getChildren(),n=t.length,r=[];n--;)t[n].getId()===e&&(r=t.splice(n,1),r[0].clear());return r[0]||null},removeChildren:function(){for(var e=this.getChildren(),t=e.length,n=[];t--;)n.push(e[t].clear());return n},clear:function(){var e=this,t=e._el;return e.isInDOM()&&(t.parentNode.removeChild(t),e.set("isInDOM",!1)),e},isInDOM:function(){return this._isInDOM},getParentEl:function(e,t){var n,r=this,i=r._config.parent;return r.isElement(e)?n=e:i?n=e?i._el.querySelector(e):i._el:t&&(n=document.querySelector(e)),n},appendTo:function(e,t){var r,i=this,a=i.get("config"),s=i.getId(),o=e.getChildren(),u=a.parent;return r=i.getParentEl(t,!1),a.renderTo=r,u?u&&u.getId()!==e.getId()&&u.findChild(s)>-1&&u.getChildren().splice(u.findChild(s),1):a.parent=e,o.push(i),a.parent=e,i.fireEvent("append",null,i,e),!i.isInDOM()&&e.isInDOM()&&(i._el?(r.appendChild(i._el),i.set("isInDOM",!0),i.reAppendChildren(),i.fireEvent("render",null,i)):(i.render(),n.event.$dispatcher.apply(i))),i},reAppendChildren:function(){for(var e=this.getChildren(),t=e.length,n=0;t>n;n++)e[n].appendTo(this);return this},show:function(){var e=this;return e._el?(e._el.classList.remove("hidden"),e.set("visible",!0),e.fireEvent("show",e),e):e},hide:function(){var e=this;return e._el?(e._el.classList.add("hidden"),e.set("visible",!1),e.fireEvent("hide",e),e):e},toggle:function(){var e=this;e._visible?e.hide():e.show()},isVisible:function(){return this.get("visible")&&this.isInDOM()}})}(),ya.Manager.$extend({module:"ya",alias:"view.$Manager",singleton:!0}),ya.Core.$extend({module:"ya",alias:"view.TDOM",defaults:{view:null,DOM:null,bindings:null},mixins:[ya.mixins.Array],init:function(e){var t=this;return t.initConfig(e).initRequired().initTDOM(),t},initRequired:function(){var e=this;if(!e.getView())throw ya.Error.$create("ya.view.TDOM requires view object","T2DOM1");if(!e.getDOM())throw ya.Error.$create("ya.view.TDOM requires DOM cloned from template","T2DOM2");if(!e.getBindings())throw ya.Error.$create("ya.view.TDOM requires bindings cloned from template","T2DOM3");return e},initTDOM:function(){var e,t=this,n=t.getView(),r=t.getBindings(),i=t.getDOM(),a=ya.view.Template.$BindingType;return t.each(r,function(r){switch(r.type){case a.ATTR:r.pointer=i.querySelector('[ya-id="'+r.pointer+'"]').attributes.getNamedItem(r.name),t.each(r.headers,function(i){e=i[0],s=n.getModel(e),s&&(r.models[e]=s,s.addEventListener("data"+i[1].charAt(0).toUpperCase()+i[1].slice(1)+"Change",function(e){return function(){t.updateAttr(e)}}(r)),t.updateAttr(r))}),delete r.name;break;case a.TEXT:var s;r.pointer=i.querySelector('[ya-id="'+r.pointer+'"]'),t.each(r.headers,function(i){e=i[0],s=n.getModel(e),s&&(r.models[e]=s,s.addEventListener("data"+i[1].charAt(0).toUpperCase()+i[1].slice(1)+"Change",function(e){return function(){t.updateTxt(e)}}(r)),t.updateTxt(r))});break;case a.COL:var o,u,l;r.pointer=i.querySelector('[ya-id="'+r.pointer+'"]'),o=r.collection,o.id?o.pointer=ya.collection.$Manager.getItem(o.id):(u=n.getCollections(),t.some(u,o.namespace?function(e){return e.getNamespace()===o.namespace?(o.pointer=e,!0):void 0}:function(e){return e.__class__===o.class?(o.pointer=e,!0):void 0})),o.pointer||(l=o.class.split("."),o.pointer=ya.$factory({module:l.shift(),alias:l.join("."),id:o.id}),n.setCollection(o.pointer));break;default:r.pointer=i.querySelector('[ya-id="'+r.pointer+'"]')}}),t.setDOM(i),t.setBindings(r),t},updateTxt:function(e){var t,n=this,r=e.original;n.each(e.headers,function(n){t=e.models[n[0]].data(n[1]),t===void 0&&(t=""),r=r.replace("{{"+n.join(".")+"}}",t)}),e.pointer.innerHTML=r},updateAttr:function(e){var t,n=this,r=e.original;n.each(e.headers,function(n){t=e.models[n[0]].data(n[1]),t===void 0&&(t=""),r=r.replace("{{"+n.join(".")+"}}",t)}),e.pointer.value=r},getEDOM:function(){var e,t,n=this,r=n.getDOM();if(r.childNodes.length>1||3===r.firstChild.nodeType){for(e=document.createElement("div");r.childNodes.length;)e.appendChild(r.firstChild);e.setAttribute("class","ya inline"),r.appendChild(e)}return t=r.firstChild,t.setAttribute("id",n.getView().getId()),t}}),ya.Core.$extend({module:"ya",alias:"view.Template","static":{id:0,DOM4:function(){return!document.createAttribute("rel")instanceof Node},BindingType:{CSS:5,VIEW:4,TEXT:3,ATTR:2,COL:1}},mixins:[ya.mixins.Array],defaults:{id:null,tpl:null,tDOM:null},init:function(e){var t=this;t.__super(),t.initConfig(e).initRequired().initDefaults().initBindings().initRegister()},initRequired:function(){var e=this;if(!e.getTpl())throw ya.Error.$create("ya.view.Template: Missing tpl property","YVT1");return e},initDefaults:function(){var e=this,t=e.getTpl(),n=document.createDocumentFragment();if(e.setId(e.getId()||"template-"+ya.view.template.$Manager.getCount()),e.setTDOM(e.getTDOM()||ya.view.TDOM),Array.isArray(t)&&(t=t.join("")),"string"==typeof t||t instanceof String){var r=document.createElement("div");for(r.innerHTML=t;r.hasChildNodes();)n.appendChild(r.firstChild)}else t instanceof DocumentFragment?n=t:n.appendChild(t);return e.set("html",n),e},initRegister:function(){var e=this;return ya.view.template.$Manager.register(e.getId(),e),e},initBindings:function(){var e,t,n=this;return t=n.findAttrsBindings(),e=n.findTextBindings(),n.set("bindings",t.concat(e)),n},findAttrsBindings:function(){var e,t,n,r,i,a=this,s=[],o=[],u=/^ya-(.*)/i,l=[],c=Array.prototype.slice;for(t=document.createTreeWalker(a._html,NodeFilter.SHOW_ELEMENT,null,!1);t.nextNode();)i=t.currentNode,l=c.call(i.attributes),ya.view.Template.$DOM4&&a.each(l,function(e){e.ownerElement=i}),s=s.concat(l);for(;s.length;){switch(r=s.pop(),n=r.nodeName.match(u),n&&n[1]){case"collection":e=a.prepareColBindings(r);break;case"view":e=a.prepareViewBindings(r);break;case"css":e=a.prepareCSSBindings(r);break;default:e=a.prepareAttrBindings(r)}e&&o.push(e)}return o},findTextBindings:function(){var e,t,n=this,r=[];for(t=document.createTreeWalker(n._html,NodeFilter.SHOW_TEXT,null,!1);t.nextNode();)e=n.prepareTextBindings(t.currentNode),e&&r.push(e);return n.each(r,function(e){e.old.parentNode.replaceChild(e.doc,e.old),delete e.doc,delete e.old}),r},prepareTextBindings:function(e){var t,n,r,i,a=e.data.match(/\{\{(.*?)\}\}/gi),s=!1;if(a){var o=document.createElement("span"),u=ya.view.Template.$id++;for(o.setAttribute("ya-id",u),t=0,n=a.length,r=[];n>t;)result=a[t++],i=result.substr(2,result.length-4).split("."),r.push(i);s={original:e.value||e.data,old:e,doc:o,models:{},headers:r,type:3,pointer:u}}return s},prepareColBindings:function(e){var t,n=e.value.match(/(?:class|id|namespace|model|view)[?!:]([\S]+)/gi),r=e.ownerElement,i=r.getAttribute("ya-id")||ya.view.Template.$id++,a={view:"ya.View","class":"ya.Collection"},s={pointer:i,type:ya.view.Template.$BindingType.COL,collection:a},o=ya.mixins.DOM;for(r.setAttribute("ya-id",i);n&&n.length;)t=n.pop().split(":"),a[t[0]]=t[1];if(r.hasChildNodes()){var u=ya.$factory({module:"ya",alias:"view.Template",tpl:o.removeChildren(r)});a.tpl=u.getId()}return s},prepareViewBindings:function(e){var t,n=e.ownerElement,r=(n.getAttribute("ya-view")||"ya.View",n.getAttribute("ya-id")||ya.view.Template.$id++),i=e.value.match(/(?:class|id)[?!:]([\w\.]+)/gi),a={pointer:r,type:ya.view.Template.$BindingType.VIEW,view:{"class":"ya.View"}};for(n.setAttribute("ya-id",r);i&&i.length;)t=i.pop().split(":"),a.view[t[0]]=t[1];return a},prepareCSSBindings:function(e){var t,n,r,i,a=e.ownerElement,s=e.value&&e.value.match(/\{\{(.*?)\}\}/gi),o=s&&s.length,u=[],l=0;if(i=a.getAttribute("ya-id"),i||(i=ya.view.Template.$id++,a.setAttribute("ya-id",i)),s)for(;o>l;)result=s[l++],r=result.substr(2,result.length-4).split("."),u.push(r);return t=(a.getAttribute("style")||"")+e.value,a.setAttribute("style",t),n={original:t,fillAttr:!1,headers:u,models:{},name:"style",type:ya.view.Template.$BindingType.ATTR,pointer:i}},prepareAttrBindings:function(e){var t,n,r,i=e.ownerElement,a=e.value&&e.value.match(/\{\{(.*?)\}\}/gi),s=a&&a.length,o=e.value,u=[],l=0;if(a){for(n=i.getAttribute("ya-id"),n||(n=ya.view.Template.$id++,i.setAttribute("ya-id",n));s>l;)result=a[l++],r=result.substr(2,result.length-4).split("."),u.push(r);t={fillAttr:ya.mixins.CSSStyle.isFillAttr(e.name),name:e.name,original:o,headers:u,type:ya.view.Template.$BindingType.ATTR,pointer:n}}return a?t:null},getTDOMInstance:function(e){var t=this;return t.getTDOM().$create({config:{view:e,bindings:ya.$clone(t.get("bindings")),DOM:t.get("html").cloneNode(!0)}})}}),ya.Manager.$extend({module:"ya",alias:"view.template.$Manager",singleton:!0});
//@ sourceMappingURL=yamvc-v0.2.0.min.js.map