/*! yam v0.3.0 - 2014-10-03 
 *  License:  */
(function(e){"use strict";function t(){for(var e=0,t=o.length;t>e;e++)o[e]()}function n(){r||"complete"===document.readyState||(r=setTimeout(function(){"complete"===document.readyState?(console.log("%cLOG: document ready!","backdround: green; color: white;"),t()):(r=null,n())},10))}var r,i=e.ya||{},a="app",o=[];i.$onReady=function(e){o.push(e),n()},i.$merge=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&t[n]!==undefined&&(e[n]=t[n]);return e},i.$clone=function(e){return JSON.parse(JSON.stringify(e))},i.$set=function(){for(var t,n=3>arguments.length?a:arguments[0],r=3>arguments.length?arguments[0].split("."):arguments[1].split("."),i=3>arguments.length?arguments[1]:arguments[2],o=e[n]=e[n]||{};r.length;)t=r.shift(),0===r.length?o[t]=i:o=o[t]=o[t]||{};return this},i.$get=function(){var t,n=2>arguments.length?a:arguments[0],r=2>arguments.length?arguments[0]:arguments[1],o=arguments.length>1?n+"."+r:r,s=r?r.search(/\./)>0?r.split("."):[r]:[],l=null;for(s.length&&(l=e[n]=e[n]||{});s.length;)if(t=s.shift(),l[t])l=l[t];else{if(!(t in e))throw l=null,i.Error.$create("ya.$get: Cannot find class: "+o,"GEN1");l=e[t]}return l},i.$factory=function(e){var t,n,r;if(!e.alias&&!e.class)throw i.Error.$create("Factory method needs alias property","YA1");return e.class?(e.class=e.class.split("."),t=i.$get(e.class.shift(),e.class.join("."))):t=i.$get(e.module||a,e.alias),r=e.methods||{},r.config=e,delete e.alias,delete e.module,delete e.class,delete e.methods,n=t.$create(r)},i.$module=function(){var e=arguments.length?arguments[0]:null;return e&&(a=e),a},i.$uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},i.$exec=function(e){return Function("return "+e)()},e.ya=i})(window),ya.$set("ya","mixins.Array",{find:function(e,t){var n,r,i=e.length,a=arguments.length,o=a>2?arguments[2]:null;if(a>2)for(;i--;){for(r=e[i],n=t.split(".");n.length;)r=r[n.shift()];if(r===o)break}else for(;i--&&(r=e[i],r!==t););return i},findAll:function(e,t){for(var n,r=e.length,i=arguments.length,a=i>2?arguments[2]:null,o=[];r--;)n=e[r],i>1?n[t]===a&&o.push(r):n===t&&o.push(r);return o},findAllByFn:function(e,t){for(var n=e.length,r=[];n--;)t(e[n])&&r.push(n);return r},each:Array.prototype.forEach?function(e,t){Array.prototype.forEach.call(e,t)}:function(e,t){if(void 0===e||null===e)throw new TypeError;var n=Object(e),r=n.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=0;r>i;i++)i in n&&t.call(e,n[i],i,n)},some:Array.prototype.some?function(e,t){return Array.prototype.some.call(e,t)}:function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1}}),ya.$set("ya","mixins.CoreStatic",{$extend:function(e){e=e||{};var t,n,r=this,i=this.prototype,a=(r.__mixins__||[]).concat(e.mixins||[]),o=e.static||{},s=/xyz/.test(function(){})?/\b__super\b/:/.*/,l=function(e,t){return function(){var n=this.__super;this.__super=i[e];var r=t.apply(this,arguments);return this.__super=n,r}},u={}.hasOwnProperty;return t=function(){var e,n,r=t.__defaults__,i=r.length,a=0,o={};for(this._config={};i>a;)e=r[a],"function"==typeof e&&(e=e.call(this)),ya.$merge(o,e),a++;for(n in o)u.call(o,n)&&(this._config[n]=o[n]);ya.Core.apply(this,arguments)},n=function(t,n){function r(){this.constructor=t}for(var c in n)u.call(n,c)&&(t[c]=n[c]);r.prototype=n.prototype,t.prototype=new r,t.prototype.__module__=e.module||ya.$module(),t.prototype.__class__=t.prototype.__module__+"."+e.alias;for(var d in ya.mixins.CoreStatic)ya.mixins.CoreStatic.hasOwnProperty(d)&&(t[d]=ya.mixins.CoreStatic[d]);for(var f in e)t.prototype[f]="function"==typeof e[f]&&"function"==typeof i[f]&&s.test(e[f])?l(f,e[f]):e[f];for(t.__mixins__=a.slice(),t.__defaults__=n.__defaults__.slice(),e.defaults&&t.__defaults__.push(e.defaults);a.length;){var p=a.pop();t.$mixin(p)}for(var h in o)u.call(o,h)&&(t["$"+h]=o[h]);return t},n(t,r),e.alias&&ya.$set(e.module||ya.$module(),e.alias,e.singleton?t.$create():t),t},$create:function(){var e=this,t=Array.prototype.concat.apply([e],arguments);return new(Function.prototype.bind.apply(e,t))},$mixin:function(e,t){var n,r;t?n="function"==typeof e?e.prototype:e:(t="function"==typeof e?e.prototype:e,n=this.prototype);for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r])}}),function(){"use strict";function e(e){for(var t={},n=e.split(","),r=0;n.length>r;r++)t[n[r]]=!0;return t}var t;t=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),ya.$set("ya","mixins.CSSStyle",{isFillAttr:function(e){return t[e]!==undefined}})}(),ya.$set("ya","mixins.DOM",{findParent:function(e,t){var n=ya.mixins.DOM.isQueryMatch,r=null;if("string"!=typeof t)return null;for(;e.parentNode;)if(e=e.parentNode,n(t,e)){r=e;break}return r},isChild:function(e,t){var n,r,i=!1;for(n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);n.nextNode();)r=n.currentNode,r===t&&(i=!0);return i},isQueryMatch:function(e,t){var n,r,i,a,o=ya.mixins.DOM.isElement,s=!0;if(o(t)||(s=!1),s&&-1===e.search(" ")){if(n=e.match(/^[^\.#]+/gi),r=e.match(/#[^\.#]+/gi),i=e.match(/\.[^\.#]+/gi),n&&t.nodeName.toLowerCase()!==n.pop()&&(s=!1),i)for(;i.length;)if(a=i.pop().substring(1),t.classList&&!t.classList.contains(a)){s=!1;break}r&&t.getAttribute("id")!==r.pop().substring(1)&&(s=!1)}else s=!1;return s},isElement:function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},removeChildren:function(e){for(var t=document.createDocumentFragment();e.hasChildNodes();)t.appendChild(e.removeChild(e.firstChild));return t},toString:function(e){var t,n=function(e){var t;if("undefined"!=typeof XMLSerializer){var n=new XMLSerializer;t=n.serializeToString(e)}else e.xml&&(t=e.xml);return t},r=0,i="";if(e instanceof DocumentFragment)for(e=e.firstChild;e;)i+=n(e),e=e.nextSibling;else if(e instanceof NodeList)for(t=e.length;t>r;)i+=n(e);else e instanceof HTMLElement&&(i=n(e));return i}}),ya.$set("ya","mixins.GetSet",{set:function(e,t){var n="_"+e,r=this[n];return t!==r&&(this[n]=t,this.fireEvent(e+"Change",this,t,r)),this},get:function(e){return this["_"+e]}}),ya.$set("ya","mixins.Object",{hash:function(e){return e.split("").reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0)}}),ya.$set("ya","mixins.Observable",{fireEvent:function(){if(this._suspendEvents)return!0;for(var e,t=!0,n=Array.prototype.shift,r=n.call(arguments),i=0,a=this._listeners[r]||[],o=a.length;o>i;i++)t&&(e=a[i],t=e.apply(e,arguments),t=t===void 0?!0:t,e.single&&this.removeEventListener(r,e));return t},addEventListener:function(e,t,n,r){var i=this._listeners[e]||[];return r&&(t.single=!0),i.push(n?t.bind(n):t),this._listeners[e]=i,this},removeEventListener:function(e,t){var n,r=this._listeners[e]||[];if(r)if(t){if("function"==typeof t)for(var i=0,a=r.length;a>i;i++)r[i]===t&&(n=i);else n=t;r.splice(n,1)}else this._listeners[e]=[];return this},suspendEvents:function(){var e=this;return e.set("suspendEvents",(e._suspendEvents||0)+1),this},resumeEvents:function(){var e=this;return e.set("suspendEvents",--e._suspendEvents),e}}),ya.$set("ya","Core",function(){"use strict";function e(){this.set("listeners",{}),this.set("suspendEvents",!1),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}var t=window.ya;e.prototype.init=function(e){return this.initConfig(e).initDefaults().initRequired()},e.prototype.initConfig=function(){return this},e.prototype.initDefaults=function(){return this},e.prototype.initRequired=function(){return this},e.prototype.initConfig=function(e){var n,r,i,a,o=this,s=function(e){n="get"+e.charAt(0).toUpperCase()+e.slice(1),r="set"+e.charAt(0).toUpperCase()+e.slice(1),o[n]=function(){return o.get("config")[e]},o[r]=function(t){var n=o.get("config")[e];return t!==n&&(o.get("config")[e]=t,o.fireEvent(e+"Change",this,t,n)),this}};e=e||{},i=t.$merge(o._config,e.config),o.set("initOpts",e),o.set("config",i);for(a in i)i.hasOwnProperty(a)&&s(a);return o},e.prototype.bindMethods=function(e){var t=this;for(var n in e)e.hasOwnProperty(n)&&"function"==typeof e[n]&&(t[n]=e[n].bind(t),delete e[n]);return t},e.prototype.onChange=function(e,t,n){var r=this;return r.addEventListener(e+"Change",t,r,n),r},e.prototype.unbindOnChange=function(e,t){for(var n=this,r=n._listeners[e+"Change"]||[],i=0,a=r.length;a>i;i++)r[i]===t&&r.splice(i,1);return this._listeners[e+"Change"]=r,n},e.prototype.destroy=function(){var e,t=this,n=t._config;t.fireEvent("destroy",t);for(e in n)n.hasOwnProperty(e)&&"id"!==e&&(n[e]=null);for(e in t)t.hasOwnProperty(e)&&"_config"!==e&&(t[e]=null);return t._destroyed=!0,t},e.__mixins__=[],e.__defaults__=[];for(var n in t.mixins.CoreStatic)t.mixins.CoreStatic.hasOwnProperty(n)&&(e[n]=t.mixins.CoreStatic[n]);return e.$mixin(t.mixins.GetSet),e.$mixin(t.mixins.Observable),e}()),ya.Core.$extend({module:"ya",alias:"Error",defaults:{id:null,message:null,stack:null},init:function(){var e=this;e.initConfig(arguments).initDefaults()},initConfig:function(e){var t=this;return t.__super({config:{message:e[0],id:e[1]}}),t},initDefaults:function(){var e=this;return e.setStack(Error(e.getMessage()).stack),e.id=e.getId(),e.message=e.getMessage(),e.stack=e.getStack(),e},toString:function(){var e=this;return"ya.Error("+e.getId()+"): "+e.getMessage()}}),ya.Core.$extend({module:"ya",alias:"Manager",defaults:{items:null,id:null},mixins:[ya.mixins.Array],initDefaults:function(){var e=this;return e.setItems([]),e.setId(0),e},getItem:function(e){var t,n=this,r=n.getItems();return t=n.find(r,"id",e),t>-1?r[t].item:null},getCount:function(){return this.getItems().length},getUniqueId:function(){return this._config.id++},register:function(e,t){var n=this;if(n.isRegistered(e))throw ya.Error.$create(this.__class__+": ID "+e+" already registered.","YVTM1");return n.getItems().push({id:e,item:t}),n.fireEvent("registered",t),n},deregister:function(e){var t,n=this,r=n.getItems();return t=n.find(r,"id",e),t>-1&&n.fireEvent("unregistered",r.splice(t,1)),n},isRegistered:function(e){return this.find(this.getItems(),"id",e)>-1}}),ya.Manager.$extend({module:"ya",alias:"collection.$manager",singleton:!0}),ya.Manager.$extend({module:"ya",alias:"controller.$manager",singleton:!0}),ya.Manager.$extend({module:"ya",alias:"view.$manager",singleton:!0}),ya.Manager.$extend({module:"ya",alias:"view.template.$manager",singleton:!0}),function(e,t){"use strict";function n(){var n,r;document.body.insertBefore(a,null),n="Transform";for(r in l)n=l[r].length?n:n.charAt(0).toLowerCase()+n.slice(1),a.style[l[r]+n]!==t&&(a.style[l[r]+n]="translate3d(1px,1px,1px)",c=e.getComputedStyle(a).getPropertyValue(o[r]+"transform"),c=c!==t&&c.length>0&&"none"!==c,u.transform=l[r]+n,u.transformCSS=o[r]+"transform");n="Transition";for(r in l)n=l[r].length?n:n.charAt(0).toLowerCase()+n.slice(1),a.style[l[r]+n]!==t&&(u.transition=l[r]+n,u.transitionCSS=o[r]+"transition");return document.body.removeChild(a),!0}var r,i=e.ya||{},a=document.createElement("div"),o="-webkit- -moz- -o- -ms- ".split(" "),s="Webkit Moz O ms ",l=s.split(" "),u={transform:null,transition:null},c=!1;i.CSS3={init:function(){return r=r||n(),this},is:function(e){return null!==u[e]},get:function(e){return u[e]||e},getCSS:function(e){return u[e+"CSS"]},has3d:function(){return c}},i.CSS3.init(),e.ya=i}(window),ya.Core.$extend({module:"ya",alias:"Ajax","static":{pause:!1},defaults:function(){return{url:null,method:"GET",promise:ya.$promise.deferred(),XhrInstance:ya.$get("XMLHttpRequest"),mimeType:"text/plain",responseType:"text",params:null,request:null}},onProgress:function(){},onComplete:function(){},onError:function(){},onAbort:function(){},getResponse:function(){return this._response||this.getRequest().response},doFallback:function(){},doIt:function(){var e=this,t=e.getPromise(),n=e.getXhrInstance(),r=new n,i=e.getMethod(),a=e.getUrl(),o=e.getMimeType(),s=e.getResponseType(),l=e.getParams(),u=null;if(!ya.Ajax.$pause){if("GET"!==i)for(var c in l)l.hasOwnProperty(c)&&(u||(u=new FormData),u.append(c,l[c]));r.open(i,a,!0);try{if(r.overrideMimeType(o+"; charset=x-user-defined"),r.responseType=s,r.responseType!==s)throw ya.Error.$create("Setting response type not supported")}catch(d){e.set("notSupportedReqType",!0)}return r.addEventListener("progress",function(n){e.onProgress(n),t.notify({scope:e,value:n})},!1),r.addEventListener("load",function(n){e.onComplete(n),t.resolve({scope:e,value:n}),e._notSupportedReqType&&e.doFallback()},!1),r.addEventListener("error",function(n){e.onError(n),t.reject(ya.Error.$create("Error during sending the data to "+e.getUrl()))},!1),r.addEventListener("abort",function(n){e.onAbort(n),t.reject(ya.Error.$create("Error during sending the data to "+e.getUrl()))},!1),r.send(u),e.setRequest(r),t.promise}}}),ya.Ajax.$extend({module:"ya",alias:"ajax.JSON",defaults:function(){return{mimeType:"application/json",responseType:"json"}},doFallback:function(){var e=this,t=e.getRequest();e.set("response",JSON.parse(t.responseText))}}),ya.Core.$extend({module:"ya",alias:"Collection",defaults:{id:null,namespace:null,model:null,proxy:null,remote:!1},init:function(e){var t=this;return t.__super(e).initData(),ya.collection.$manager.register(t.getId(),t),t},initDefaults:function(){var e=this,t=e.getModel();return e.setId(e.getId()||"collection-"+ya.collection.$manager.getCount()),"string"==typeof t&&(t=ya.$get(t)),e.setModel(t||ya.$get("ya.Model")),e.set("set",[]),e.set("cache",[]),e.set("removed",[]),e.set("filters",[]),e.set("sorters",[]),e.set("raw",e.getData()||[]),e},initData:function(){var e=this;return e.prepareData(e._raw),e},each:function(e){var t,n,r=this,i=r._set;if(t=Object(i),n=t.length>>>0,"function"!=typeof e)throw ya.Error.$create("forEach argument should be a function","COL1");for(var a=0;n>a;a++)a in t&&e.call(r,t[a],a,t);return r},push:function(e){var t,n,r=this,i=r.getModel(),a=r.getNamespace(),o=[];for(Array.isArray(e)||(e=[e]);e.length;)if(n=t=e.shift(),t){if(t instanceof i||(t=new i({config:{namespace:a,data:t}})),t.getNamespace()!==r.getNamespace())throw ya.Error.$create("Model should have same namespace as collection","COL2");r._raw.push(n),r._cache.push(t),o.push(t)}return r.suspendEvents(),r.filter(),r.sort(),r.resumeEvents(),r.fireEvent("push",r,o),r},remove:function(e){var t,n,r,i=this,a=ya.mixins.Array.some,o=[];for(t=function(e,t){return e._clientId===n._clientId?(r=t,!0):e.data(e.getIdProperty())&&e.data(n.getIdProperty())&&e.data(e.getIdProperty())===e.data(n.getIdProperty())?(r=t,!0):void 0},Array.isArray(e)||(e=[e]);e.length;)n=e.pop(),r=-1,a(i._cache,t),r>=0&&(i._raw.splice(r,1),o.push(i._cache.splice(r,1).pop()));return i.suspendEvents(),i.filter(),i.resumeEvents(),i.fireEvent("remove",i,o),i},removeByField:function(e,t){var n=this,r=n.getBy(function(n){return n.data(e)===t.data(key)});return n.remove(r),n},removeAll:function(){var e=this,t=e._cache.slice();return e.set("set",[]),e.set("cache",[]),e.set("raw",[]),e.fireEvent("remove",e,t),e},count:function(){return this._set.length},clear:function(){var e=this;return e.set("set",[]),e.set("cache",[]),e.set("raw",[]),e.set("removed",[]),e.fireEvent("clear",e),e},filter:function(e){var t,n=this,r=n._filters,i=!0,a=[],o=n._cache,s=0,l=null;arguments.length>1&&(l=arguments[0],e=arguments[1]),"function"==typeof e&&(l?r.push({id:l,fn:e}):r.push(e),n.fireEvent("beforeFilter",n,r));for(var u=0,c=o.length;c>u;u++){for(i=!0,s=r.length;s--;)t="function"==typeof r[s]?r[s]:r[s].fn,i=i&&t(o[u]);i&&a.push(o[u])}return n.set("set",a),n.set("total",a.length),n.fireEvent("filter",n,r),n},clearFilters:function(){var e=this;return e.set("filters",[]),e.set("set",e._cache),e.fireEvent("filter",e,[]),e},clearFilter:function(e){var t,n,r=this,i=r._filters;for(t=i.length;t--;)if(n=i[t],"function"!=typeof n&&n.id===e){i.splice(t,1);break}return r.filter(),r},sort:function(e){var t,n,r,i,a,o=this,s=o._set;for(e=e?o._sorters.concat(e):o._sorters,o._sorters=o._sorters.concat(e),t=function(e,t){var n=""+e.data(i),r=""+t.data(i),o=n.toLowerCase(),s=r.toLowerCase();return(o>s?1:s>o?-1:n>r?1:r>n?-1:0)*("desc"===a.toLowerCase()?-1:1)},n=e.length;n--;)r=e[n],i=r[0],a=r[1]||"ASC",s.sort(t);o.fireEvent("sort",o,e)},clearSorters:function(){var e=this;return e.set("sorters",[]),e.sort(),e},getAt:function(e){return this._set[e]},getBy:function(e){for(var t=this,n=t._set,r=[],i=0,a=n.length;a>i;i++)e(n[i])&&r.push(n[i]);return r},findOneBy:function(e){for(var t=this,n=t._set,r=n.length,i=0,a=-1;r>i;){if(e(n[i])){a=i;break}i++}return a},contains:function(e,t){var n=this,r=!1;return n.each(function(n){n.data(e)===t&&(r=!0)}),r},getOneBy:function(e){for(var t,n=this,r=n._set,i=0,a=r.length;a>i;){if(e(r[i])){t=r[i];break}i++}return t},getTotal:function(){return this._total},load:function(e){var t,n,r=this,i=ya.$promise.deferred(),a=r.getNamespace(),o=ya.data.Action.$create(),s=0;for(n in e)s++;if(0===s)throw ya.Error.$create("You need to pass at least one condition to load model collection","COL3");if(!r.getProxy())throw ya.Error.$create("To load collection you need to set proxy","COL4");return t=function(){"success"===o.getStatus()?(r.fireEvent("load",r,o.getResponse(),"read"),r.setData(o.getData())):r.fireEvent("error",r,"read")},o.setOptions({callback:t,params:e,namespace:a}),r.getProxy().read(o),i.promise},save:function(){for(var e,t,n,r,i=this,a=ya.$promise.deferred(),o=[],s=[],l=i._removed,u=i._cache,c=i.getNamespace(),d=i.getProxy(),f=0,p=[],h=0,g=u.length;g>h;h++)n=u[h],n._isDirty&&(n.hasId()?s.push(n._data):(n._data.__clientId__=n.get("clientId"),o.push(n._data)));return r=function(e){return function(t){return e.__clientId__?t.data("__clientId__")===e.__clientId__:t.data("id")===e.id}},t=function(e,t){if(f--,t.getStatus()===ya.data.Action.$status.SUCCESS){var o,s=t.getResponse(),l=s.result;if(n=l[0],o=l.length,n&&(n.__clientId__||n.id))for(;o--;)n=i.getOneBy(r(l[o])),n.setDirty(!1),delete n._data.__clientId__;else i.set("removed",[])}else p.push(t.getResponse().error);0===f&&(p.length?(i.fireEvent("error",i,p),a.reject({errors:p})):(i.fireEvent("save",i),a.resolve({scope:i})))},o.length&&(f++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(o),d.create(e)),s.length&&(f++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(s),d.update(e)),l.length&&(f++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(l),d.destroy(e)),a.promise},prepareData:function(e){for(var t=this,n=t.getModel(),r={namespace:t.getNamespace()},i=e.length,a=[],o=0;i>o;o++)r.data=e[o],a.push(new n({config:r}));return t.set("cache",a),t.suspendEvents(!0),t.filter(),t.sort(),t.resumeEvents(),t.fireEvent("prepare"),t},setData:function(){var e=this;return e.setRawData(data),e.prepareData(data),e},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(e){return this.set("raw",e),this},isDirty:function(){for(var e=this._cache,t=e.length,n=!1;t--;)e[t]._isDirty&&(n=!0);return this._remove&&(n=!0),n}}),ya.Core.$extend({module:"ya",alias:"Controller",defaults:{id:null,routes:null,events:null},"static":{router:null,getRouter:function(){return ya.Controller.$router=ya.Controller.$router||new ya.Router}},init:function(e){var t=this;return t.__super(e).initEvents().initRoutes(),ya.controller.$manager.register(t.getId(),t),ya.$onReady(function(){t.restoreRouter()}),t},initDefaults:function(){var e=this;return e.setId(e.getId()||"controller-"+ya.controller.$manager.getCount()),e.set("router",ya.Controller.$getRouter()),e.set("dispatcher",ya.event.$dispatcher),e},initEvents:function(){var e,t,n,r,i,a=this,o=a.getEvents(),s=[],l=RegExp("\\$([^\\s]+)"),u=RegExp("[id|class]+:([^\\s]+)"),c=a._dispatcher;if(o){for(var d in o)if(o.hasOwnProperty(d)){r={},r[d]=i=o[d];for(var f in i)i.hasOwnProperty(f)&&"function"!=typeof i[f]&&(i[f]=a[i[f]]);if(c.add(a,r),e=d.match(l)||d.match(u),!e)throw ya.Error.$create(a.__class__+": Event query should begin from id or class name of the view (current query: "+d+")","CTRL1");0>s.indexOf(e[1])&&s.push(e[1])}for(n=s.length;n--;)t=ya.view.$manager.getItem(s[n]),t&&t.isInDOM()&&a.resolveEvents(t)}return a},initRoutes:function(){var e=this,t=e.getRoutes(),n=e._router;if(t)for(var r in t)if(t.hasOwnProperty(r)){var i=e[t[r]].bind(e);n.when(r,i)}return e},resolveEvents:function(e){var t,n,r,i,a,o=this.getEvents(),s=function(e,t,n,r){return e.bind(t,n,r)},l=RegExp("\\$([^\\s]+)");for(var u in o)if(o.hasOwnProperty(u)&&(t=u.match(l),t&&t[1]===e.getId())){n=o[u],i=u.split(" ").slice(1),r=i.length?e.get("el").querySelectorAll(i.join(" ")):[e.get("el")];for(var c=0,d=r.length;d>c;c++)for(var f in n)n.hasOwnProperty(f)&&(a=s(n[f],this,e,r[c]),r[c].addEventListener(f,a))}},getRouter:function(){return this._router},getView:function(e){return ya.view.$manager.getItem(e)},getController:function(e){return ya.controller.$manager.getItem(e)},getCollection:function(e){return ya.collection.$manager.getItem(e)},restoreRouter:function(){var e=this;return e.getRouter().restore(),e},redirectTo:function(e){return window.location.hash=e,this}}),ya.Core.$extend({module:"ya",alias:"data.Action","static":{status:{PENDING:0,SUCCESS:1,FAIL:2}},initDefaults:function(){var e=this;return e.set("response",{}),e.set("results",null),e.set("status",ya.data.Action.$status.PENDING),e},setData:function(e){return this.set("data",e)},getData:function(){return this._data},setOptions:function(e){return this.set("options",e)},getOptions:function(){return this._options},getOption:function(e){return this._options[e]},setResponse:function(e){return this.set("response",e)},getResponse:function(){return this._response},setResultSet:function(e){return this.set("results",e)},getResultSet:function(){return this._results},setStatus:function(e){var t,n=ya.data.Action.$status,r=!1;for(t in n)n.hasOwnProperty(t)&&n[t]===e&&(r=!0);if(!r)throw ya.Error.$create("ya.data.Action: Wrong status","ACTION1");return this.set("status",e)},getStatus:function(){return this.get("status")}}),ya.Core.$extend({module:"ya",alias:"data.Proxy",read:function(e){var t,n,r=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: read argument action should be instance of ya.data.Action");if(t=e.getOptions(),n=t.params&&t.params.id,!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");return n===void 0?r.readBy(e):r.readById(e),r},create:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: create argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("ya.data.Proxy: Data should be object");return t},update:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: update argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("ya.data.Proxy: Data should be object");return t},destroy:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: destroy argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("Data should be pass as object");return t}}),ya.data.Proxy.$extend({module:"ya",alias:"data.proxy.LocalStorage","static":{clear:function(e){var t,n=0;if(e)for(Array.isArray(e)||(e=[e]),n=e.length;n--;)t=e[n],delete localStorage[t],delete localStorage[t+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},readBy:function(e){var t,n,r,i,a,o,s,l=this,u=e.getOptions(),c=u.namespace,d=u.callback,f=u.limit||null,p=u.offset||0,h=u.filters||[],g=u.sorters||[],m={},y=[],v=[],_=!0,w=0;return a=function(e,t){var n=""+e[r],i=""+t[r],a=n.toLowerCase(),s=i.toLowerCase();return(a>s?1:s>a?-1:n>i?1:i>n?-1:0)*("desc"===o.toLowerCase()?-1:1)},t=function(){if(localStorage[c]){v=JSON.parse(localStorage[c]);for(var t=0,u=v.length;u>t;t++){for(_=!0,s=h.length;s--;)n=h[s].length>3?h[s][0]:"&&","&&"===n?_=l.executeCondition(v[t],h[s])&&_:"||"===n&&(_=l.executeCondition(v[t],h[s])||_);_&&y.push(v[t])}for(v=y,w=y.length,s=g.length;s--;)i=g[s],r=i[0],o=i[1]||"ASC",v.sort(a);f||(f=v.length-p),(p>0||f)&&(v=v.splice(p,f))}m.total=w,m.result=v,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(m),d(l,e)},setTimeout(function(){try{t()}catch(n){m.error=n,d(l,e)}},0),l},readById:function(e){var t,n=this,r=e.getOptions(),i=r.params,a=r.namespace,o=r.callback,s=i.id,l=[],u={},c={};return t=function(){if(localStorage[a]){l=JSON.parse(localStorage[a]);for(var t=0,r=l.length;r>t;t++)l[t].id===s&&(u=l[t]);if(u.id!==void 0)return c.total=1,c.result=u,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(c),o(n,e),n}c.error=ya.Error.$create("Not found","APP_NAMESPACE_NOT_FOUND"),e.setStatus(ya.data.Action.$status.FAIL).setResponse(c),o(n,e)},setTimeout(t,0),n},create:function(e){var t,n,r=this,i=e.getData(),a=e.getOption("namespace"),o=e.getOption("callback"),s=[],l=1,u={};if(r.__super.apply(this,arguments),localStorage[a]&&(s=JSON.parse(localStorage[a]),l=localStorage[a+"$Sequence"]),Array.isArray(i)){t=[];for(var c=0,d=i.length;d>c;c++)i[c].id=l++,delete i[c].__clientId__,s.push(i[c]),t.push(i[c])}else i.id=l++,delete i.__clientId__,s.push(i),t=i;return n=function(){try{localStorage[a]=JSON.stringify(s),localStorage[a+"$Sequence"]=l,u.result=t,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(u)}catch(n){u.error=n,e.setStatus(ya.data.Action.$status.FAIL).setResponse(u)}o(r,e)},setTimeout(n,0),r},update:function(e){var t,n,r,i,a,o,s=this,l=e.getData(),u=e.getOption("namespace"),c=e.getOption("callback"),d=[],f={};return a=function(){if(d=JSON.parse(localStorage[u]||"[]"),Array.isArray(l))for(t=[],r=l.length;r--;){for(i=d.length,n=l[r].id,o=!1;i--;)d[i].id===n&&(d[i]=l[r],t.splice(0,0,l[r]),o=!0);o||(d.push(l[r]),t.splice(0,0,l[r]))}else{for(r=d.length,n=l.id,o=!1;r--;)d[r].id===n&&(o=!0,t=d[r]=l);o||(d.push(l),t=l)}try{localStorage[u]=JSON.stringify(d),f.success=!0,f.result=t,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(f)}catch(a){f.success=!1,f.error=a,e.setStatus(ya.data.Action.$status.FAIL).setResponse(f)}return c(s,e),s},setTimeout(a,0),s},destroy:function(e){var t,n,r,i,a=this,o=e.getData(),s=e.getOption("namespace"),l=e.getOption("callback"),u=[],c={};return i=function(){if(localStorage[s]){if(u=JSON.parse(localStorage[s]),Array.isArray(o))for(n=o.length;n--;)for(r=u.length,t=o[n].id;r--;)u[r].id===t&&u.splice(r,1);else for(n=u.length,t=o.id;n--;)u[n].id===t&&u.splice(n,1);try{localStorage[s]=JSON.stringify(u),c.success=!0,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(c)}catch(i){c.success=!1,c.error=i,e.setStatus(ya.data.Action.$status.FAIL).setResponse(c)}return l(a,e),a}c.success=!1,c.error=ya.Error.$create("Not found"),e.setStatus(ya.data.Action.$status.FAIL).setResponse(c),l(a,e)},setTimeout(i,0),a},executeCondition:function(e,t){var n,r,i,a,o=!1;switch(t.length>3?(r=t[1],n=t[2],i=t[3]):(r=t[0],n=t[1],i=t[2]),n){case">":e[r]>i&&(o=!0);break;case"<":i>e[r]&&(o=!0);break;case">=":e[r]>=i&&(o=!0);break;case"<=":i>=e[r]&&(o=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),a=RegExp(i),a.test(e[r])&&(o=!0)}return o}}),ya.Core.$extend({module:"ya",singleton:!0,alias:"event.$dispatcher",defaults:{delegates:null},initDefaults:function(){var e=this;return e.setDelegates([]),e},add:function(e,t){var n=this,r=Object.keys(t).pop();return n.getDelegates().push({selector:r,scope:e,events:t[r]}),n},apply:function(e){for(var t,n,r,i,a=this,o=a.getDelegates(),s=[],l=e,u=[],c=function(e){return e.selector.search(r)>=0},d=ya.mixins.DOM.isQueryMatch,f=ya.mixins.Array.findAllByFn,p=ya.mixins.Array.each;e;)r=e.hasCustomId()?RegExp("^\\$"+e.getId()+"[\\s]"):RegExp("^class:"+e.__class__+"[\\s]"),s=f(o,c),s.length&&p(s,function(r){if(u.length=0,n=o[r],t=n.selector.split(" "),t.shift(),t.length){var s=t.pop();u=l.querySelectorAll(s),i=t.slice(),p(u,function(t){if(i.length)for(var r=t,o=i.pop();e.getId()!==r.getAttribute("id");){if(d(o,r)){if(0===i.length){a.assignEvents(t,n,e);break}o=i.pop()}r=r.parentNode}else a.assignEvents(t,n,e)})}}),e=e.getParent()},assignEvents:function(e,t,n){var r,i,a,o=t.events,s=!1;for(r in o)if(o.hasOwnProperty(r)){for(a=n._eventHandlers.length;a--;)i=n._eventHandlers[a],i.event===r&&i.el===e&&i.listener===o[r]&&i.scope===t.scope&&(s=!0);s||(e.addEventListener(r,o[r].bind(t.scope,n,e),!1),n.get("eventHandlers").push({event:r,listener:o[r],scope:t.scope,el:e}))}},clear:function(){return this.getDelegates().length=0,this}}),ya.Core.$extend({module:"ya",alias:"Job","static":{id:0,INFINITY:"infinity"},defaults:function(){return{id:null,delay:0,tasks:null,repeat:1,spawn:!1,results:null,maxTime:null}},initRequired:function(){var e=this;if(!e.getTasks()&&!e._config.task)throw ya.Error.$create("At least one task should be defined","YJ1",Error().stack);return e},initDefaults:function(){var e=this,t=e._config,n=t.tasks||[],r=t.task;return r&&n.push(r),e.setId(ya.Job.$id++),e.setTasks(n.reverse()),e.setResults([]),e.set("semaphore",n.length),e},doIt:function(){var e,t,n,r=this,i=ya.$promise.deferred();return e=r.getRepeat()>1||r.getRepeat()===ya.Job.$INFINITY?{terminate:function(e,t){return console.log("%cLOG: TERMINATE: "+r.__class__,"color: red; background: silver;"),clearInterval(r._clear),i.reject(ya.Error.$create(t,e))}}:{terminate:function(e,t){return console.log("%cLOG: TERMINATE: "+r.__class__,"color: red; background: silver;"),clearInterval(r._clear),i.reject(ya.Error.$create(t,e))}},e.run=function(e,t){r.set("clear",setInterval(e,t))},e.finish=function(){return r.getTasks().splice(n,1),r._semaphore--,0===r._semaphore||0>r.getRepeat()?(clearInterval(r._clear),i.resolve({success:!0,message:"Task finished",results:r.getResults()})):void 0},e.suspend=function(){clearInterval(r._clear)},t=function(){var t,i=r.getRepeat(),a=r.getTasks(),o=r.getMaxTime(),s=[];if(o&&+new Date-r._start>o)return e.terminate("YJ3","Timeout",Error().stack);for(i!==ya.Job.$INFINITY&&(r.setRepeat(--i),0>i&&e.finish()),t=a.length;t--;)n=t,s.push(a[t].call(e,e));r.getResults().push(s)},r.set("engine",e),r.set("start",+new Date),e.run(t,r.getDelay()),i.promise},terminate:function(){return this._engine.terminate("YJ2","Task terminated after "+(+new Date-this._start)/1e3+" seconds of execution",Error().stack)}}),ya.Core.$extend({module:"ya",alias:"Model","static":{id:0,idGenerator:function(){return ya.Model.$id++}},defaults:{idProperty:"id",proxy:null,namespace:null,data:null},initRequired:function(){var e=this;if(!e.getNamespace())throw ya.Error.$create("Model need to has a namespace");return e},initDefaults:function(){var e=this;return e.set("isDirty",!0),e.set("clientId",e.getNamespace()+"-"+ya.Model.$idGenerator()),e.set("data",e.getData()||{}),e},setDataProperty:function(e,t){var n=this,r=n._data,i=r[e];t!==i&&(r[e]=t,n.set("isDirty",!0),n.fireEvent("data"+e.charAt(0).toUpperCase()+e.slice(1)+"Change",n,t,i),n.fireEvent("dataChange",n,r))},getDataProperty:function(e){var t=this.get("data")[e];return t===void 0&&(t=""),t},data:function(e){var t,n=this,r=arguments.length;if(r>1)this.setDataProperty.apply(this,arguments);else{if("object"!=typeof e)return this.getDataProperty.apply(this,arguments);for(t in e)e.hasOwnProperty(t)&&n.setDataProperty(t,e[t])}return n},clear:function(){var e,t=this,n=t.get("data");for(e in n)n.hasOwnProperty(e)&&t.data(e,null);t.fireEvent("dataChange",t,n)
},load:function(e){var t,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.$promise.deferred(),o=new ya.data.Action,s={};if(e[i]===void 0&&r[i]===void 0)throw ya.Error.$create("You need to pass id to load model");return e[i]=r[i],s.namespace=n.getNamespace(),s.params=e,s.callback=function(){t=o.getResponse(),o.getStatus()===ya.data.Action.$status.SUCCESS?(n.set("isDirty",!1),n.set("data",t.result),a.resolve({scope:n,response:t,action:"read"}),n.fireEvent("loaded",n,t,"read")):(a.reject({scope:n,response:t,action:"read"}),n.fireEvent("error",n,t,"read"))},o.setOptions(s),n.getProxy().read(o),a.promise},save:function(){var e,t,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.$promise.deferred(),o=new ya.data.Action,s=n.getProxy(),l={};return n.get("isProcessing")||!n.get("isDirty")?!1:(n.set("isProcessing",!0),l.namespace=n.getNamespace(),l.callback=function(r,i){e=i.getResponse(),n.set("isProcessing",!1),i.getStatus()===ya.data.Action.$status.SUCCESS?(n.set("isDirty",!1),n.set("data",e.result),a.resolve({scope:n,action:i,type:t}),n.fireEvent("saved",n,i,t)):(a.reject({scope:n,action:i,type:t}),n.fireEvent("error",n,i,t))},o.setOptions(l).setData(r),r[i]===void 0?(t="create",s.create(o)):(t="update",s.update(o)),a.promise)},remove:function(){var e,t=this,n=t.get("data"),r=t.getIdProperty(),i=ya.$promise.deferred(),a=new ya.data.Action,o=t.getProxy(),s={};if(n[r]===void 0)throw ya.Error.$create("Can not remove empty model");return s.namespace=t.getNamespace(),s.callback=function(n,r){e=r.getResponse(),r.getStatus()===ya.data.Action.$status.SUCCESS?(t.set("isDirty",!1),t.set("data",{}),i.resolve({scope:t,action:r,type:"remove"}),t.fireEvent("removed",t,"remove")):(i.reject({scope:t,action:r,type:"remove"}),t.fireEvent("error",t,"remove"))},a.setOptions(s).setData(n),o.destroy(a),o.destroy(a),i.promise},hasId:function(){return!!this._data[this._config.idProperty]},setDirty:function(e){return this.set("isDirty",!!e),this},isDirty:function(){return this._isDirty}}),ya.Core.$extend({module:"ya",alias:"Module",defaults:function(){return{configs:null,launcher:!0,delay:16,maxLoadingTime:1e4,module:null,requires:[],modules:[],bus:{}}},init:function(e){return this.__super(e).initDependencies()},initDefaults:function(){var e=this;return e.setModule(e.getModule()||e.__module__),e.set("initialized",[]),e.__super()},initRequired:function(){var e=this;if(!e.getModule())throw ya.Error.$create(e.__class__+": Module name is required","YM1");return e},initDependencies:function(){var e,t=this,n=[],r=t.getModules().length,i=t.getRequires().length;return console.log("%cLOG: initDependencies: "+t.__class__,"color: yellow; background: green;"),n.push(function(e){return 0===r+i?(e.finish(),t):(i&&t.initRequires(e),r&&t.initModules(e),void 0)}),e=ya.Job.$create({config:{tasks:n,delay:t.getDelay(),repeat:ya.Job.$INFINITY,maxTime:t.getMaxLoadingTime()}}),e.doIt().then(function(){t.continueInit()})["catch"](function(){t._unresolved.length&&console.warn("Can't resolve class "+t._unresolved.join(", ")),t.onError.apply(t,arguments)}),t},initRequires:function(e){var t,n,r,i,a,o,s=this,l=ya.mixins.Array.each,u=s.getRequires(),c=u.length,d=!0,f=0,p=[],h={},g=null,m=[],y=null;for(t=function(e){switch(g=s.getConfigs(),h=g?g[r]?g[r]:{}:{},e){case"-i":console.log("%cINIT: "+s.__class__+":"+r,"background: yellow; color: black;"),p.push(y.$create({config:h}));break;case"-p":n.push(y);break;case"-ip":a=y.$create({config:h}),n.push(a),p.push(a)}};c>f;){o=s.getModule()+"."+u[f].split(" ").shift();try{y=ya.$get(o)}catch(v){y=null}null===y&&(d=!1,m.push(o)),f++}if(s.set("unresolved",m),d){for(n=[],f=0;c>f;){if(y=u[f].split(" "),r=y.shift(),i=y.join("").match(/-(\w+)/g),y=ya.$get(s.getModule()+"."+r),i)try{l(i,t)}catch(v){e.terminate(v.id,v.message,v.stack);break}f++}s.set("initialized",s._initialized.concat(p)),s.set("args",n),e.finish()}return s},initModules:function(e){function t(){g--,0===g&&e.finish()}function n(e){switch(e){case"-i":y=s.getConfigs(),o=y&&y[a]||{},o.launcher=!1,h.push(p.$create({config:o}).addEventListener("ready",t)),g++}}for(var r,i,a,o,s=this,l=ya.mixins.Array.each,u=s.getModules(),c=u.length,d=!0,f=0,p=null,h=[],g=0,m=[],y=null;c>f;){a=u[f].split(" ").shift();try{p=ya.$get(a)}catch(v){p=null}null===p&&(d=!1,m.push(a)),f++}if(s.set("unresolved",m),d){for(e.suspend(),f=0;c>f;){if(p=u[f].split(" "),a=p.shift(),r=a+".Module",i=p.join("").match(/-(\w+)/g),p=ya.$get(s.getModule()+"."+r),i)try{l(i,n)}catch(v){e.terminate(v.getId()||v.id,v.getMessage()||v.message,v.getStack()||v.stack);break}f++}s.set("initialized",s._initialized.concat(h))}return s},continueInit:function(){var e=this;return e.initBus().fireEvent("ready",e),e.onReady.apply(e,e._args),e.getLauncher()&&e.notifyChildren(),e},initBus:function(){var e,t,n,r,i=this,a=i.getBus();if(Array.isArray(a))for(;a.length;){var o=a.pop();for(var s in o)if(o.hasOwnProperty(s)){if(t=o[s].split(":"),e=s.split(":"),n=e.pop(),r=t.pop(),e=i.findConn(e),t=i.findConn(t),0>e.idx||0>t.idx)continue;e.obj.addEventListener(n,t.obj[r],t.obj)}}else for(var l in a)if(a.hasOwnProperty(l)){if(t=a[l].split(":"),e=l.split(":"),n=e.pop(),r=t.pop(),e=i.findConn(e),t=i.findConn(t),0>e.idx||0>t.idx)continue;e.obj.addEventListener(n,t.obj[r],t.obj)}return i},findConn:function(e){var t,n,r,i,a=this,o=ya.mixins.Array.find,s=[],l={};return t=e.pop(),n=e.pop()||a.__module__,r=[n,t].join("."),n!==a.__module__?(i=o(a._initialized,"__class__",n+".Module"),i>-1&&(s=a._initialized[i]._initialized)):s=a._initialized,l.idx=i=o(s,"__class__",r),l.obj=i>-1?s[i]:null,l},notifyChildren:function(){for(var e,t=this,n=t._initialized.length,r=0,i=/\.Module$/;n>r;)e=t._initialized[r],i.test(e.__class__)&&(e.onParentReady(),e.notifyChildren()),r++},onReady:function(){},onParentReady:function(){},onError:function(){}}),function(e){"use strict";var t,n,r={_callbacks:[],FRAME_RATE:60,hasNative:!1,options:{useNative:!0}};(function(){var i,a,o=["webkit","moz","ms","o"];try{e.top.name,a=e.top}catch(s){a=e}for(t=a.requestAnimationFrame,n=a.cancelAnimationFrame||a.cancelRequestAnimationFrame,i=0;o.length>i&&!t;i++)t=a[o[i]+"RequestAnimationFrame"],n=a[o[i]+"CancelAnimationFrame"]||a[o[i]+"CancelRequestAnimationFrame"];t&&t(function(){r.hasNative=!0})})(),r.now=Date.now||function(){return(new Date).getTime()},r.navigationStart=r.now(),r.perfNow=function(){return e.performance&&e.performance.now?e.performance.now():r.now()-r.navigationStart},r.start=function(){var e=r;return e.run||(e.run=!0,e.update(e.perfNow())),e},r.update=function(){var n,i=r,a=i._callbacks;if(i.run){for(var o=0,s=a.length;s>o;o++)try{a[o]()}catch(l){a.splice(o,1),console.error(l)}return i.hasNative&&i.options.useNative&&!i._isCustomFrameRate?(t(i.update),i):(null==i._timeoutId&&(n=i._frameLength+i._lastTickTime-i.now(),0>n&&(n=0),i._timeoutId=e.setTimeout(function(){i._lastTickTime=i.now(),i._timeoutId=null,i.hasNative&&i.options.useNative?t(i.update):i.update(i.perfNow())},n)),void 0)}},r.stop=function(){r.run=!1},r.addCallback=function(e){var t=r;return t._callbacks.push(e),t.start(),t._callbacks.length},r.removeCallback=function(e){var t=r,n=t._callbacks;return n.slice(e,1),0===n.length&&t.stop(),void 0},e.requestAnimationFrame=r.addCallback,e.cancelAnimationFrame=r.removeCallback}(window),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),"document"in self&&!("classList"in document.createElement("_"))&&function(e){"use strict";if("Element"in e){var t="classList",n="prototype",r=e.Element[n],i=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},u=function(e){for(var t=a.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",""+this)}},c=u[n]=[],d=function(){return new u(this)};if(s[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",-1!==l(this,e)},c.add=function(){var e,t=arguments,n=0,r=t.length,i=!1;do e=t[n]+"",-1===l(this,e)&&(this.push(e),i=!0);while(r>++n);i&&this._updateClassName()},c.remove=function(){var e,t=arguments,n=0,r=t.length,i=!1;do{e=t[n]+"";var a=l(this,e);-1!==a&&(this.splice(a,1),i=!0)}while(r>++n);i&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),!n},c.toString=function(){return this.join(" ")},i.defineProperty){var f={get:d,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,f)}catch(p){-2146823252===p.number&&(f.enumerable=!1,i.defineProperty(r,t,f))}}else i[n].__defineGetter__&&r.__defineGetter__(t,d)}}(self),function(e,t){"use strict";function n(){var n,r;document.body.insertBefore(a,null),n="Transform";for(r in l)n=l[r].length?n:n.charAt(0).toLowerCase()+n.slice(1),a.style[l[r]+n]!==t&&(a.style[l[r]+n]="translate3d(1px,1px,1px)",c=e.getComputedStyle(a).getPropertyValue(o[r]+"transform"),c=c!==t&&c.length>0&&"none"!==c,u.transform=l[r]+n,u.transformCSS=o[r]+"transform");n="Transition";for(r in l)n=l[r].length?n:n.charAt(0).toLowerCase()+n.slice(1),a.style[l[r]+n]!==t&&(u.transition=l[r]+n,u.transitionCSS=o[r]+"transition");return document.body.removeChild(a),!0}var r,i=e.ya||{},a=document.createElement("div"),o="-webkit- -moz- -o- -ms- ".split(" "),s="Webkit Moz O ms ",l=s.split(" "),u={transform:null,transition:null},c=!1;i.CSS3={init:function(){return r=r||n(),this},is:function(e){return null!==u[e]},get:function(e){return u[e]||e},getCSS:function(e){return u[e+"CSS"]},has3d:function(){return c}},i.CSS3.init(),e.ya=i}(window),window.matchMedia||(window.matchMedia=function(){"use strict";var e=window.styleMedia||window.media;if(!e){var t=document.createElement("style"),n=document.getElementsByTagName("script")[0],r=null;t.type="text/css",t.id="matchmediajs-test",n.parentNode.insertBefore(t,n),r="getComputedStyle"in window&&window.getComputedStyle(t,null)||t.currentStyle,e={matchMedium:function(e){var n="@media "+e+"{ #matchmediajs-test { width: 1px; } }";return t.styleSheet?t.styleSheet.cssText=n:t.textContent=n,"1px"===r.width}}}return function(t){return{matches:e.matchMedium(t||"all"),media:t||"all"}}}()),function(){"use strict";if(window.matchMedia&&window.matchMedia("all").addListener)return!1;var e=window.matchMedia,t=e("only all").matches,n=!1,r=0,i=[],a=function(){clearTimeout(r),r=setTimeout(function(){for(var t=0,n=i.length;n>t;t++){var r=i[t].mql,a=i[t].listeners||[],o=e(r.media).matches;if(o!==r.matches){r.matches=o;for(var s=0,l=a.length;l>s;s++)a[s].call(window,r)}}},30)};window.matchMedia=function(r){var o=e(r),s=[],l=0;return o.addListener=function(e){t&&(n||(n=!0,window.addEventListener("resize",a,!0)),0===l&&(l=i.push({mql:o,listeners:s})),s.push(e))},o.removeListener=function(e){for(var t=0,n=s.length;n>t;t++)s[t]===e&&s.splice(t,1)},o}}(),ya.$set("ya","$promise",function(e){"use strict";function t(t){function n(e){return e}function o(e){return c(e)}function s(e){var t=l(),n=0,r=isArray(e)?[]:{};return a(e,function(e,i){n++,u(e).then(function(e){r.hasOwnProperty(i)||(r[i]=e,--n||t.resolve(r))},function(e){r.hasOwnProperty(i)||t.reject(e)})}),0===n&&t.resolve(r),t.promise}var l=function(){var a,s,c=[];return s={resolve:function(t){if(c){var n=c;c=e,a=u(t),n.length&&setTimeout(function(){for(var e,t=0,r=n.length;r>t;t++)e=n[t],a.then(e[0],e[1],e[2])},0)}},reject:function(e){(e instanceof Error||e instanceof r.Error)&&console.log("%cError: ","background: red; color: white;",e,e.stack||e.getStack()),s.resolve(d(e))},notify:function(e){if(c){var t=c;c.length&&setTimeout(function(){for(var n,r=0,i=t.length;i>r;r++)n=t[r],n[2](e)},0)}},promise:{then:function(e,r,s){var u=l(),d=function(r){try{u.resolve((i(e)?e:n)(r))}catch(a){u.reject(a),t(a)}},f=function(e){try{u.resolve((i(r)?r:o)(e))}catch(n){u.reject(n),t(n)}},p=function(e){try{u.notify((i(s)?s:n)(e))}catch(r){t(r)}};return c?c.push([d,f,p]):a.then(d,f,p),u.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=l();return t?n.resolve(e):n.reject(e),n.promise}function r(r,a){var o=null;try{o=(e||n)()}catch(s){return t(s,!1)}return o&&i(o.then)?o.then(function(){return t(r,a)},function(e){return t(e,!1)}):t(r,a)}return this.then(function(e){return r(e,!0)},function(e){return r(e,!1)})}}}},u=function(e){return e&&i(e.then)?e:{then:function(t){var n=l();return setTimeout(function(){n.resolve(t(e))},0),n.promise}}},c=function(e){var t=l();return t.reject(e),t.promise},d=function(e){return{then:function(n,r){var a=l();return setTimeout(function(){try{a.resolve((i(r)?r:o)(e))}catch(n){a.reject(n),t(n)}}),a.promise}}},f=function(e,r,a,s){var d,f=l(),p=function(e){try{return(i(r)?r:n)(e)}catch(a){return t(a),c(a)}},h=function(e){try{return(i(a)?a:o)(e)}catch(n){return t(n),c(n)}},g=function(e){try{return(i(s)?s:n)(e)}catch(r){t(r)}};return setTimeout(function(){u(e).then(function(e){d||(d=!0,f.resolve(u(e).then(p,h,g)))},function(e){d||(d=!0,f.resolve(h(e)))},function(e){d||f.notify(g(e))})}),f.promise};return{deferred:l,reject:c,when:f,all:s}}var n,r=window.ya||{},i=function(e){return"function"==typeof e},a=r.mixins.Array.each,o=[];return n=t(function(e){o.push(e)}),n.getStack=function(){return o},n}()),ya.Core.$extend({module:"ya",alias:"Router",init:function(e){var t=this;return t.__super(e).bindEvents(),t},initDefaults:function(){var e=this;return e.set("routing",{}),e},bindEvents:function(){var e=this;return window.onhashchange=e.onHashChange.bind(e),this},onHashChange:function(){var e=this.get("routing"),t=window.location.hash.substr(1),n=t.split("/"),r=n.shift();if(e[r]){var i=[];if(e[r].params)for(var a=0,o=e[r].params.length;o>a;a++){var s=e[r].params[a],l=n[a],u=RegExp(s.substr(1,s.length-2));i.push(l.match(u).input)}e[r].callback.apply(null,i)}return this},restore:function(){return this.onHashChange(),this},when:function(e,t){var n=this,r=n.get("routing"),i=e.split("/"),a=i.shift();return r[a]={callback:t,params:i},n.set("routing",r),n}}),ya.Core.$extend({module:"ya",alias:"util.$detection",singleton:!0,defaults:{isWorker:null,isCan:null},isWorkerAvail:function(){return this._config.isWorker=this._config.isWorker||window.Worker},isCanvasAvail:function(){return this._config.isCan=this._config.isCan||function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}()}}),ya.Core.$extend({module:"ya",alias:"util.Parallel",defaults:function(){return{data:null,options:{},job:function(){this.addEventListener("message",function(e){console.warn("ya.util.Parallel: Please override default job."),this.postMessage(e.data)})},worker:null,blob:null,promise:null}},init:function(e){var t,n,r,i=this;return i.__super(e),t=URL.createObjectURL(new Blob(["(",""+i.getJob(),")()"],{type:"application/javascript"})),r=ya.$promise.deferred(),n=new Worker(t),URL.revokeObjectURL(i.getBlob()),n.addEventListener("message",function(e){r.resolve({data:e})},!1),n.addEventListener("error",function(e){r.reject({data:e})},!1),i.setBlob(t),i.setWorker(n),i.setPromise(r.promise),i},spawn:function(){var e=this;return e.getWorker().postMessage(e.getData()),e.getPromise()}}),function(){"use strict";function e(e){0===s&&(l=setInterval(function(){n(e)},32)),s=+new Date}function t(e){for(var t,n,i,a=e.toElement||e.relatedTarget||e.target,s=a,l=r.mixins.DOM,u=l.isChild,c=l.isElement;s&&c(s);){if(s.hasAttribute("ya-class")){t=r.view.$manager.getItem(s.getAttribute("id")),t.focus();break}s=s.parentNode}if(!t){for(i=o.length;i--;)n=o[i],n.blur();return void 0}for(i=o.length;c(a)&&i--;)n=o[i],t.getId()!==n.getId()&&(u(n._el,a)||n.blur())}function n(e){var t,n,i,a,o=+new Date;if(o-s>=32)for(clearInterval(l),s=0,t=r.view.$manager.getItems(),i=t.length,a=0;i>a;)n=t[a],n&&n.item.getFit()&&n.item.isInDOM()&&n.item.fireEvent("resize",t[a],e),a++}var r=window.ya,i=document.createElement("style"),a=Array.prototype.slice,o=[],s=0,l=0;i.innerHTML=".ya.inline {display:inline;} .ya.hidden {display: none !important;}",i.setAttribute("type","text/css"),document.body.appendChild(i),window.addEventListener("resize",e),window.addEventListener("mouseup",t),r.Core.$extend({module:"ya",alias:"View",defaults:{id:null,parent:null,children:null,fit:!1,hidden:!1,models:null,collections:null,autoCreate:!1,renderTo:null,renderAt:null,tpl:null,hideCls:"hidden"},mixins:[r.mixins.Array,r.mixins.DOM],init:function(e){var t=this;return t.__super(e).initModels().initTemplate().initParent().initChildren(),r.view.$manager.register(t.getId(),t),t},initRequired:function(){var e=this;if(!e.getTpl())throw r.Error.$create(e.__class__+": no tpl set for "+e.getId(),"YV1");return e},initDefaults:function(){var e=this;return e.getId()?(e.setId(e.getId()),e.set("customId",!0)):(e.setId("view-"+r.view.$manager.getUniqueId()),e.set("customId",!1)),e.setChildren(e.getChildren()||[]),e.setModels(e.getModels()||[]),e.setCollections(e.getCollections()||[]),e.set("eventHandlers",[]),e},initModels:function(){var e=this;return e.each(e.getModels(),function(t,n,i){if(!(t instanceof r.Model)){t.alias||(t.module="ya",t.alias="Model");try{i[n]=r.$factory(t)}catch(a){throw r.Error.$create(e.__class__+": Can not create model","YV2")}}}),e},initTemplate:function(){var e=this,t=e.getTpl();return document.createElement("div"),t instanceof r.view.Template||(t instanceof Array||"array"==typeof t||"string"==typeof t||t instanceof String?t=r.$factory({module:"ya",alias:"view.Template",tpl:t}):(t instanceof Object||"object"==typeof t)&&(t.alias||(t.module="ya",t.alias="view.Template"),t=r.$factory(t))),e.setTpl(t),e},initParent:function(){var e=this,t=e.getParent();return t&&t.getChildren().push(e),e},initChildren:function(){var e=this,t=e.getChildren();return e.each(t,function(t){t.setParent(e)}),e},setModel:function(e){var t=this,n=t.getModels();return e instanceof r.Model||(e.alias||(e.module="ya",e.alias="Model"),e=r.$factory(e)),t.hasModel(e.getNamespace())||(n.push(e),t.setModels(n)),t},hasModel:function(e){var t,n=this.getModels();for(t=n.length;t--;)if(n[t].getNamespace()===e)return!0;return!1},getModel:function(e){var t,n=this,r=n.getModels(),i=null;for(t=r.length;t--;)if(r[t].getNamespace()===e){i=r[t];break}return i},setCollection:function(e){var t=this,n=t.getCollections();return e instanceof r.Collection||(e.alias||(e.module="ya",e.alias="Model"),e=r.$factory(e)),t.hasCollection(e.getId())||(n.push(e),t.setCollections(n)),t},hasCollection:function(e){var t,n=this.getCollections();for(t=n.length;t--;)if(n[t].getId()===e)return!0;return!1},getCollection:function(e){var t,n=this,r=n.getCollections(),i=null;for(t=r.length;t--;)if(r[t].getNamespace()===e){i=r[t];break}return i},compile:function(){var e,t,n=this;return e=n.getTpl().getTDOMInstance(n),t=e.getEDOM(),n.set("tdom",e),n.set("edom",t),n.getHidden()&&n.hide(),n.onCompile(),n.fireEvent("compile",n,e),n},render:function(){var e,t=this,n=t.getParent(),i=t.getRenderTo();e=i instanceof HTMLElement?i:t.getParentNode(i,!0),t.get("tdom")||t.compile(),e&&(t.isInDOM()&&t.clear(),t.prepareElements(),1===t.get("elements").length?t.set("el",t.get("elements")[0]):t.set("el",e),t.hasChildren()&&t.renderChildren(),t.getHidden()&&(t.get("el").classList.add(t.getHideCls()),t.set("visible",!1)),e.insertBefore(t.get("edom"),null===t.getRenderAt()?null:e.childNodes.item(t.getRenderAt())),t.set("isInDOM",!0),(n&&n.isInDOM()||!n)&&r.event.$dispatcher.apply(t),t.onRender(),t.fireEvent("render",t,n))},renderChildren:function(){var e=this;e.each(e.getChildren(),function(t){t.appendTo(e,t.getRenderTo())})},clear:function(){var e=this;return e.blur(),e.removeFromDOM(),e},querySelector:function(e){var t=this,n=t.isInDOM()?t.get("el"):t.get("edom");return n.querySelector(e)||(t.isQueryMatch(e,n)?n:null)},querySelectorAll:function(e){var t=this,n=t.isInDOM()?t.get("el"):t.get("edom"),r=a.call(n.querySelectorAll(e)||[],0);return t.isQueryMatch(e,n)&&r.push(n),r},addChild:function(e,t){var n=this,r=e.getParent();return r&&r.getId()!=n.getId()&&r.removeChild(n),n.getChild(e.getId())||(n.getChildren().push(e),e.setParent(n)),e.appendTo(n,t),n.fireEvent("childAdded",n,e),n},getChild:function(e){var t=this,n=this.getChildren();return 0>t.findChild(e)?null:n[t.findChild(e)]},getChildByClass:function(e){var t,n=this,i=n.getChildren(),a=r.mixins.Array.some;return a(i,function(n,r){return n.__class__===e?(t=r,!0):undefined})?i[t]:null},findChild:function(e){for(var t=this.getChildren(),n=t.length;n--&&t[n].getId()!==e;);return n},removeChild:function(e){for(var t,n=this.getChildren(),r=n.length;r--;)n[r].getId()===e.getId()&&(t=n.splice(r,1)[0],t.removeFromDOM().setParent(null));return t},removeChildren:function(){for(var e=this.getChildren(),t=e.length,n=[];t--;)n.push(e[t].removeFromDOM());return n},removeFromDOM:function(){var e,t=this,n=t.get("el");return t.isInDOM()&&(e=n.parentNode.removeChild(n),t.set("isInDOM",!1),t.get("edom").appendChild(e)),t},isInDOM:function(){return this._isInDOM===!0},getParentEl:function(e,t){var n,r=this,i=r._config.parent;return r.isElement(e)?n=e:i?n=e?i.querySelector(e):i._el:t&&(n=document.querySelector(e)),n},appendTo:function(){var e=this;return e.render(),e},getParentNode:function(e,t){var n,r=this,i=r.getParent();return r.isElement(e)?n=e:i?n=e?i.querySelector(e):i.isInDOM()?i.get("el"):i.get("edom").firstChild:t&&(n=document.querySelector(e)),n},hasChildren:function(){return this.getChildren().length>0},prepareElements:function(){var e=this;return e.set("elements",e.get("edom").childNodes.length>1?Array.prototype.slice.call(e.get("edom").childNodes):[e.get("edom").firstChild]),e},reAppendChildren:function(){for(var e=this.getChildren(),t=e.length,n=0;t>n;n++)e[n].appendTo(this);return this},focus:function(){var e=this,t=r.mixins.Array,n=t.find;if(e._destroyed)return!1;var i=n(o,"_config.id",e.getId());return 0>i&&e.isInDOM()&&(o.push(e),e.set("focused",!0),e.fireEvent("focus",e)),e},blur:function(){var e=this,t=r.mixins.Array.find,n=t(o,"_config.id",e.getId());return n>=0&&(o.splice(n,1),e.set("focused",!1),e.fireEvent("blur")),e},isFocus:function(){return this._focused},isVisible:function(){return this._visible&&this.isInDOM()},hasCustomId:function(){return this._customId},show:function(){var e=this;return e._el?(e._el.classList.remove(e.getHideCls()),e.set("visible",!0),e.fireEvent("show",e),r.Job.$create({config:{repeat:1,task:function(){e.focus()}}}).doIt(),e):e},hide:function(){var e=this;return e._el?(e.blur(),e._el.classList.add(e.getHideCls()),e.set("visible",!1),e.fireEvent("hide",e),e):e},toggle:function(){var e=this;e._visible?e.hide():e.show()},onCompile:function(){},onRender:function(){},destroy:function(){var e=this,t=r.collection.$manager;return e.blur(),e.getParent()&&e.getParent().removeChild(e),e.isInDOM()&&e.clear(),r.view.$manager.deregister(e.getId()),e.each(e.getCollections(),function(e){t.deregister(e.getId())}),e.__super(),e}})}(),ya.Core.$extend({module:"ya",alias:"view.TDOM",defaults:{view:null,DOM:null,bindings:null},mixins:[ya.mixins.Array],init:function(e){var t=this;return t.__super(e).initTDOM(),t},initRequired:function(){var e=this;if(!e.getView())throw ya.Error.$create("ya.view.TDOM requires view object","T2DOM1");if(!e.getDOM())throw ya.Error.$create("ya.view.TDOM requires DOM cloned from template","T2DOM2");if(!e.getBindings())throw ya.Error.$create("ya.view.TDOM requires bindings cloned from template","T2DOM3");return e},initTDOM:function(){var e,t,n,r,i=this,a=i.getView(),o=i.getBindings(),s=i.getDOM(),l=ya.view.Template.$BindingType;return i.each(o,function(o){switch(o.type){case l.IF:o.pointer=s.querySelector('[ya-id="'+o.pointer+'"]'),i.each(o.headers,function(s){e=s[0],r=a.getModel(e),r&&(o.models[e]=r,t=function(e){return function(){i.updateCond(e)}}(o),n="data"+s[1].charAt(0).toUpperCase()+s[1].slice(1)+"Change",o.callbacks.push({namespace:r.getNamespace(),event:n,callback:t}),r.addEventListener(n,t),i.updateCond(o))});break;case l.ATTR:o.pointer=o.fillAttr?s.querySelector('[ya-id="'+o.pointer+'"]'):s.querySelector('[ya-id="'+o.pointer+'"]').attributes.getNamedItem(o.name),i.each(o.headers,function(s){e=s[0],r=a.getModel(e),r&&(o.models[e]=r,t=function(e){return function(){i.updateAttr(e)}}(o),n="data"+s[1].charAt(0).toUpperCase()+s[1].slice(1)+"Change",o.callbacks.push({namespace:r.getNamespace(),event:n,callback:t}),r.addEventListener(n,t),i.updateAttr(o))});break;case l.TEXT:o.pointer=s.querySelector('[ya-id="'+o.pointer+'"]'),i.each(o.headers,function(s){e=s[0],r=a.getModel(e),r&&(o.models[e]=r,t=function(e){return function(){i.updateTxt(e)}}(o),o.callbacks.push({namespace:r.getNamespace(),event:n,callback:t}),n="data"+s[1].charAt(0).toUpperCase()+s[1].slice(1)+"Change",r.addEventListener(n,t),i.updateTxt(o))});break;case l.COL:var u,c,d;o.pointer=s.querySelector('[ya-id="'+o.pointer+'"]'),u=o.collection,u.id?u.pointer=ya.collection.$manager.getItem(u.id):(c=a.getCollections(),i.some(c,u.namespace?function(e){return e.getNamespace()===u.namespace?(u.pointer=e,!0):void 0}:function(e){return e.__class__===u.class?(u.pointer=e,!0):void 0})),u.pointer||(d=u.class.split("."),u.pointer=ya.$factory({module:d.shift(),alias:d.join("."),namespace:u.namespace,id:u.id})),u.pointer&&a.setCollection(u.pointer),i.setupCollection(o);break;case l.MODEL:o.pointer=s.querySelector('[ya-id="'+o.pointer+'"]'),r=o.model,r.pointer=a.getModel(r.namespace),r.pointer||(d=r.class.split("."),r.pointer=ya.$factory({module:d.shift(),alias:d.join("."),namespace:r.namespace}),a.setModel(r.pointer)),i.setupModel(o);break;default:o.pointer=s.querySelector('[ya-id="'+o.pointer+'"]'),i.setupView(o)}}),i.setDOM(s),i.setBindings(o),i},setupModel:function(e){var t,n,r=this,i=e.pointer,a=e.model,o=a.pointer,s=a.property;t=function(e){return function(){r.updateModel(e)}}(e),n=s+"Change",o.addEventListener(n,t,r),i.addEventListener("keyup",function(){o.data(s,i.value)}),r.updateModel(e)},updateCond:function(e){var t,n,r=this,i=e.condition;r.each(e.headers,function(r){t=e.models[r[0]],n=t.data(r[1]),n===void 0&&(n='"undefined"'),i=i.replace("{{"+r.join(".")+"}}",n)}),ya.exec(i)?console.log("TRUE:"):console.log("FALSE:")},updateModel:function(e){var t=e.pointer,n=e.model;t.value=n.pointer.data(n.property)},setupView:function(e){var t,n=this,r=e.view.class.split("."),i={module:r.shift(),alias:r.join("."),renderTo:e.pointer};e.view.id&&(i.id=e.view.id),t=ya.$factory(i),n.getView().addChild(t,e.pointer),e.view=t},setupCollection:function(e){var t,n,r=this,i=e.collection,a=i.pointer;t=function(e){return function(){console.log("update",e),r.updateCollection(e)}}(e),n=function(e){return function(t,n){console.log("remove",e),r.removeFromCollection(e,n)}}(e),e.collection.connections=[],a.each(function(t,n){t.set("index",n),r.generateView(e,t,n)}),r.updateCollection(e),a.addEventListener("prepare",t,r),a.addEventListener("filter",t,r),a.addEventListener("sort",t,r),a.addEventListener("push",t,r),a.addEventListener("remove",n,r)},updateCollection:function(e){var t,n,r,i,a=this,o=Array.prototype.indexOf,s=ya.mixins.Array.find,l=e.collection.pointer,u=e.pointer,c=u.childNodes,d=e.collection.connections;if(a.getView().isInDOM())for(l.each(function(t,l){r=s(d,"model._clientId",t._clientId),r>=0?(n=d[r],i=o.call(c,n.view._el),i>-1&&i!==l&&(c.length-1>l?u.insertBefore(c[l],c[i]):u.appendChild(c[i]))):a.generateView(e,t,l).render()}),t=d.length;t--;)n=d[t],r=s(l._set,"_clientId",n.model._clientId),0>r&&(d.splice(t,1).pop(),n.view.clear());return a},removeFromCollection:function(e,t){var n,r,i,a,o=this,s=ya.mixins.Array.find;for(n=e.collection.connections;t.length;)a=t.pop(),r=s(n,"model._clientId",a._clientId),i=n[r],n.splice(r,1),i.view.destroy();return o},generateView:function(e,t){var n,r=this,i=e.collection,a=ya.view.template.$manager.getItem(i.tpl),o=i.view.split(".");return n=ya.$factory({module:o.shift(),alias:o.join("."),renderTo:e.pointer,parent:r.getView(),tpl:a||void 0,models:[t]}),i.connections.push({view:n,model:t}),n},updateTxt:function(e){var t,n,r,i,a,o,s=this,l=e.original;s.each(e.headers,function(u,c){var d="";if(t=e.models[u[0]],0===u[1].search(/\$/)?n=t.get(u[1].substring(1)):(n=t.data(u[1]),n===void 0&&(n="")),i=s.getView(),e.filters[c].length){a=e.filters[c],i=s.getView();for(var f=0,p=a.length;p>f;f++){o=a[f],d+="||"+o,o=o.split(".");var h;o.length>1?(h=i._config[o[0]],r=h[o[1]]):(h=i,r=i[o[0]]),r&&(n=r.call(h,n,t,i))}}l=l.replace("{{"+u.join(".")+d+"}}",n)}),e.pointer.innerHTML=l},updateAttr:function(e){var t,n,r,i,a,o,s=this,l="",u=!0;e.fillAttr?(s.each(e.headers,function(t){u=u&&e.models[t[0]].data(t[1]),u===void 0&&(u=!1)}),u?e.pointer.setAttribute(e.name,!0):e.pointer.removeAttribute(e.name)):(t=e.original,s.each(e.headers,function(c,d){if(o=e.models[c[0]],0===c[1].search(/\$/)?u=o.get(c[1].substring(1)):(u=o.data(c[1]),(u===void 0||null===u)&&(u="")),n=s.getView(),e.filters[d].length){r=e.filters[d],n=s.getView();for(var f=0,p=r.length;p>f;f++){if(i=r[f],l+="||"+i,i=i.split("."),i.length>1){var h=n._config[i[0]];a=h[i[1]]}else a=n[i[0]];a&&(u=a.call(n.getParent(),u,o,n))}}t=t.replace("{{"+c.join(".")+l+"}}",u)}),e.pointer.value=t)},clear:function(){var e,t,n=ya.mixins.Array.each,r=this,i=r.getBindings();return n(i,function(r){t=r.callbacks,t&&n(r.callbacks,function(t){e=r.models[t.namespace],e.removeEventListener(t.event,t.callback)})}),i.length=0,r},getEDOM:function(){var e,t=this,n=t.getDOM();if(n.childNodes.length>1)for(e=n.firstChild;e;)3!==e.nodeType&&e.classList.add(t.getView().getId()),e=e.nextSibling;else 3!==n.firstChild.nodeType&&n.firstChild.setAttribute("id",t.getView().getId());return n}}),ya.Core.$extend({module:"ya",alias:"view.Template","static":{id:0,DOM4:function(){return!document.createAttribute("rel")instanceof Node},BindingType:{IF:7,MODEL:6,CSS:5,VIEW:4,TEXT:3,ATTR:2,COL:1},types:{td:"tr",tr:"tbody",thead:"table",tfooter:"table",tbody:"table"}},mixins:[ya.mixins.Array],defaults:{id:null,tpl:null,tDOM:null},init:function(e){var t=this;t.__super(e).initRegister().initBindings()},initRequired:function(){var e=this;if(!e.getTpl())throw ya.Error.$create("ya.view.Template: Missing tpl property in configuration object","YVT1");if(!e._html.hasChildNodes())throw ya.Error.$create(e.__class__+": Its seems that object doesnt contain any template","YVT2");return e},initDefaults:function(){var e,t=this,n=t.getTpl(),r=document.createDocumentFragment(),i=ya.view.Template.$types;if(t.setId(t.getId()||"template-"+ya.view.template.$manager.getUniqueId()),t.setTDOM(t.getTDOM()||ya.view.TDOM),Array.isArray(n)){e="";for(var a=0,o=n.length;o>a;a++)e+=n[a];n=e}if("string"==typeof n||n instanceof String){var s,l=n.match(/\<(.*?)[\s|>]/),u=l?l[1]:"",c=i[u]?i[u]:"div",d=document.createElement(c);for(d.innerHTML=n;d.hasChildNodes();)3===d.firstChild.nodeType?(s=document.createElement("span"),s.appendChild(d.firstChild),r.appendChild(s)):r.appendChild(d.firstChild)}else n instanceof DocumentFragment?r=n:n instanceof HTMLElement&&r.appendChild(n.firstChild);return t.set("html",r),t},initRegister:function(){var e=this;return ya.view.template.$manager.register(e.getId(),e),e},initBindings:function(){var e,t,n=this;return t=n.findAttrsBindings(),e=n.findTextBindings(),n.set("bindings",t.concat(e)),n},findAttrsBindings:function(){var e,t,n,r,i,a=this,o=[],s=[],l=/^ya-(.*)/i,u=[],c=Array.prototype.slice,d=ya.view.Template.$DOM4;for(t=document.createTreeWalker(a._html,NodeFilter.SHOW_ELEMENT,null,!1);t.nextNode();)i=t.currentNode,u=c.call(i.attributes),a.isTemplate(i)||(d&&a.each(u,function(e){e.ownerElement=i
}),o=o.concat(u));for(;o.length;){switch(r=o.pop(),n=r.nodeName.match(l),n&&n[1]){case"collection":e=a.prepareColBindings(r);break;case"view":if(r.ownerElement.hasAttribute("ya-if"))continue;e=a.prepareViewBindings(r);break;case"model":e=a.prepareModelBindings(r);break;case"css":e=a.prepareCSSBindings(r);break;case"if":e=a.prepareIfBindings(r);break;default:e=a.prepareAttrBindings(r)}e&&s.push(e)}return s},isTemplate:function(e){for(e=e.parentNode;e.parentNode;){if(e.attributes.getNamedItem("ya-view")||e.attributes.getNamedItem("ya-collection"))return!0;e=e.parentNode}return!1},findTextBindings:function(){var e,t,n=this,r=[];for(t=document.createTreeWalker(n._html,NodeFilter.SHOW_TEXT,null,!1);t.nextNode();)e=n.prepareTextBindings(t.currentNode),e&&r.push(e);return n.each(r,function(e){e.old.parentNode.replaceChild(e.doc,e.old),delete e.doc,delete e.old}),r},prepareTextBindings:function(e){var t,n,r,i,a,o,s,l,u=e.data.match(/\{\{(.*?)\}\}/gi),c=!1;if(u){var d=document.createElement("span"),f=ya.view.Template.$id++;for(d.setAttribute("ya-id",f),t=0,n=u.length,r=[],l=[];n>t;)a=u[t++],i=a.substr(2,a.length-4),o=i.split("||"),i=o[0].split("."),s=o.length>1?o.splice(1):[],l.push(s),r.push(i);c={original:e.value||e.data,old:e,doc:d,models:{},callbacks:[],headers:r,filters:l,type:3,pointer:f}}return c},prepareModelBindings:function(e){var t,n=e.ownerElement,r=n.getAttribute("ya-id")||ya.view.Template.$id++,i=e.value.match(/(?:class|namespace)[?!:]([\w\.]+)/gi),a=n.getAttribute("name")||null,o={pointer:r,type:ya.view.Template.$BindingType.MODEL,model:{"class":"ya.Model",property:a}};if(!a)throw ya.Error.$create("Missing name property in node","YVT3");for(n.setAttribute("ya-id",r);i&&i.length;)t=i.pop().split(":"),o.model[t[0]]=t[1];return o},prepareIfBindings:function(e){var t,n,r,i=e.value,a=i.match(/\{\{(.*?)\}\}/gi),o=e.ownerElement,s=o.getAttribute("ya-id")||ya.view.Template.$id++,l={pointer:s,type:ya.view.Template.$BindingType.IF,condition:i,models:{},callbacks:[]},u=ya.mixins.DOM,c=[],d=0;if(o.setAttribute("ya-id",s),o.hasChildNodes()&&(l.tpl=ya.$factory({module:"ya",alias:"view.Template",tpl:u.removeChildren(o)}).getId()),a){for(r=a.length;r>d;)n=a[d++],t=n.substr(2,n.length-4),t=t.split("."),c.push(t);l.headers=c}return l},prepareColBindings:function(e){var t,n=e.value.match(/(?:class|id|namespace|model|view)[?!:]([\S]+)/gi),r=e.ownerElement,i=r.getAttribute("ya-id")||ya.view.Template.$id++,a={view:"ya.View","class":"ya.Collection"},o={pointer:i,type:ya.view.Template.$BindingType.COL,collection:a},s=ya.mixins.DOM;for(r.setAttribute("ya-id",i);n&&n.length;)t=n.pop().split(":"),a[t[0]]=t[1];if(r.hasChildNodes()){var l=ya.$factory({module:"ya",alias:"view.Template",tpl:s.removeChildren(r)});a.tpl=l.getId()}return o},prepareViewBindings:function(e){var t,n=e.ownerElement,r=n.getAttribute("ya-id")||ya.view.Template.$id++,i=e.value.match(/(?:class|id)[?!:]([\w\.]+)/gi),a={pointer:r,type:ya.view.Template.$BindingType.VIEW,view:{"class":"ya.View"}};for(n.setAttribute("ya-id",r);i&&i.length;)t=i.pop().split(":"),a.view[t[0]]=t[1];return a},prepareCSSBindings:function(e){var t,n,r,i,a,o,s,l,u=e.ownerElement,c=e.value&&e.value.match(/\{\{(.*?)\}\}/gi),d=c&&c.length,f=[],p=0;if(i=u.getAttribute("ya-id"),i||(i=ya.view.Template.$id++,u.setAttribute("ya-id",i)),c)for(s=[];d>p;)l=c[p++],r=l.substr(2,l.length-4),a=r.split("||"),r=a[0].split("."),o=a.length>1?a.splice(1):[],s.push(o),f.push(r);return t=(u.getAttribute("style")||"")+e.value,u.setAttribute("style",t),n={original:t,fillAttr:!1,headers:f,callbacks:[],filters:s,models:{},name:"style",type:ya.view.Template.$BindingType.ATTR,pointer:i}},prepareAttrBindings:function(e){var t,n,r,i,a,o,s,l=e.ownerElement,u=e.value&&e.value.match(/\{\{(.*?)\}\}/gi),c=u&&u.length,d=e.value,f=[],p=0;if(u){for(n=l.getAttribute("ya-id"),n||(n=ya.view.Template.$id++,l.setAttribute("ya-id",n)),s=[];c>p;)i=u[p++],r=i.substr(2,i.length-4),a=r.split("||"),r=a[0].split("."),o=a.length>1?a.splice(1):[],s.push(o),f.push(r);t={fillAttr:ya.mixins.CSSStyle.isFillAttr(e.name),name:e.name,original:d,models:{},callbacks:[],headers:f,filters:s,type:ya.view.Template.$BindingType.ATTR,pointer:n}}return u?t:null},getTDOMInstance:function(e){var t=this;return t.getTDOM().$create({config:{view:e,bindings:ya.$clone(t.get("bindings")),DOM:t.get("html").cloneNode(!0)}})}});
//@ sourceMappingURL=yam-v0.3.0.min.js.map