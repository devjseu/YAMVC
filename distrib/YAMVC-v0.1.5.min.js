/*! YAMVC v0.1.5 - 2013-12-22 
 *  License:  */
(function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend(function(){n.Core.apply(this,arguments)}),e.prototype.init=function(t){n.Core.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=t.config||{},r.set("initOpts",t),r.set("config",e),r.set("set",[]),r.set("cache",[]),r.initConfig()},e.prototype.initConfig=function(){n.Core.prototype.initConfig.apply(this);var t,e=this,r=e.get("config");if(!r.model)throw Error("Set model for collection");if(t=new r.model({config:{namespace:"test"}}),!(t instanceof n.Model))throw Error("Set proper model for collection")},e.prototype.load=function(t){var e,n,r=this,o=(r.get("data"),r.get("idProperty"),0);for(n in t)o++;if(0===o)throw Error("You need to pass at least one condition to load model collection");e=function(){"success"===r.getProxy().getStatus()?(r.set("isDirty",!1),r.prepareData(),r.fireEvent("loaded",r,r.getProxy().getResponse(),"read")):r.fireEvent("error",r,"read")},r.getProxy().read(r.getNamespace(),t,e)},e.prototype.prepareData=function(){for(var t=this,e=t.getModel(),n=t.getProxy().getResult(),r=n.rows,o=[],i=0,s=r.length;s>i;i++)o.push(new e({data:r[i]}));t.set("set",o),t.set("total",n.total)},e.prototype.getRawData=function(){},t.yamvc=n,t.yamvc.Collection=e})(window),function(t){"use strict";var e,n,r=t.yamvc||{};e=r.Core.extend(function(){r.Core.apply(this,arguments)}),e.prototype.init=function(t){var e,o=this;return t=t||{},e=t.config||{},n=n||new r.Router,o.set("initOpts",t),o.set("config",e),o.set("routes",e.routes||{}),o.set("events",e.events||{}),o.set("views",e.views||{}),o.initConfig(),o.renderViews(),o.restoreRouter(),o},e.prototype.initConfig=function(){r.Core.prototype.initConfig.apply(this);var t,e,o=this,i=o.get("routes"),s=o.get("events"),a=o.get("views"),p=/(^\$|,$)/;if(i)for(var c in i)if(i.hasOwnProperty(c)){var u=o[i[c]].bind(o);n.when(c,u)}if(s&&a){for(e in a)a.hasOwnProperty(e)&&a[e].addListener("render",o.resolveEvents.bind(o));for(t in s)if(s.hasOwnProperty(t)&&p.test(t)){if(e=a[t.substr(1)])for(var f in s[t])s[t].hasOwnProperty(f)&&e.addListener(f,s[t][f].bind(o,e));delete s[t]}}return this},e.prototype.renderViews=function(){var t=this,e=t.get("views");for(var n in e)e.hasOwnProperty(n)&&e[n].getAutoCreate&&e[n].getAutoCreate()&&e[n].render()},e.prototype.resolveEvents=function(t){var e,n,r=this.get("events"),o=function(t,e,n){return t.bind(e,n)};for(var i in r)if(r.hasOwnProperty(i)){e=r[i];for(var s=t.get("el").querySelectorAll(i),a=0,p=s.length;p>a;a++)for(var c in e)e.hasOwnProperty(c)&&(n=o(e[c],this,t),s[a].addEventListener(c,n))}},e.prototype.getRouter=function(){return n},e.prototype.restoreRouter=function(){var t=this;return t.getRouter().restore(),t},e.prototype.redirectTo=function(e){return t.location.hash=e,this},t.yamvc.Controller=e}(window),function(t){"use strict";function e(){for(var t=0,e=i.length;e>t;t++)i[t]()}var n,r,o=t.yamvc||{},i=[];o.onReady=function(t){i.push(t),r||"complete"===document.readyState||(r=setInterval(function(){"complete"===document.readyState&&(clearInterval(r),e())},10))},n=o.Core||function(){function t(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}return t.prototype.init=function(){},t.prototype.initConfig=function(){var t,e,n,r=this,o=r.get("config"),i=function(n){t="get"+n.charAt(0).toUpperCase()+n.slice(1),e="set"+n.charAt(0).toUpperCase()+n.slice(1),r[t]=function(){return r.get("config")[n]},r[e]=function(t,e){var n=r.get("config")[t];e!==n&&(r.get("config")[t]=e,r.fireEvent(t+"Change",this,e,n))}};for(n in o)o.hasOwnProperty(n)&&i(n)},t.prototype.bindMethods=function(t){for(var e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(this[e]=t[e].bind(this))},t.prototype.onChange=function(t,e){return this.addListener(t+"Change",e),this},t.prototype.unbindOnChange=function(t,e){for(var n=this._listeners[t+"Change"]||[],r=0,o=n.length;o>r;r++)n[r]===e&&n.splice(r,1);return this._listeners[t+"Change"]=n,this},t.mixin=function(t,e){var n,r;e?n="function"==typeof t?t.prototype:t:(e="function"==typeof t?t.prototype:t,n=this.prototype);for(r in e)"init"!==r?e.hasOwnProperty(r)&&(n[r]=e[r]):"function"==typeof this&&this._mixins.push(e.init)},t._mixins=[],t.extend=function(e){var n,r=this,o={}.hasOwnProperty,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};return n=function(t){return i(e,t),e}(r),n.extend=t.extend,n.mixin=t.mixin,n._mixins=[],n},t.mixin(o.mixins.GetSet),t.mixin(o.mixins.Observable),t}(),o.Core=n,t.yamvc=o}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend(function(){n.Core.apply(this,arguments)}),e.prototype.init=function(t){n.Core.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=t.config||{},r.set("initOpts",t),r.set("config",e),r.initDefaults(),r.initConfig()},e.prototype.initConfig=function(){var t=this;n.Core.prototype.initConfig.apply(this),t.set("lastResponse",{})},e.prototype.initDefaults=function(){var t=this,e=t.get("config");e.propertyResults="results"},e.prototype.read=function(t){if(!t)throw Error("namespace should be set")},e.prototype.create=function(t,e){if(!t)throw Error("namespace should be set");if(!e||"object"!=typeof e)throw Error("Data should be pass as object")},e.prototype.update=function(){},e.prototype.destroy=function(){},e.prototype.update=function(){},e.prototype.setResponse=function(t){return this.set("response",t)},e.prototype.getResponse=function(){return this.get("response")},t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.Proxy=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.data.Proxy;e=r.extend(function(){r.apply(this,arguments)}),e.prototype.init=function(t){r.prototype.init.apply(this,arguments);var e,n=this;t=t||{},e=t.config||{},n.set("initOpts",t),n.set("config",e),n.initConfig()},e.prototype.initConfig=function(){r.prototype.initConfig.apply(this)},e.prototype.read=function(t,e,n){var o=this;r.prototype.read.apply(this,arguments),"Object"==typeof e||o.readById(t,e,n)},e.prototype.readById=function(t,e,n){var r=this,o=[],i={},s={};if(localStorage[t]){o=JSON.parse(localStorage[t]);for(var a=0,p=o.length;p>a;a++)o[a].id===e&&(i=o[a]);if(i.id)return s.success=!0,s.result=i,n(r,s),r}return s.success=!1,s.error=Error("Not found"),n(r,s),r},e.prototype.filter=function(){},e.prototype.executeCondition=function(t,e){var n,r,o,i,s=!1;switch(e.length>3?(r=e[1],n=e[2],o=e[3]):(r=e[0],n=e[1],o=e[2]),n){case">":t[r]>o&&(s=!0);break;case"<":o>t[r]&&(s=!0);break;case">=":t[r]>=o&&(s=!0);break;case"<=":o>=t[r]&&(s=!0);break;case"like":"%"!==o.charAt(0)&&(o="^"+o),"%"!==o.charAt(o.length-1)&&(o+="$"),o=o.replace(/%/g,""),i=RegExp(o),i.test(t[r])&&(s=!0)}return s},e.prototype.create=function(t,e,n){var o=this,i=[],s=0,a={};if(r.prototype.create.apply(this,arguments),localStorage[t]&&(i=JSON.parse(localStorage[t]),s=localStorage[t+"$Sequence"]),Array.isArray(e))for(var p=0,c=e.length;c>p;p++)e[p].id=s++,i.push(e[p]);else e.id=s++,i.push(e);try{localStorage[t]=JSON.stringify(i),localStorage[t+"$Sequence"]=s,a.success=!0,a.result=e}catch(u){a.success=!1,a.error=u}return o.setResponse(a),n(o,a),o},e.prototype.update=function(){},e.prototype.destroy=function(){delete localStorage[model.getNamespace()]},e.prototype.update=function(){},e.clear=function(){for(var t in localStorage)delete localStorage[t]},t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Localstorage=e}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.data.Proxy.extend(function(){var t=this;return n.data.Proxy.apply(t,arguments),t}),e.prototype.init=function(t){var e,r=this;return n.data.Proxy.prototype.init.apply(this,arguments),t=t||{},e=t.config||{},e.idProperty="id",r.set("initOpts",t),r.set("config",e),r.initConfig(),r},e.prototype.getStatus=function(){return this.get("status")},e.prototype.getResponse=function(){return this.get("response")},e.prototype.read=function(t,e,n){var r,o,i,s=this;return o=s.getIdProperty(),"object"==typeof e[o]&&console.log(o),r=s.set.bind(s),i=s.getDb().getConnection().get(t,e[o]),i.done(function(t){r("status","success"),e[o]=t,r("response",e),n()}),i.fail(function(t){r("status","error"),r("response",t),n()}),s},e.prototype.create=function(t,e,n){var r,o,i,s=this;return r=s.set.bind(s),o=s.getIdProperty(),i=s.getDb().getConnection().put({name:t,keyPath:o},e),i.done(function(t){r("status","success"),e[o]=t,r("response",e),n()}),i.fail(function(t){r("status","error"),r("response",t),n()}),s},e.prototype.update=function(t,e,n){var r,o,i=this;return r=i.set.bind(i),o=i.getDb().getConnection().put(t,e),o.done(function(){return r("status","success"),r("response",e),n()}),o.fail(function(t){r("status","error"),r("response",t),n()}),i},e.prototype.destroy=function(t,e,n){var r,o,i,s=this;return o=s.getIdProperty(),r=s.set.bind(s),i=s.getDb().getConnection().remove(t,e[o]),i.done(function(){r("status","success"),r("response",{}),n()}),i.fail(function(t){r("status","error"),r("response",t),n()}),s},t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Ydn=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={set:function(t,e){var n="_"+t,r=this[n];return e!==r&&(this[n]=e,this.fireEvent(t+"Change",this,e,r)),this},get:function(t){return this["_"+t]}},r.GetSet=e,t.yamvc=n,t.yamvc.mixins=r}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(t){if(this._suspendEvents)return!0;var e=!0,n=Array.prototype.shift;n.call(arguments);for(var r=0,o=this._listeners[t]||[],i=o.length;i>r;r++)if(e){var s=n.call(arguments);e=o[r].apply(s,arguments),e=e===undefined?!0:e}return e},addListener:function(t,e){var n=this._listeners[t]||[];return n.push(e),this._listeners[t]=n,this},removeListener:function(t,e){var n,r=this._listeners;if(r)if(e){if("function"==typeof e)for(var o=0,i=r.length;i>o;o++)r[o]===e&&(n=o);else n=e;r.splice(n,1)}else this._listeners=[];return this},suspendEvents:function(t){return t=t||!0,this.set("suspendEvents",t),this}},r.Observable=e,t.yamvc=n,t.yamvc.mixins=r}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend(function(){n.Core.apply(this,arguments)}),e.prototype.init=function(t){n.Core.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=t.config||{},r.set("initOpts",t),r.set("config",e),r.initConfig(),r.initData()},e.prototype.initConfig=function(){var t=this,e=t.get("config");if(n.Core.prototype.initConfig.apply(this),!e.namespace)throw Error("Model need to have namespace property in your model configuration");return this},e.prototype.initData=function(){var t=this,e=t.get("initOpts"),n=t.get("config");t.set("data",e.data||{}),t.set("idProperty",n.idProperty||"id")},e.prototype.$set=function(t,e){var n=this,r=n.get("data"),o=r[t];e!==o&&(r[t]=e,n.set("isDirty",!0),n.fireEvent("data"+t.charAt(0).toUpperCase()+t.slice(1)+"Change",n,e,o))},e.prototype.$get=function(t){var e=this;return e.get("data")[t]},e.prototype.setData=function(t){var e,n=this,r=n.get("data");for(e in t)t.hasOwnProperty(e)&&n.$set(e,t[e]);n.fireEvent("dataChange",n,r)},e.prototype.clear=function(){var t,e=this,n=e.get("data");for(t in n)n.hasOwnProperty(t)&&e.$set(t,null);e.set("data",{}),e.fireEvent("dataChange",e,n)},e.prototype.load=function(t){var e,n,r=this,o=r.get("data"),i=r.get("idProperty"),s=0;for(n in t)s++;if(0===s&&o[i]===undefined)throw Error("You need to pass at least one condition to load model");0===s&&(t[i]=o[i]),e=function(){"success"===r.getProxy().getStatus()?(r.set("isDirty",!1),r.set("data",r.getProxy().getResponse()),r.fireEvent("loaded",r,r.getProxy().getResponse(),"read")):r.fireEvent("error",r,"read")},r.getProxy().read(r.getNamespace(),t,e)},e.prototype.save=function(){var t,e,n=this,r=n.get("data"),o=n.get("idProperty");return n.get("isProcessing")?!1:(n.set("isProcessing",!0),t=function(){n.set("isProcessing",!1),"success"===n.getProxy().getStatus()?(n.set("isDirty",!1),n.set("data",n.getProxy().getResponse()),n.fireEvent("saved",n,n.getProxy().getResponse(),e)):n.fireEvent("error",n,e)},r[o]===undefined?(e="create",n.getProxy().create(n.getNamespace(),r,t)):(e="update",n.getProxy().update(n.getNamespace(),r,t)),!0)},e.prototype.remove=function(){var t,e=this,n=e.get("data"),r=e.get("idProperty");if(n[r]===undefined)throw Error("Can not remove empty model");t=function(){"success"===e.getProxy().getStatus()?(delete n[r],e.set("isDirty",!1),e.set("data",{}),e.fireEvent("removed",e,"destroy")):e.fireEvent("error",e,"destroy")},e.getProxy().destroy(e.getNamespace(),n,t)},t.yamvc=n,t.yamvc.Model=e}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend(function(){n.Core.apply(this)}),e.prototype.init=function(){this.set("routing",{}),this.bindEvents()},e.prototype.bindEvents=function(){return t.onhashchange=this.onHashChange.bind(this),this},e.prototype.onHashChange=function(){var e=this.get("routing"),n=t.location.hash.substr(1),r=n.split("/"),o=r.shift();if(e[o]){var i=[];if(e[o].params)for(var s=0,a=e[o].params.length;a>s;s++){var p=e[o].params[s],c=r[s],u=RegExp(p.substr(1,p.length-2));i.push(c.match(u).input)}e[o].callback.apply(null,i)}return this},e.prototype.restore=function(){return this.onHashChange(),this},e.prototype.when=function(t,e){var n=this.get("routing"),r=t.split("/"),o=r.shift();return n[o]={callback:e,params:r},this.set("routing",n),this},t.yamvc.Router=e}(window),function(t){"use strict";var e,n,r,o=t.yamvc||{};e={views:{},i:0,add:function(t,e){this.views[t]=e,this.i++},get:function(t){return this.views[t]}},n={tpl:{},add:function(t,e){this.tpl[t]=e},get:function(t){return this.tpl[t]}},r=o.Core.extend(function(){o.Core.apply(this,arguments)}),r.prototype.init=function(t){o.Core.prototype.init.apply(this);var n,r,i=this;t=t||{},n=t.config||{},n.id=r=n.id||"view-"+e.i,n.views=n.views||{},i.set("initOpts",t),i.set("config",n),i.initConfig(),e.add(r,i)},r.prototype.initConfig=function(){o.Core.prototype.initConfig.apply(this),this.initTemplate(),this.initModels()},r.prototype.initTemplate=function(){var t,e=this,r=e.get("config"),o=document.createElement("div");if(!r.tpl)throw Error(r.id+": no tpl set");if(!n.get(r.tpl)){if(t=document.getElementById(r.tpl),!t)throw Error("no tpl "+r.tpl+" found");n.add(r.tpl,t.parentNode.removeChild(t))}o.innerHTML=n.get(r.tpl).innerHTML,e.set("tpl",o)},r.prototype.initModels=function(){var t,e,n=this;if(!n.getModels)return n;t=n.getModels();for(e in t)t.hasOwnProperty(e)&&n.setModel(e,t[e]);return n},r.prototype.setModel=function(t,e){var n=this,r=n.getModels();return r[e.getNamespace()]=e,n.setModels(r),n},r.prototype.getModel=function(t){var e=this,n=e.getModels();return n[t]},r.prototype.render=function(t){var e,n,r,o=this,i=o.get("tpl"),s=document.createElement("div"),a=o.get("config"),p=a.renderTo,c=t||a.models,u=a.parent,f=a.parent;if(u?u=p&&u.queryEl(p)?u.queryEl(p):u.get("el"):p&&(u=document.querySelector(p)),r=i.innerHTML,c&&(n=r.match(/\{\{(.*?)\}\}/gi)))for(var d=0,y=n.length;y>d;d++){var l=n[d],g=l.substr(2,l.length-4).split(".");r=c[g[0]]!==undefined&&"function"!=typeof c[g[0]]?r.replace(l,c[g[0]].$get(g[1])):r.replace(l,"")}s.innerHTML=r;for(var h=0;i.childNodes.length>h&&1!==i.childNodes.item(h).nodeType;)h++;return e=s.childNodes.item(h),e.setAttribute("yamvc-id",a.id),o.set("el",e),u&&(u.appendChild(e),f&&(f.views=f.views||{},f.views[a.id]=o),o.set("isInDOM",!0),o.reAppendChildren(),o.fireEvent("render",null,o)),e},r.prototype.partialRender=function(t){var e,n=this,r=n.get("tpl"),o=r.querySelector(t),i=n.queryEl(t),s=o.innerHTML,a=n.getModels();if(e=s.match(/\{\{(.*?)\}\}/gi))for(var p=0,c=e.length;c>p;p++){var u=e[p],f=u.substr(2,u.length-4).split(".");s=a[f[0]]!==undefined&&"function"!=typeof a[f[0]]?s.replace(u,a[f[0]].$get(f[1])):s.replace(u,"")}return i.innerHTML=s,n.fireEvent("partialRender",null,n,i),n},r.prototype.queryEl=function(t){return this.get("el").querySelector(t)},r.prototype.queryEls=function(t){return this.get("el").querySelectorAll(t)},r.prototype.getChild=function(t){var e=this,n=e.get("config");return!n.views||n.views&&!n.views[t]?!1:n.views[t]},r.prototype.addChild=function(t,e){var n=this;return t.appendTo(n,e),n.fireEvent("elementAdded",n,t),n},r.prototype.removeChildren=function(){for(var t=this.get("config").views||[],e=0,n=t.length;n>e;e++)t[e].clear()},r.prototype.clear=function(){var t=this,e=t.get("el");return t.isInDOM()&&(e.parentNode.removeChild(e),t.set("isInDOM",!1)),t},r.prototype.isInDOM=function(){return this._isInDOM},r.prototype.appendTo=function(t,e){var n=this,r=n.get("config"),o=r.id,i=t.get("config").views,s=e?t.get("el").querySelector(e):t.get("el");return e&&(r.renderTo=e),r.parent?r.parent&&r.parent.get("config").id!==t.get("config").id&&delete r.parent.get("config").views[o]:r.parent=t,!n.isInDOM()&&t.isInDOM()&&(n.get("el")?(s.appendChild(n.get("el")),n.set("isInDOM",!0),n.reAppendChildren(),n.fireEvent("render",null,n)):n.render()),i[o]=n,r.parent=t,n},r.prototype.reAppendChildren=function(){var t=this.get("config").views;for(var e in t)t.hasOwnProperty(e)&&t[e].appendTo(this)},r.prototype.show=function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="block",e.set("visible",!0),e.fireEvent("show",e,t),e):e},r.prototype.hide=function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="none",e.set("visible",!1),e.fireEvent("hide",e,t),e):e},r.prototype.isVisible=function(){var t=this;return t.get("visible")&&t.isInDOM()},o.ViewManager=e,t.yamvc=o,t.yamvc.View=r}(window);
//@ sourceMappingURL=YAMVC-v0.1.5.min.js.map