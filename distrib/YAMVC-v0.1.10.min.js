/*! YAMVC v0.1.10 - 2014-01-17 
 *  License:  */
(function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend({defaults:{proxy:null},init:function(t){e.Parent.init.apply(this,arguments);var r,i=this;t=t||{},r=n.merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.set("set",[]),i.set("cache",[]),i.set("removed",[]),i.set("filters",[]),i.initConfig(),i.initData()},initData:function(){var t=this,e=t.get("initOpts"),n=(t.get("config"),e.data||[]);return t.set("raw",n),t.prepareData(n),t},add:function(t){var e,n=this,r=n.getModel(),i=n.getModelConfig().namespace;for(Array.isArray(t)||(t=[t]);t.length;)e=t.pop(),e=new r({config:{namespace:i},data:e}),n._cache.push(e),n.fireEvent("cacheChanged");n.filter()},count:function(){return this._set.length},clear:function(){var t=this;return t.set("set",[]),t.set("cache",[]),t.set("removed",[]),t},clearFilters:function(){var t=this;return t.set("filters",[]),t.filter(),this},filter:function(t){var e,n=this,r=n._filters,i=!0,o=[],a=n._cache,s=0;"function"==typeof t&&(r.push(t),n.fireEvent("filtersChanged"));for(var c=0,u=a.length;u>c;c++){for(i=!0,s=r.length;s--;)e=r[s],i=i&&e(a[c]);i&&o.push(a[c])}return n.set("set",o),n},getAt:function(t){return this._set[t]},getBy:function(t){for(var e=this,n=e._set,r=[],i=0,o=n.length;o>i;i++)t(n[i])&&r.push(n[i]);return r},getOneBy:function(t){for(var e,n=this,r=n._set,i=r.length;i--;)if(t(r[i])){e=r[i];break}return e},getTotal:function(){return this._total},load:function(t){var e,r,i=this,o=(i.get("data"),i.get("idProperty"),n.Promise.deferred()),a=i.getModelConfig().namespace,s=0;for(r in t)s++;if(0===s)throw Error("You need to pass at least one condition to load model collection");if(!i.getProxy())throw Error("To load collection you need to set proxy");return e=function(){"success"===i.getProxy().getStatus()?i.fireEvent("loaded",i,i.getProxy().getResponse(),"read"):i.fireEvent("error",i,"read")},i.getProxy().read(a,t,e),o.promise},save:function(){for(var t,e,r,i=this,o=n.Promise.deferred(),a=[],s=[],c=i._removed,u=i._cache,f=i.getModelConfig(),l=f.namespace,d=i.getProxy(),h=0,p=0,g=u.length;g>p;p++)e=u[p],e._isDirty&&(e.hasId()?s.push(e._data):(e._data.__clientId__=e.get("clientId"),a.push(e._data)));return r=function(t){return function(e){return e.data("id")===t||e.data("__clientId__")===t}},t=function(){h--},a.length&&(h++,d.create(l,a,t)),s.length&&(h++,d.update(l,s,t)),c.length&&(h++,d.destroy(l,c,t)),o.promise},prepareData:function(t,e){var n=this,r=n.getModel(),i=n.getModelConfig?n.getModelConfig():{},o=t.length,a=[];e=e||o;for(var s=0;o>s;s++)a.push(new r({data:t[s],config:i}));return n.set("cache",a),n.set("total",e),n.filter(),n},setData:function(){var t=this;return t.setRawData(data),t.prepareData(data),t},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(t){return this.set("raw",t),this}}),t.yamvc=n,t.yamvc.Collection=e})(window),function(t){"use strict";var e,n,r=t.yamvc||{};e=r.Core.extend({init:function(t){var e,i=this;return t=t||{},e=t.config||{},n=n||new r.Router,i.set("initOpts",t),i.set("config",e),i.set("routes",e.routes||{}),i.set("events",e.events||{}),i.set("views",e.views||{}),i.initConfig(),i.renderViews(),i.restoreRouter(),i},initConfig:function(){r.Core.prototype.initConfig.apply(this);var t,e,i=this,o=i.get("routes"),a=i.get("events"),s=i.get("views"),c=/(^\$|,$)/;if(o)for(var u in o)if(o.hasOwnProperty(u)){var f=i[o[u]].bind(i);n.when(u,f)}if(a&&s){for(e in s)s.hasOwnProperty(e)&&s[e].addListener("render",i.resolveEvents.bind(i));for(t in a)if(a.hasOwnProperty(t)&&c.test(t)){if(e=s[t.substr(1)])for(var l in a[t])a[t].hasOwnProperty(l)&&e.addListener(l,a[t][l].bind(i,e));delete a[t]}}return this},renderViews:function(){var t=this,e=t.get("views");for(var n in e)e.hasOwnProperty(n)&&e[n].getAutoCreate&&e[n].getAutoCreate()&&e[n].render()},resolveEvents:function(t){var e,n,r=this.get("events"),i=function(t,e,n){return t.bind(e,n)};for(var o in r)if(r.hasOwnProperty(o)){e=r[o];for(var a=t.get("el").querySelectorAll(o),s=0,c=a.length;c>s;s++)for(var u in e)e.hasOwnProperty(u)&&(n=i(e[u],this,t),a[s].addEventListener(u,n))}},getRouter:function(){return n},restoreRouter:function(){var t=this;return t.getRouter().restore(),t},redirectTo:function(e){return t.location.hash=e,this}}),t.yamvc.Controller=e}(window),function(t){"use strict";function e(){for(var t=0,e=a.length;e>t;t++)a[t]()}function n(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var r,i,o=t.yamvc||{},a=[];o.onReady=function(t){a.push(t),i||"complete"===document.readyState||(i=setInterval(function(){"complete"===document.readyState&&(clearInterval(i),e())},10))},r=o.Core||function(){function t(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}return t.prototype.init=function(){},t.prototype.initConfig=function(){var t,e,n,r=this,i=r.get("config"),o=function(n){t="get"+n.charAt(0).toUpperCase()+n.slice(1),e="set"+n.charAt(0).toUpperCase()+n.slice(1),r[t]=function(){return r.get("config")[n]},r[e]=function(t){var e=r.get("config")[n];t!==e&&(r.get("config")[n]=t,r.fireEvent(n+"Change",this,t,e))}};for(n in i)i.hasOwnProperty(n)&&o(n)},t.prototype.bindMethods=function(t){for(var e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(this[e]=t[e].bind(this),delete t[e])},t.prototype.onChange=function(t,e){return this.addListener(t+"Change",e),this},t.prototype.unbindOnChange=function(t,e){for(var n=this._listeners[t+"Change"]||[],r=0,i=n.length;i>r;r++)n[r]===e&&n.splice(r,1);return this._listeners[t+"Change"]=n,this},t.mixin=function(t,e){var n,r;e?n="function"==typeof t?t.prototype:t:(e="function"==typeof t?t.prototype:t,n=this.prototype);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r])},t.__mixins__=[],t.__defaults__={},t.extend=function(e){e=e||{};var r=this,i=function(){var e;this._config={};for(e in o)c.call(o,e)&&(this._config[e]=o[e]);t.apply(this,arguments)},o=n(e.defaults||{},r.__defaults__),a=e.mixins||[],s=e.static||{},c={}.hasOwnProperty,u=function(n,r){function i(){this.constructor=n}for(var u in r)c.call(r,u)&&(n[u]=r[u]);i.prototype=r.prototype,n.Parent=r.prototype,n.prototype=new i,n.extend=t.extend,n.mixin=t.mixin,n.__mixins__=[],n.__defaults__=o;for(var f in e)c.call(e,f)&&"function"==typeof e[f]&&(n.prototype[f]=e[f]);for(;a.length;)n.mixin(a.pop());for(var l in s)c.call(s,l)&&(n["$"+l]=s[l]);return n};return u(i,r),i},t.mixin(o.mixins.GetSet),t.mixin(o.mixins.Observable),t}(),o.Core=r,o.merge=n,t.yamvc=o}(window),function(t){"use strict";var e,n,r=t.yamvc||{};n={PENDING:0,SUCCESS:1,FAIL:2},e=r.Core.extend({init:function(t){var i,o=this;e.Parent.init.apply(this,arguments),t=t||{},i=r.merge(o._config,t.config),o.set("initOpts",t),o.set("config",i),o.set("response",{}),o.set("status",n.PENDING),o.initConfig()},setOptions:function(t){return this.set("options",t),this},getOptions:function(){return this._options},setResponse:function(t){return this.set("response",t)},getResponse:function(){return this.get("response")},setStatus:function(t){var e,r=!1;for(e in n)n.hasOwnProperty(e)&&n[e]===t&&(r=!0);if(!r)throw Error("yamvc.data.Action: Wrong status");return this.set("status",t)},getStatus:function(){return this.get("response")}}),e.Status=n,t.yamvc=r,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.Action=e}(window),function(t){"use strict";var e,n,r=t.yamvc||{};n={PENDING:0,SUCCESS:1,FAIL:2},e=r.Core.extend({init:function(t){var n,i=this;e.Parent.init.apply(this,arguments),t=t||{},n=r.merge(i._config,t.config),i.set("initOpts",t),i.set("config",n),i.initConfig()},read:function(t){if(!(t instanceof r.data.Action))throw Error("yamvc.data.Proxy: read argument action should be instance of yamvc.data.Action");if(!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set")},create:function(t){if(!(t instanceof r.data.Action))throw Error("yamvc.data.Proxy: create argument action should be instance of yamvc.data.Action");if(!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("Data should be pass as object")},update:function(t){if(!(t instanceof r.data.Action))throw Error("yamvc.data.Proxy: update argument action should be instance of yamvc.data.Action");if(!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("Data should be pass as object")},destroy:function(t){if(!(t instanceof r.data.Action))throw Error("yamvc.data.Proxy: destroy argument action should be instance of yamvc.data.Action");if(!t.getOption("namespace"))throw Error("yamvc.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("Data should be pass as object")}}),e.Status=n,t.yamvc=r,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.Proxy=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.data.Proxy;e=r.extend({"static":{clear:function(t){var e,n=0;if(t)for(Array.isArray(t)||(t=[t]),n=t.length;n--;)e=t[n],delete localStorage[e],delete localStorage[e+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},init:function(){var t=this;e.Parent.init.apply(t,arguments)},initConfig:function(){e.Parent.initConfig.apply(this)},read:function(t,n,r){var i=this;return e.Parent.read.apply(this,arguments),"object"==typeof n?i.readBy(t,n,r):i.readById(t,n,r),i},readBy:function(t,e,n){var r,i,o,a,s,c,u,f=this,l=e.limit||null,d=e.offset||0,h=e.filters||[],p=e.sorters||[],g={},v=[],y=[],m=!0;return s=function(t,e){var n=""+t[o],r=""+e[o],i=n.toLowerCase(),a=r.toLowerCase();return(i>a?1:a>i?-1:n>r?1:r>n?-1:0)*("desc"===c.toLowerCase()?-1:1)},r=function(){if(localStorage[t]){y=JSON.parse(localStorage[t]);for(var e=0,r=y.length;r>e;e++){for(m=!0,u=h.length;u--;)i=h[u].length>3?h[u][0]:"&&","&&"===i?m=f.executeCondition(y[e],h[u])&&m:"||"===i&&(m=f.executeCondition(y[e],h[u])||m);m&&v.push(y[e])}for(y=v,u=p.length;u--;)a=p[u],o=a[0],c=a[1]||"ASC",y.sort(s);l||(l=y.length-d),(d>0||l)&&(y=y.splice(d,l))}g.success=!0,g.result=y,n(f,g)},setTimeout(r,0),f},readById:function(t,n,r){var i,o=this,a=[],s={},c={};return i=function(){if(localStorage[t]){a=JSON.parse(localStorage[t]);for(var i=0,u=a.length;u>i;i++)a[i].id===n&&(s=a[i]);if(s.id!==undefined)return o.setStatus(e.Status.SUCCESS),c.success=!0,c.result=s,r(o,c),o}o.setStatus(e.Status.FAIL),c.success=!1,c.error=Error("Not found"),r(o,c)},setTimeout(i,0),o},executeCondition:function(t,e){var n,r,i,o,a=!1;switch(e.length>3?(r=e[1],n=e[2],i=e[3]):(r=e[0],n=e[1],i=e[2]),n){case">":t[r]>i&&(a=!0);break;case"<":i>t[r]&&(a=!0);break;case">=":t[r]>=i&&(a=!0);break;case"<=":i>=t[r]&&(a=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),o=RegExp(i),o.test(t[r])&&(a=!0)}return a},create:function(t,n,r){var i,o=this,a=[],s=0,c={};if(e.Parent.create.apply(this,arguments),localStorage[t]&&(a=JSON.parse(localStorage[t]),s=localStorage[t+"$Sequence"]),Array.isArray(n))for(var u=0,f=n.length;f>u;u++)n[u].id=s++,a.push(n[u]);else n.id=s++,a.push(n);return i=function(){try{o.setStatus(e.Status.SUCCESS),localStorage[t]=JSON.stringify(a),localStorage[t+"$Sequence"]=s,c.success=!0,c.result=n}catch(i){o.setStatus(e.Status.FAIL),c.success=!1,c.error=i}o.setResponse(c),r(o,c)},setTimeout(i,0),o},update:function(t,n,r){var i,o,a,s,c=this,u=[],f={},l={};return s=function(){if(localStorage[t]){if(u=JSON.parse(localStorage[t]),Array.isArray(n)){for(o=n.length;o--;)for(a=u.length,i=n[o].id;a--;)u[a].id===i&&(u[a]=n[o]);f=u}else for(o=u.length,i=n.id;o--;)u[o].id===i&&(f=u[o]=n);try{c.setStatus(e.Status.SUCCESS),localStorage[t]=JSON.stringify(u),l.success=!0,l.result=f}catch(s){c.setStatus(e.Status.FAIL),l.success=!1,l.error=s}return r(c,l),c}c.setStatus(e.Status.FAIL),l.success=!1,l.error=Error("Not found"),r(c,l)},setTimeout(s,0),c},destroy:function(t,n,r){var i,o,a,s,c=this,u=[],f={};return s=function(){if(localStorage[t]){if(u=JSON.parse(localStorage[t]),Array.isArray(n))for(o=n.length;o--;)for(a=u.length,i=n[o].id;a--;)u[a].id===i&&u.splice(a,1);else for(o=u.length,i=n.id;o--;)u[o].id===i&&u.splice(o,1);try{c.setStatus(e.Status.SUCCESS),localStorage[t]=JSON.stringify(u),f.success=!0}catch(s){c.setStatus(e.Status.FAIL),f.success=!1,f.error=s}return r(c,f),c}c.setStatus(e.Status.FAIL),f.success=!1,f.error=Error("Not found"),r(c,f)},setTimeout(s,0),c}}),t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Localstorage=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={set:function(t,e){var n="_"+t,r=this[n];return e!==r&&(this[n]=e,this.fireEvent(t+"Change",this,e,r)),this},get:function(t){return this["_"+t]}},r.GetSet=e,t.yamvc=n,t.yamvc.mixins=r}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(){if(this._suspendEvents)return!0;for(var t=!0,e=Array.prototype.shift,n=e.call(arguments),r=0,i=this._listeners[n]||[],o=i.length;o>r;r++)if(t){var a=e.call(arguments);t=i[r].apply(a,arguments),t=t===undefined?!0:t}return t},addListener:function(t,e){var n=this._listeners[t]||[];return n.push(e),this._listeners[t]=n,this},removeListener:function(t,e){var n,r=this._listeners;if(r)if(e){if("function"==typeof e)for(var i=0,o=r.length;o>i;i++)r[i]===e&&(n=i);else n=e;r.splice(n,1)}else this._listeners=[];return this},suspendEvents:function(t){return t=t||!0,this.set("suspendEvents",t),this}},r.Observable=e,t.yamvc=n,t.yamvc.mixins=r}(window),function(t){"use strict";var e,n=t.yamvc||{},r=0;e=n.Core.extend({defaults:{idProperty:"id",proxy:null},init:function(t){n.Core.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=n.merge(r._config,t.config),r.set("initOpts",t),r.set("config",e),r.set("isDirty",!0),r.initConfig(),r.initData()},initConfig:function(){var t=this,e=t.get("config");if(n.Core.prototype.initConfig.apply(this),!e.namespace)throw Error("Model need to have namespace property in your model configuration");return t.set("clientId",e.namespace+"-"+r++),t},initData:function(){var t=this,e=t.get("initOpts");t.get("config"),t.set("data",e.data||{})},setDataProperty:function(t,e){var n=this,r=n._data,i=r[t];e!==i&&(r[t]=e,n.set("isDirty",!0),n.fireEvent("data"+t.charAt(0).toUpperCase()+t.slice(1)+"Change",n,e,i))},getDataProperty:function(t){var e=this;return e.get("data")[t]},data:function(){var t=arguments.length;return t>1?this.setDataProperty.apply(this,arguments):this.getDataProperty.apply(this,arguments)},setData:function(t){var e,n=this,r=n.get("data");for(e in t)t.hasOwnProperty(e)&&n.setDataProperty(e,t[e]);n.fireEvent("dataChange",n,r)},clear:function(){var t,e=this,n=e.get("data");for(t in n)n.hasOwnProperty(t)&&e.data(t,null);e.set("data",{}),e.fireEvent("dataChange",e,n)},load:function(t){var e,r=this,i=r.get("data"),o=r.getIdProperty(),a=n.Promise.deferred(),s=new n.data.Action,c={};if(t[o]===undefined&&i[o]===undefined)throw Error("You need to pass id to load model");return t[o]=i[o],c.namespace=r.getNamespace(),c.params=t,c.callback=function(){e=r.getProxy().getResponse(),"success"===r.getProxy().getStatus()?(r.set("isDirty",!1),r.set("data",e),a.resolve({scope:r,response:e,action:"read"}),r.fireEvent("loaded",r,e,"read")):(a.reject({scope:r,response:e,action:"read"}),r.fireEvent("error",r,e,"read"))},s.setOptions(c),r.getProxy().read(s),a.promise},save:function(){var t,e,r=this,i=r.get("data"),o=r.getIdProperty(),a=n.Promise.deferred(),s=new n.data.Action,c=r.getProxy(),u={};return r.get("isProcessing")||!r.get("isDirty")?!1:(r.set("isProcessing",!0),u.callback=function(){t=r.getProxy().getResponse(),r.set("isProcessing",!1),r.getProxy().getStatus()===n.data.Proxy.Status.SUCCESS?(r.set("isDirty",!1),r.set("data",t.result),a.resolve({scope:r,response:t,action:e}),r.fireEvent("saved",r,t,e)):(a.reject({scope:r,response:t,action:e}),r.fireEvent("error",r,t,e))},s.setOptions(u),i[o]===undefined?(e="create",c.create(s)):(e="update",c.update(r.getNamespace(),i,callback)),a.promise)},remove:function(){var t,e,r=this,i=r.get("data"),o=r.getIdProperty(),a=n.Promise.deferred();if(i[o]===undefined)throw Error("Can not remove empty model");return e=function(){t=r.getProxy().getResponse(),r.getProxy().getStatus()===n.data.Proxy.Status.SUCCESS?(r.set("isDirty",!1),r.set("data",{}),a.resolve({scope:r,response:t,action:type}),r.fireEvent("removed",r,"remove",type)):(a.reject({scope:r,response:t,action:type}),r.fireEvent("error",r,"remove",type))},r.getProxy().destroy(r.getNamespace(),i,e),a.promise},hasId:function(){return!!this._data[this._config.idProperty]}}),t.yamvc=n,t.yamvc.Model=e}(window),function(t){"use strict";var e,n,r,i=t.yamvc||{};n={PENDING:0,FULFILLED:1,REJECTED:2},e=function(t){var e,i,o=this;o._state=n.PENDING,o._queue=[],e=function(t){r(o,t)},i=function(t){o.transition(n.REJECTED,t)},t&&t(e,i)},e.prototype.transition=function(t,e){var r=this;return r._state==t||r._state!==n.PENDING||t!=n.FULFILLED&&t!=n.REJECTED||2>arguments.length?!1:(r._state=t,r._value=e,r.run(),undefined)},e.prototype.run=function(){var t,e,i,o=this;e=function(t){return t},i=function(t){throw t},o._state!=n.PENDING&&setTimeout(function(){for(;o._queue.length;){var a=o._queue.shift();try{t=(o._state==n.FULFILLED?a.fulfill||e:a.reject||i)(o._value)}catch(s){a.promise.transition(n.REJECTED,s);continue}r(a.promise,t)}},0)},e.prototype.then=function(t,n){var r=this,i=new e;return r._queue.push({fulfill:"function"==typeof t&&t,reject:"function"==typeof n&&n,promise:i}),r.run(),i},e.prototype.resolve=function(t,i){if(t===i)t.transition(n.REJECTED,new TypeError);else if(i&&i.constructor==e)i.state==n.PENDING?i.then(function(e){r(t,e)},function(e){t.transition(n.REJECTED,e)}):t.transition(i.state,i.value);else if("object"!=typeof i&&"function"!=typeof i||null===i)t.transition(n.FULFILLED,i);else{var o=!1;try{var a=i.then;"function"==typeof a?a.call(i,function(e){o||(r(t,e),o=!0)},function(e){o||(t.transition(n.REJECTED,e),o=!0)}):t.transition(n.FULFILLED,i)}catch(s){o||t.transition(n.REJECTED,s)}}},e.prototype.getState=function(){return this._state},r=e.prototype.resolve,e.State=n,e.resolved=function(t){return new e(function(e){e(t)})},e.rejected=function(t){return new e(function(e,n){n(t)})},e.deferred=function(){var t,n;return{promise:new e(function(e,r){t=e,n=r}),resolve:t,reject:n}},i.Promise=e,t.yamvc=i}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend({init:function(){this.set("routing",{}),this.bindEvents()},bindEvents:function(){return t.onhashchange=this.onHashChange.bind(this),this},onHashChange:function(){var e=this.get("routing"),n=t.location.hash.substr(1),r=n.split("/"),i=r.shift();if(e[i]){var o=[];if(e[i].params)for(var a=0,s=e[i].params.length;s>a;a++){var c=e[i].params[a],u=r[a],f=RegExp(c.substr(1,c.length-2));o.push(u.match(f).input)}e[i].callback.apply(null,o)}return this},restore:function(){return this.onHashChange(),this},when:function(t,e){var n=this.get("routing"),r=t.split("/"),i=r.shift();return n[i]={callback:e,params:r},this.set("routing",n),this}}),t.yamvc.Router=e}(window),function(t,e){"use strict";function n(t){for(var e={},n=t.split(","),r=0;n.length>r;r++)e[n[r]]=!0;return e}var r,i,o,a,s=t.yamvc||{},c=0;a=n("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),r={views:{},i:0,add:function(t,e){this.views[t]=e,this.i++},get:function(t){return this.views[t]}},i={tpl:{},add:function(t,e){this.tpl[t]=e},get:function(t){return this.tpl[t]}},o=s.Core.extend({init:function(t){s.Core.prototype.init.apply(this);var e,n,i=this;return t=t||{},e=s.merge(i._config,t.config),e.id=n=e.id||"view-"+r.i,e.views=e.views||{},i.set("initOpts",t),i.set("config",e),i.initConfig(),r.add(n,i),i},initConfig:function(){return s.Core.prototype.initConfig.apply(this),this.initTemplate(),this.initModels(),this},initTemplate:function(){var t,e=this,n=e.get("config"),r=document.createElement("div");if(!n.tpl)throw Error(n.id+": no tpl set");if(!i.get(n.tpl)){if(t=document.getElementById(n.tpl),!t)throw Error("no tpl "+n.tpl+" found");i.add(n.tpl,t.parentNode.removeChild(t))}return r.innerHTML=i.get(n.tpl).innerHTML,e.set("tpl",r),e},initModels:function(){var t,e,n=this;if(!n.getModels)return n;t=n.getModels();for(e in t)t.hasOwnProperty(e)&&n.setModel(e,t[e]);return n},setModel:function(t,e){var n=this,r=n.getModels();return r[e.getNamespace()]=e,n.setModels(r),n},getModel:function(t){var e=this,n=e.getModels();return n[t]},render:function(t){var n,r,i,o,s,u,f,l,d,h=this,p=h._tpl,g=h._config,v=g.renderTo,y=t||g.models,m=g.parent,w=g.parent,E=[],C=[],S=0,_=0,P=0,D=0,x=[];for(m?m=v&&m.queryEl(v)?m.queryEl(v):m._el:v&&(m=document.querySelector(v)),s=p.cloneNode(!0),u=document.createTreeWalker(s,NodeFilter.SHOW_ALL,null,!1),f=u.nextNode();f;){if(3===f.nodeType){if(n=f.data.match(/\{\{(.*?)\}\}/gi)){var b=f.nodeValue,O=document.createElement("span"),A="v-r-b-"+c++;for(S=0,D=n.length,C=[],O.setAttribute("id",A);D>S;)r=n[S++],i=r.substr(2,r.length-4).split("."),y[i[0]]?(o=y[i[0]].data(i[1]),o===e&&(o="")):o="",b=b.replace(r,o),C.push(i);O.appendChild(document.createTextNode(b)),E.push({original:f.nodeValue,headers:C,type:3,pointer:O,oldDOM:f})}}else for(x=f.attributes,_=x.length;_--;)if(d=x.item(_),n=d.nodeValue&&d.nodeValue.match(/\{\{(.*?)\}\}/gi)){var N=d.nodeValue,I=a[d.nodeName];for(S=0,D=n.length,C=[],o=I?!0:"";D>S;)r=n[S++],i=r.substr(2,r.length-4).split("."),I?o=o&&y[i[0]].data(i[1]):(y[i[0]]&&(o=y[i[0]].data(i[1])||""),d.nodeValue=d.nodeValue.replace(r,o)),C.push(i);I&&!o?f.removeAttribute(d.nodeName):f.setAttribute(d.nodeName,o),E.push({original:N,headers:C,fillAttr:I||!1,type:2,attrName:d.nodeName,pointer:f})}f=u.nextNode()}for(;p.childNodes.length>P&&1!==p.childNodes.item(P).nodeType;)P++;return l=s.childNodes.item(P),l.setAttribute("yamvc-id",g.id),h.set("el",l),h.set("bindings",E),h.resolveBindings(),m&&(m.appendChild(l),w&&(w.views=w.views||{},w.views[g.id]=h),h.set("isInDOM",!0),h.reAppendChildren(),h.fireEvent("render",null,h)),l},resolveBindings:function(){var t,e,n,r,i,o,a=this,s=a._bindings,c=a._config.models,u=0,f=0;for(t=function(t){return function(){a.partialRender(t)}},f=s.length;f--;)for(i=s[f],n=i.headers,3===i.type&&(i.oldDOM.parentNode.replaceChild(i.pointer,i.oldDOM),delete i.oldDOM),u=n.length;u--;)e=c[n[u][0]],r=n[u][1],e&&(o=r.charAt(0).toUpperCase()+r.slice(1),e.addListener("data"+o+"Change",t(i)))},partialRender:function(t){for(var e,n=3===t.type,r=n?t.original:!0,i=this._config.models,o=t.headers,a=o.length;a--;)e=o[a],r=n||!t.fillAttr?r.replace("{{"+e.join(".")+"}}",i[e[0]].data(e[1])):r&&i[e[0]].data(e[1]);n?t.pointer.textContent=r:t.fillAttr&&!r?t.pointer.removeAttribute(t.attrName):t.pointer.setAttribute(t.attrName,r)},queryEl:function(t){return this.get("el").querySelector(t)},queryEls:function(t){return this.get("el").querySelectorAll(t)},getChild:function(t){var e=this,n=e.get("config");return!n.views||n.views&&!n.views[t]?!1:n.views[t]},addChild:function(t,e){var n=this;return t.appendTo(n,e),n.fireEvent("elementAdded",n,t),n},removeChildren:function(){for(var t=this.get("config").views||[],e=0,n=t.length;n>e;e++)t[e].clear();return this},clear:function(){var t=this,e=t.get("el");return t.isInDOM()&&(e.parentNode.removeChild(e),t.set("isInDOM",!1)),t},isInDOM:function(){return this._isInDOM},appendTo:function(t,e){var n=this,r=n.get("config"),i=r.id,o=t.get("config").views,a=e?t.get("el").querySelector(e):t.get("el");return e&&(r.renderTo=e),r.parent?r.parent&&r.parent.get("config").id!==t.get("config").id&&delete r.parent.get("config").views[i]:r.parent=t,!n.isInDOM()&&t.isInDOM()&&(n.get("el")?(a.appendChild(n.get("el")),n.set("isInDOM",!0),n.reAppendChildren(),n.fireEvent("render",null,n)):n.render()),o[i]=n,r.parent=t,n},reAppendChildren:function(){var t=this.get("config").views;for(var e in t)t.hasOwnProperty(e)&&t[e].appendTo(this);return this},show:function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="block",e.set("visible",!0),e.fireEvent("show",e,t),e):e},hide:function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="none",e.set("visible",!1),e.fireEvent("hide",e,t),e):e},isVisible:function(){return this.get("visible")&&this.isInDOM()}}),s.ViewManager=r,t.yamvc=s,t.yamvc.View=o}(window);
//@ sourceMappingURL=YAMVC-v0.1.10.min.js.map