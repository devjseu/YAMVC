/*! YAMVC v0.1.5 - 2013-12-29 
 *  License:  */
(function(t){"use strict";var e,r=t.yamvc||{};e=r.Core.extend(function(){r.Core.apply(this,arguments)}),e.prototype.init=function(t){r.Core.prototype.init.apply(this,arguments);var e,n=this;t=t||{},e=t.config||{},n.set("initOpts",t),n.set("config",e),n.set("set",[]),n.set("cache",[]),n.initConfig()},e.prototype.initConfig=function(){r.Core.prototype.initConfig.apply(this);var t,e=this,n=e.get("config");if(!n.model)throw Error("Set model for collection");if(t=new n.model({config:{namespace:"test"}}),!(t instanceof r.Model))throw Error("Set proper model for collection")},e.prototype.load=function(t){var e,r,n=this,o=(n.get("data"),n.get("idProperty"),0);for(r in t)o++;if(0===o)throw Error("You need to pass at least one condition to load model collection");e=function(){"success"===n.getProxy().getStatus()?(n.set("isDirty",!1),n.prepareData(),n.fireEvent("loaded",n,n.getProxy().getResponse(),"read")):n.fireEvent("error",n,"read")},n.getProxy().read(n.getNamespace(),t,e)},e.prototype.prepareData=function(){for(var t=this,e=t.getModel(),r=t.getRawData(),n=r.rows,o=[],i=0,s=n.length;s>i;i++)o.push(new e({data:n[i]}));t.set("set",o),t.set("total",r.total)},e.prototype.getRawData=function(){return this.get("raw")},e.prototype.setRawData=function(t){return this.set("raw",t),this},t.yamvc=r,t.yamvc.Collection=e})(window),function(t){"use strict";var e,r,n=t.yamvc||{};e=n.Core.extend(function(){n.Core.apply(this,arguments)}),e.prototype.init=function(t){var e,o=this;return t=t||{},e=t.config||{},r=r||new n.Router,o.set("initOpts",t),o.set("config",e),o.set("routes",e.routes||{}),o.set("events",e.events||{}),o.set("views",e.views||{}),o.initConfig(),o.renderViews(),o.restoreRouter(),o},e.prototype.initConfig=function(){n.Core.prototype.initConfig.apply(this);var t,e,o=this,i=o.get("routes"),s=o.get("events"),a=o.get("views"),p=/(^\$|,$)/;if(i)for(var c in i)if(i.hasOwnProperty(c)){var u=o[i[c]].bind(o);r.when(c,u)}if(s&&a){for(e in a)a.hasOwnProperty(e)&&a[e].addListener("render",o.resolveEvents.bind(o));for(t in s)if(s.hasOwnProperty(t)&&p.test(t)){if(e=a[t.substr(1)])for(var f in s[t])s[t].hasOwnProperty(f)&&e.addListener(f,s[t][f].bind(o,e));delete s[t]}}return this},e.prototype.renderViews=function(){var t=this,e=t.get("views");for(var r in e)e.hasOwnProperty(r)&&e[r].getAutoCreate&&e[r].getAutoCreate()&&e[r].render()},e.prototype.resolveEvents=function(t){var e,r,n=this.get("events"),o=function(t,e,r){return t.bind(e,r)};for(var i in n)if(n.hasOwnProperty(i)){e=n[i];for(var s=t.get("el").querySelectorAll(i),a=0,p=s.length;p>a;a++)for(var c in e)e.hasOwnProperty(c)&&(r=o(e[c],this,t),s[a].addEventListener(c,r))}},e.prototype.getRouter=function(){return r},e.prototype.restoreRouter=function(){var t=this;return t.getRouter().restore(),t},e.prototype.redirectTo=function(e){return t.location.hash=e,this},t.yamvc.Controller=e}(window),function(t){"use strict";function e(){for(var t=0,e=i.length;e>t;t++)i[t]()}var r,n,o=t.yamvc||{},i=[];o.onReady=function(t){i.push(t),n||"complete"===document.readyState||(n=setInterval(function(){"complete"===document.readyState&&(clearInterval(n),e())},10))},r=o.Core||function(){function t(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}return t.prototype.init=function(){},t.prototype.initConfig=function(){var t,e,r,n=this,o=n.get("config"),i=function(r){t="get"+r.charAt(0).toUpperCase()+r.slice(1),e="set"+r.charAt(0).toUpperCase()+r.slice(1),n[t]=function(){return n.get("config")[r]},n[e]=function(t,e){var r=n.get("config")[t];e!==r&&(n.get("config")[t]=e,n.fireEvent(t+"Change",this,e,r))}};for(r in o)o.hasOwnProperty(r)&&i(r)},t.prototype.bindMethods=function(t){for(var e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(this[e]=t[e].bind(this))},t.prototype.onChange=function(t,e){return this.addListener(t+"Change",e),this},t.prototype.unbindOnChange=function(t,e){for(var r=this._listeners[t+"Change"]||[],n=0,o=r.length;o>n;n++)r[n]===e&&r.splice(n,1);return this._listeners[t+"Change"]=r,this},t.mixin=function(t,e){var r,n;e?r="function"==typeof t?t.prototype:t:(e="function"==typeof t?t.prototype:t,r=this.prototype);for(n in e)"init"!==n?e.hasOwnProperty(n)&&(r[n]=e[n]):"function"==typeof this&&this._mixins.push(e.init)},t._mixins=[],t.extend=function(e){var r,n=this,o={}.hasOwnProperty,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};return r=function(t){return i(e,t),e}(n),r.extend=t.extend,r.mixin=t.mixin,r._mixins=[],r},t.mixin(o.mixins.GetSet),t.mixin(o.mixins.Observable),t}(),o.Core=r,t.yamvc=o}(window),function(t){"use strict";var e,r=t.yamvc||{};e=r.Core.extend(function(){r.Core.apply(this,arguments)}),e.prototype.init=function(t){r.Core.prototype.init.apply(this,arguments);var e,n=this;t=t||{},e=t.config||{},n.set("initOpts",t),n.set("config",e),n.initDefaults(),n.initConfig()},e.prototype.initConfig=function(){var t=this;r.Core.prototype.initConfig.apply(this),t.set("lastResponse",{})},e.prototype.initDefaults=function(){var t=this,e=t.get("config");e.propertyResults="results"},e.prototype.read=function(t){if(!t)throw Error("namespace should be set")},e.prototype.create=function(t,e){if(!t)throw Error("namespace should be set");if(!e||"object"!=typeof e)throw Error("Data should be pass as object")},e.prototype.update=function(){},e.prototype.destroy=function(){},e.prototype.update=function(){},e.prototype.setResponse=function(t){return this.set("response",t)},e.prototype.getResponse=function(){return this.get("response")},t.yamvc=r,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.Proxy=e}(window),function(t){"use strict";var e,r=t.yamvc||{},n=r.data.Proxy;e=n.extend(function(){n.apply(this,arguments)}),e.prototype.init=function(t){n.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=t.config||{},r.set("initOpts",t),r.set("config",e),r.initConfig()},e.prototype.initConfig=function(){n.prototype.initConfig.apply(this)},e.prototype.read=function(t,e,r){var o=this;n.prototype.read.apply(this,arguments),"object"==typeof e?o.readBy(t,e,r):o.readById(t,e,r)},e.prototype.readBy=function(t,e,r){var n,o,i,s,a,p,c=this,u=e.limit||null,f=e.offset||0,l=e.filters||[],d=e.sorters||[],y={},g=[],h=[],v=!0;if(s=function(t,e){var r=""+t[o],n=""+e[o],i=r.name.toLowerCase(),s=n.name.toLowerCase();return(i>s?1:s>i?-1:r.name>n.name?1:r.name<n.name?-1:0)*("desc"===a.toLowerCase()?-1:1)},localStorage[t]){h=JSON.parse(localStorage[t]);for(var m=0,w=h.length;w>m;m++){for(v=!0,p=l.length;p--;)n=l[p].length>3?l[p][0]:"&&","&&"===n?v=c.executeCondition(h[m],l[p])&&v:"||"===n&&(v=c.executeCondition(h[m],l[p])||v);v&&g.push(h[m])}for(h=g,p=d.length;p--;)i=d[p],o=i[0],a=i[1]||"ASC",h.sort(s);u||(u=h.length-f),(f>0||u)&&(h=h.splice(f,u))}return y.success=!0,y.result=h,r(c,y),c},e.prototype.readById=function(t,e,r){var n=this,o=[],i={},s={};if(localStorage[t]){o=JSON.parse(localStorage[t]);for(var a=0,p=o.length;p>a;a++)o[a].id===e&&(i=o[a]);if(i.id!==undefined)return s.success=!0,s.result=i,r(n,s),n}return s.success=!1,s.error=Error("Not found"),r(n,s),n},e.prototype.executeCondition=function(t,e){var r,n,o,i,s=!1;switch(e.length>3?(n=e[1],r=e[2],o=e[3]):(n=e[0],r=e[1],o=e[2]),r){case">":t[n]>o&&(s=!0);break;case"<":o>t[n]&&(s=!0);break;case">=":t[n]>=o&&(s=!0);break;case"<=":o>=t[n]&&(s=!0);break;case"like":"%"!==o.charAt(0)&&(o="^"+o),"%"!==o.charAt(o.length-1)&&(o+="$"),o=o.replace(/%/g,""),i=RegExp(o),i.test(t[n])&&(s=!0)}return s},e.prototype.create=function(t,e,r){var o=this,i=[],s=0,a={};if(n.prototype.create.apply(this,arguments),localStorage[t]&&(i=JSON.parse(localStorage[t]),s=localStorage[t+"$Sequence"]),Array.isArray(e))for(var p=0,c=e.length;c>p;p++)e[p].id=s++,i.push(e[p]);else e.id=s++,i.push(e);try{localStorage[t]=JSON.stringify(i),localStorage[t+"$Sequence"]=s,a.success=!0,a.result=e}catch(u){a.success=!1,a.error=u}return o.setResponse(a),r(o,a),o},e.prototype.update=function(t,e,r){var n,o,i,s=this,a=[],p={},c={};if(localStorage[t]){if(a=JSON.parse(localStorage[t]),Array.isArray(e)){for(o=e.length;o--;)for(i=a.length,n=e[o].id;i--;)a[i].id===n&&(a[i]=e[o]);p=a}else for(o=a.length,n=e.id;o--;)a[o].id===n&&(p=a[o]=e);try{localStorage[t]=JSON.stringify(a),c.success=!0,c.result=p}catch(u){c.success=!1,c.error=u}return r(s,c),s}return c.success=!1,c.error=Error("Not found"),r(s,c),s},e.prototype.destroy=function(t,e,r){var n,o,i,s=this,a=[],p={};if(localStorage[t]){if(a=JSON.parse(localStorage[t]),Array.isArray(e))for(o=e.length;o--;)for(i=a.length,n=e[o].id;i--;)a[i].id===n&&a.splice(i,1);else for(o=a.length,n=e.id;o--;)a[o].id===n&&a.splice(o,1);try{localStorage[t]=JSON.stringify(a),p.success=!0}catch(c){p.success=!1,p.error=c}return r(s,p),s}return p.success=!1,p.error=Error("Not found"),r(s,p),s},e.clear=function(t){var e,r=0;if(t)for(Array.isArray(t)||(t=[t]),r=t.length;r--;)e=t[r],delete localStorage[e],delete localStorage[e+"$Sequence"];else for(var n in localStorage)delete localStorage[n],delete localStorage[n+"$Sequence"]},t.yamvc=r,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Localstorage=e}(window),function(t){"use strict";var e,r=t.yamvc||{};e=r.data.Proxy.extend(function(){var t=this;return r.data.Proxy.apply(t,arguments),t}),e.prototype.init=function(t){var e,n=this;return r.data.Proxy.prototype.init.apply(this,arguments),t=t||{},e=t.config||{},e.idProperty="id",n.set("initOpts",t),n.set("config",e),n.initConfig(),n},e.prototype.getStatus=function(){return this.get("status")},e.prototype.getResponse=function(){return this.get("response")},e.prototype.read=function(t,e,r){var n,o,i,s=this;return o=s.getIdProperty(),"object"==typeof e[o]&&console.log(o),n=s.set.bind(s),i=s.getDb().getConnection().get(t,e[o]),i.done(function(t){n("status","success"),e[o]=t,n("response",e),r()}),i.fail(function(t){n("status","error"),n("response",t),r()}),s},e.prototype.create=function(t,e,r){var n,o,i,s=this;return n=s.set.bind(s),o=s.getIdProperty(),i=s.getDb().getConnection().put({name:t,keyPath:o},e),i.done(function(t){n("status","success"),e[o]=t,n("response",e),r()}),i.fail(function(t){n("status","error"),n("response",t),r()}),s},e.prototype.update=function(t,e,r){var n,o,i=this;return n=i.set.bind(i),o=i.getDb().getConnection().put(t,e),o.done(function(){return n("status","success"),n("response",e),r()}),o.fail(function(t){n("status","error"),n("response",t),r()}),i},e.prototype.destroy=function(t,e,r){var n,o,i,s=this;return o=s.getIdProperty(),n=s.set.bind(s),i=s.getDb().getConnection().remove(t,e[o]),i.done(function(){n("status","success"),n("response",{}),r()}),i.fail(function(t){n("status","error"),n("response",t),r()}),s},t.yamvc=r,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Ydn=e}(window),function(t){"use strict";var e,r=t.yamvc||{},n=r.mixins||{};e={set:function(t,e){var r="_"+t,n=this[r];return e!==n&&(this[r]=e,this.fireEvent(t+"Change",this,e,n)),this},get:function(t){return this["_"+t]}},n.GetSet=e,t.yamvc=r,t.yamvc.mixins=n}(window),function(t){"use strict";var e,r=t.yamvc||{},n=r.mixins||{};e={init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(t){if(this._suspendEvents)return!0;var e=!0,r=Array.prototype.shift;r.call(arguments);for(var n=0,o=this._listeners[t]||[],i=o.length;i>n;n++)if(e){var s=r.call(arguments);e=o[n].apply(s,arguments),e=e===undefined?!0:e}return e},addListener:function(t,e){var r=this._listeners[t]||[];return r.push(e),this._listeners[t]=r,this},removeListener:function(t,e){var r,n=this._listeners;if(n)if(e){if("function"==typeof e)for(var o=0,i=n.length;i>o;o++)n[o]===e&&(r=o);else r=e;n.splice(r,1)}else this._listeners=[];return this},suspendEvents:function(t){return t=t||!0,this.set("suspendEvents",t),this}},n.Observable=e,t.yamvc=r,t.yamvc.mixins=n}(window),function(t){"use strict";var e,r=t.yamvc||{};e=r.Core.extend(function(){r.Core.apply(this,arguments)}),e.prototype.init=function(t){r.Core.prototype.init.apply(this,arguments);var e,n=this;t=t||{},e=t.config||{},n.set("initOpts",t),n.set("config",e),n.initConfig(),n.initData()},e.prototype.initConfig=function(){var t=this,e=t.get("config");if(r.Core.prototype.initConfig.apply(this),!e.namespace)throw Error("Model need to have namespace property in your model configuration");return this},e.prototype.initData=function(){var t=this,e=t.get("initOpts"),r=t.get("config");t.set("data",e.data||{}),t.set("idProperty",r.idProperty||"id")},e.prototype.$set=function(t,e){var r=this,n=r.get("data"),o=n[t];e!==o&&(n[t]=e,r.set("isDirty",!0),r.fireEvent("data"+t.charAt(0).toUpperCase()+t.slice(1)+"Change",r,e,o))},e.prototype.$get=function(t){var e=this;return e.get("data")[t]},e.prototype.setData=function(t){var e,r=this,n=r.get("data");for(e in t)t.hasOwnProperty(e)&&r.$set(e,t[e]);r.fireEvent("dataChange",r,n)},e.prototype.clear=function(){var t,e=this,r=e.get("data");for(t in r)r.hasOwnProperty(t)&&e.$set(t,null);e.set("data",{}),e.fireEvent("dataChange",e,r)},e.prototype.load=function(t){var e,r,n=this,o=n.get("data"),i=n.get("idProperty"),s=0;for(r in t)s++;if(0===s&&o[i]===undefined)throw Error("You need to pass at least one condition to load model");0===s&&(t[i]=o[i]),e=function(){"success"===n.getProxy().getStatus()?(n.set("isDirty",!1),n.set("data",n.getProxy().getResponse()),n.fireEvent("loaded",n,n.getProxy().getResponse(),"read")):n.fireEvent("error",n,"read")},n.getProxy().read(n.getNamespace(),t,e)},e.prototype.save=function(){var t,e,r=this,n=r.get("data"),o=r.get("idProperty");return r.get("isProcessing")?!1:(r.set("isProcessing",!0),t=function(){r.set("isProcessing",!1),"success"===r.getProxy().getStatus()?(r.set("isDirty",!1),r.set("data",r.getProxy().getResponse()),r.fireEvent("saved",r,r.getProxy().getResponse(),e)):r.fireEvent("error",r,e)},n[o]===undefined?(e="create",r.getProxy().create(r.getNamespace(),n,t)):(e="update",r.getProxy().update(r.getNamespace(),n,t)),!0)},e.prototype.remove=function(){var t,e=this,r=e.get("data"),n=e.get("idProperty");if(r[n]===undefined)throw Error("Can not remove empty model");t=function(){"success"===e.getProxy().getStatus()?(delete r[n],e.set("isDirty",!1),e.set("data",{}),e.fireEvent("removed",e,"destroy")):e.fireEvent("error",e,"destroy")},e.getProxy().destroy(e.getNamespace(),r,t)},t.yamvc=r,t.yamvc.Model=e}(window),function(t){"use strict";var e,r=t.yamvc||{};e=r.Core.extend(function(){r.Core.apply(this)}),e.prototype.init=function(){this.set("routing",{}),this.bindEvents()},e.prototype.bindEvents=function(){return t.onhashchange=this.onHashChange.bind(this),this},e.prototype.onHashChange=function(){var e=this.get("routing"),r=t.location.hash.substr(1),n=r.split("/"),o=n.shift();if(e[o]){var i=[];if(e[o].params)for(var s=0,a=e[o].params.length;a>s;s++){var p=e[o].params[s],c=n[s],u=RegExp(p.substr(1,p.length-2));i.push(c.match(u).input)}e[o].callback.apply(null,i)}return this},e.prototype.restore=function(){return this.onHashChange(),this},e.prototype.when=function(t,e){var r=this.get("routing"),n=t.split("/"),o=n.shift();return r[o]={callback:e,params:n},this.set("routing",r),this},t.yamvc.Router=e}(window),function(t){"use strict";var e,r,n,o=t.yamvc||{};e={views:{},i:0,add:function(t,e){this.views[t]=e,this.i++},get:function(t){return this.views[t]}},r={tpl:{},add:function(t,e){this.tpl[t]=e},get:function(t){return this.tpl[t]}},n=o.Core.extend(function(){o.Core.apply(this,arguments)}),n.prototype.init=function(t){o.Core.prototype.init.apply(this);var r,n,i=this;t=t||{},r=t.config||{},r.id=n=r.id||"view-"+e.i,r.views=r.views||{},i.set("initOpts",t),i.set("config",r),i.initConfig(),e.add(n,i)},n.prototype.initConfig=function(){o.Core.prototype.initConfig.apply(this),this.initTemplate(),this.initModels()},n.prototype.initTemplate=function(){var t,e=this,n=e.get("config"),o=document.createElement("div");if(!n.tpl)throw Error(n.id+": no tpl set");if(!r.get(n.tpl)){if(t=document.getElementById(n.tpl),!t)throw Error("no tpl "+n.tpl+" found");r.add(n.tpl,t.parentNode.removeChild(t))}o.innerHTML=r.get(n.tpl).innerHTML,e.set("tpl",o)},n.prototype.initModels=function(){var t,e,r=this;if(!r.getModels)return r;t=r.getModels();for(e in t)t.hasOwnProperty(e)&&r.setModel(e,t[e]);return r},n.prototype.setModel=function(t,e){var r=this,n=r.getModels();return n[e.getNamespace()]=e,r.setModels(n),r},n.prototype.getModel=function(t){var e=this,r=e.getModels();return r[t]},n.prototype.render=function(t){var e,r,n,o=this,i=o.get("tpl"),s=document.createElement("div"),a=o.get("config"),p=a.renderTo,c=t||a.models,u=a.parent,f=a.parent;if(u?u=p&&u.queryEl(p)?u.queryEl(p):u.get("el"):p&&(u=document.querySelector(p)),n=i.innerHTML,c&&(r=n.match(/\{\{(.*?)\}\}/gi)))for(var l=0,d=r.length;d>l;l++){var y=r[l],g=y.substr(2,y.length-4).split(".");n=c[g[0]]!==undefined&&"function"!=typeof c[g[0]]?n.replace(y,c[g[0]].$get(g[1])):n.replace(y,"")}s.innerHTML=n;for(var h=0;i.childNodes.length>h&&1!==i.childNodes.item(h).nodeType;)h++;return e=s.childNodes.item(h),e.setAttribute("yamvc-id",a.id),o.set("el",e),u&&(u.appendChild(e),f&&(f.views=f.views||{},f.views[a.id]=o),o.set("isInDOM",!0),o.reAppendChildren(),o.fireEvent("render",null,o)),e},n.prototype.partialRender=function(t){var e,r=this,n=r.get("tpl"),o=n.querySelector(t),i=r.queryEl(t),s=o.innerHTML,a=r.getModels();if(e=s.match(/\{\{(.*?)\}\}/gi))for(var p=0,c=e.length;c>p;p++){var u=e[p],f=u.substr(2,u.length-4).split(".");s=a[f[0]]!==undefined&&"function"!=typeof a[f[0]]?s.replace(u,a[f[0]].$get(f[1])):s.replace(u,"")}return i.innerHTML=s,r.fireEvent("partialRender",null,r,i),r},n.prototype.queryEl=function(t){return this.get("el").querySelector(t)},n.prototype.queryEls=function(t){return this.get("el").querySelectorAll(t)},n.prototype.getChild=function(t){var e=this,r=e.get("config");return!r.views||r.views&&!r.views[t]?!1:r.views[t]},n.prototype.addChild=function(t,e){var r=this;return t.appendTo(r,e),r.fireEvent("elementAdded",r,t),r},n.prototype.removeChildren=function(){for(var t=this.get("config").views||[],e=0,r=t.length;r>e;e++)t[e].clear()},n.prototype.clear=function(){var t=this,e=t.get("el");return t.isInDOM()&&(e.parentNode.removeChild(e),t.set("isInDOM",!1)),t},n.prototype.isInDOM=function(){return this._isInDOM},n.prototype.appendTo=function(t,e){var r=this,n=r.get("config"),o=n.id,i=t.get("config").views,s=e?t.get("el").querySelector(e):t.get("el");return e&&(n.renderTo=e),n.parent?n.parent&&n.parent.get("config").id!==t.get("config").id&&delete n.parent.get("config").views[o]:n.parent=t,!r.isInDOM()&&t.isInDOM()&&(r.get("el")?(s.appendChild(r.get("el")),r.set("isInDOM",!0),r.reAppendChildren(),r.fireEvent("render",null,r)):r.render()),i[o]=r,n.parent=t,r},n.prototype.reAppendChildren=function(){var t=this.get("config").views;for(var e in t)t.hasOwnProperty(e)&&t[e].appendTo(this)},n.prototype.show=function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="block",e.set("visible",!0),e.fireEvent("show",e,t),e):e},n.prototype.hide=function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="none",e.set("visible",!1),e.fireEvent("hide",e,t),e):e},n.prototype.isVisible=function(){var t=this;return t.get("visible")&&t.isInDOM()},o.ViewManager=e,t.yamvc=o,t.yamvc.View=n}(window);
//@ sourceMappingURL=YAMVC-v0.1.5.min.js.map