/*! YAMVC v0.2.0 - 2014-03-01 
 *  License:  */
(function(){"use strict";function t(){for(var t=0,e=i.length;e>t;t++)i[t]()}var e,n=window.ya||{},r="app",i=[];n.$onReady=function(n){i.push(n),e||"complete"===document.readyState||(e=setInterval(function(){"complete"===document.readyState&&(clearInterval(e),t())},10))},n.$merge=function(t,e){var n,r={};for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r},n.$clone=function(t){return JSON.parse(JSON.stringify(t))},n.$set=function(){for(var t,e=3>arguments.length?r:arguments[0],n=3>arguments.length?arguments[0].split("."):arguments[1].split("."),i=3>arguments.length?arguments[1]:arguments[2],a=window[e]=window[e]||{};n.length;)t=n.shift(),0===n.length?a[t]=i:a=a[t]=a[t]||{};return this},n.$get=function(){for(var t,e=3>arguments.length?r:arguments[0],n=2>arguments.length?arguments[0]:arguments[1],i=n.search(/\./)>0?n.split("."):[n],a=window[e];i.length;)if(t=i.shift(),a[t])a=a[t];else{if(!(t in window)){a=null;break}a=window[t]}return a},n.$module=function(){var t=arguments.length?arguments[0]:null;return t&&(r=t),r},window.ya=n})(),ya.$set("ya","mixins.Array",{find:function(t){for(var e,n=this.length,r=arguments.length,i=r>1?arguments[1]:null;n--;)if(e=this[n],r>1){if(e[t]===i)break}else if(e===t)break;return n},findAll:function(t){for(var e,n=this.length,r=arguments.length,i=r>1?arguments[1]:null,a=[];n--;)e=this[n],r>1?e[t]===i&&a.push(n):e===t&&a.push(n);return a},findAllByFn:function(t){for(var e=this.length,n=[];e--;)t(this[e])&&n.push(e);return n},each:Array.prototype.forEach||function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)i in e&&t.call(r,e[i],i,e)}}),ya.$set("ya","mixins.CoreStatic",{$extend:function(t){t=t||{};var e,n,r=this,i=this.prototype,a=ya.$merge(r.__defaults__||{},t.defaults),s=(r.__mixins__||[]).concat(t.mixins||[]),o=t.static||{},u=/xyz/.test(function(){})?/\b__super\b/:/.*/,c=function(t,e){return function(){var n=this.__super;this.__super=i[t];var r=e.apply(this,arguments);return this.__super=n,r}},l={}.hasOwnProperty;return e=function(){var t;this._config={};for(t in a)l.call(a,t)&&(this._config[t]=a[t]);ya.Core.apply(this,arguments)},n=function(e,n){function r(){this.constructor=e}for(var f in n)l.call(n,f)&&(e[f]=n[f]);r.prototype=n.prototype,e.prototype=new r;for(var d in ya.mixins.CoreStatic)ya.mixins.CoreStatic.hasOwnProperty(d)&&(e[d]=ya.mixins.CoreStatic[d]);for(var h in t)e.prototype[h]="function"==typeof t[h]&&"function"==typeof i[h]&&u.test(t[h])?c(h,t[h]):t[h];for(e.__mixins__=s.slice(),e.__defaults__=a;s.length;){var p=s.pop();e.$mixin(p)}for(var g in o)l.call(o,g)&&(e["$"+g]=o[g]);return e},n(e,r),t.alias&&ya.$set(t.module||ya.$module(),t.alias,t.singleton?new e:e),e},$create:function(t){var e=this;return new e(t)},$mixin:function(t,e){var n,r;e?n="function"==typeof t?t.prototype:t:(e="function"==typeof t?t.prototype:t,n=this.prototype);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r])}}),ya.$set("ya","mixins.GetSet",{set:function(t,e){var n="_"+t,r=this[n];return e!==r&&(this[n]=e,this.fireEvent(t+"Change",this,e,r)),this},get:function(t){return this["_"+t]}}),ya.$set("ya","mixins.Observable",{init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(){if(this._suspendEvents)return!0;var t,e=!0,n=Array.prototype.shift,r=n.call(arguments);t=n.call(arguments);for(var i=0,a=this._listeners[r]||[],s=a.length;s>i;i++)e&&(e=a[i].apply(t,arguments),e=e===void 0?!0:e);return e},addEventListener:function(t,e){var n=this._listeners[t]||[];return n.push(e),this._listeners[t]=n,this},removeEventListener:function(t,e){var n,r=this._listeners[t]||[];if(r)if(e){if("function"==typeof e)for(var i=0,a=r.length;a>i;i++)r[i]===e&&(n=i);else n=e;r.splice(n,1)}else this._listeners[t]=[];return this},suspendEvents:function(){return this.set("suspendEvents",!0),this},resumeEvents:function(){return this.set("suspendEvents",!1),this}}),ya.$set("ya","mixins.Selector",{isQueryMatch:function(t,e){var n,r,i,a=!0;if(e=this._el||e,-1===t.search(" ")){if(n=t.match(/^[^\.#]+/gi),r=t.match(/#[^\.#]+/gi),i=t.match(/\.[^\.#]+/gi),n&&e.nodeName.toLowerCase()!==n.pop()&&(a=!1),i)for(;i.length;)if(!e.classList.contains(i.pop().substring(1))){a=!1;break}r&&e.getAttribute("id")!==r.pop().substring(1)&&(a=!1)}else a=!1;return a}}),ya.$set("ya","Core",function(){"use strict";function t(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}var e=window.ya;t.prototype.init=function(){},t.prototype.initConfig=function(){var t,e,n,r=this,i=r.get("config"),a=function(n){t="get"+n.charAt(0).toUpperCase()+n.slice(1),e="set"+n.charAt(0).toUpperCase()+n.slice(1),r[t]=function(){return r.get("config")[n]},r[e]=function(t){var e=r.get("config")[n];t!==e&&(r.get("config")[n]=t,r.fireEvent(n+"Change",this,t,e))}};for(n in i)i.hasOwnProperty(n)&&a(n)},t.prototype.bindMethods=function(t){var e=this;for(var n in t)t.hasOwnProperty(n)&&"function"==typeof t[n]&&(e[n]=t[n].bind(e),delete t[n]);return e},t.prototype.onChange=function(t,e){var n=this;return n.addEventListener(t+"Change",e),n},t.prototype.unbindOnChange=function(t,e){for(var n=this,r=n._listeners[t+"Change"]||[],i=0,a=r.length;a>i;i++)r[i]===e&&r.splice(i,1);return this._listeners[t+"Change"]=r,n},t.__mixins__=[],t.__defaults__={};for(var n in e.mixins.CoreStatic)e.mixins.CoreStatic.hasOwnProperty(n)&&(t[n]=e.mixins.CoreStatic[n]);return t.$mixin(e.mixins.GetSet),t.$mixin(e.mixins.Observable),t}()),ya.Core.$extend({module:"ya",alias:"Collection",defaults:{namespace:null,proxy:null},init:function(t){var e,n=this;return n.__super(t),t=t||{},e=ya.$merge(n._config,t.config),n.set("initOpts",t),n.set("config",e),n.set("set",[]),n.set("cache",[]),n.set("removed",[]),n.set("filters",[]),n.initConfig(),n.initData(),n},initData:function(){var t=this,e=t.getData()||[];return t.set("raw",e),t.prepareData(e),t},forEach:function(t){var e,n,r=this,i=r._set;if(e=Object(i),n=e.length>>>0,"function"!=typeof t)throw new TypeError;for(var a=0;n>a;a++)a in e&&t.call(r,e[a],a,e)},push:function(t){var e,n=this,r=n.getModel(),i=n.getNamespace();for(Array.isArray(t)||(t=[t]);t.length;)e=t.pop(),e=new r({config:{namespace:i,data:e}}),n._cache.push(e),n.fireEvent("pushed",n,e);return n.filter(),n},count:function(){return this._set.length},clear:function(){var t=this;return t.set("set",[]),t.set("cache",[]),t.set("removed",[]),t},clearFilters:function(){var t=this;return t.set("filters",[]),t.filter(),t},clearFilter:function(t){var e,n,r=this,i=r._filters;for(e=i.length;e--;)if(n=i[e],"function"!=typeof n&&n.id===t){i.splice(e,1);break}return r.filter(),r},filter:function(t){var e,n=this,r=n._filters,i=!0,a=[],s=n._cache,o=0,u=null;arguments.length>1&&(u=arguments[0],t=arguments[1]),"function"==typeof t&&(u?r.push({id:u,fn:t}):r.push(t),n.fireEvent("beforeFilter",n,r));for(var c=0,l=s.length;l>c;c++){for(i=!0,o=r.length;o--;)e="function"==typeof r[o]?r[o]:r[o].fn,i=i&&e(s[c]);i&&a.push(s[c])}return n.set("set",a),n.fireEvent("afterFilter",n,r),n},getAt:function(t){return this._set[t]},getBy:function(t){for(var e=this,n=e._set,r=[],i=0,a=n.length;a>i;i++)t(n[i])&&r.push(n[i]);return r},findOneBy:function(t){for(var e=this,n=e._set,r=n.length;r--&&!t(n[r]););return r},getOneBy:function(t){for(var e,n=this,r=n._set,i=r.length;i--;)if(t(r[i])){e=r[i];break}return e},getTotal:function(){return this._total},load:function(t){var e,n,r=this,i=(r.get("data"),r.get("idProperty"),ya.promise.$deferred()),a=r.getNamespace(),s=new ya.data.Action,o=0;for(n in t)o++;if(0===o)throw Error("You need to pass at least one condition to load model collection");if(!r.getProxy())throw Error("To load collection you need to set proxy");return e=function(){"success"===r.getProxy().getStatus()?r.fireEvent("loaded",r,s.getResponse(),"read"):r.fireEvent("error",r,"read")},s.setOptions({callback:e,params:t,namespace:a}),r.getProxy().read(s),i.promise},save:function(){for(var t,e,n,r,i=this,a=ya.promise.$deferred(),s=[],o=[],u=i._removed,c=i._cache,l=i.getNamespace(),f=i.getProxy(),d=0,h=[],p=0,g=c.length;g>p;p++)n=c[p],n._isDirty&&(n.hasId()?o.push(n._data):(n._data.__clientId__=n.get("clientId"),s.push(n._data)));return r=function(t){return function(e){return t.__clientId__?e.data("__clientId__")===t.__clientId__:e.data("id")===t.id}},e=function(t,e){if(d--,e.getStatus()===ya.data.Action.$status.SUCCESS){var s,o=e.getResponse(),u=o.result;if(n=u[0],s=u.length,n&&(n.__clientId__||n.id))for(;s--;)n=i.getOneBy(r(u[s])),n.setDirty(!1),delete n._data.__clientId__;else i.set("removed",[])}else h.push(e.getResponse().error);0===d&&(h.length?(i.fireEvent("error",i,h),a.reject({errors:h})):(i.fireEvent("success",i),a.resolve({scope:i})))},s.length&&(d++,t=new ya.data.Action,t.setOptions({namespace:l,callback:e}).setData(s),f.create(t)),o.length&&(d++,t=new ya.data.Action,t.setOptions({namespace:l,callback:e}).setData(o),f.update(t)),u.length&&(d++,t=new ya.data.Action,t.setOptions({namespace:l,callback:e}).setData(u),f.destroy(t)),a.promise},prepareData:function(t,e){var n=this,r=n.getModel(),i={namespace:n.getNamespace()},a=t.length,s=[];e=e||a;for(var o=0;a>o;o++)i.data=t[o],s.push(new r({config:i}));return n.set("cache",s),n.set("total",e),n.filter(),n},setData:function(){var t=this;return t.setRawData(data),t.prepareData(data),t},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(t){return this.set("raw",t),this},isDirty:function(){for(var t=this._cache,e=t.length,n=!1;e--;)t[e]._isDirty&&(n=!0);return this._remove&&(n=!0),n}}),ya.Core.$extend({module:"ya",alias:"Controller","static":{id:0,router:null,idGenerator:function(){return ya.Controller.id++},getRouter:function(){return ya.Controller.$router=ya.Controller.$router||new ya.Router,ya.Controller.$router}},init:function(t){var e,n=this;return t=t||{},e=ya.$merge(n._config,t.config),e.id=e.id||"controller-"+ya.Controller.$idGenerator(),n.router=ya.Controller.$getRouter(),n.set("initOpts",t),n.set("config",e),n.set("routes",e.routes||{}),n.set("events",e.events||{}),n.set("views",e.views||{}),n.initConfig(),ya.$onReady(function(){n.restoreRouter()}),n},initConfig:function(){ya.Core.prototype.initConfig.apply(this);var t,e,n,r,i=this,a=i.get("routes"),s=i.get("events"),o=[],u=RegExp("\\$([^\\s]+)");if(a)for(var c in a)if(a.hasOwnProperty(c)){var l=i[a[c]].bind(i);router.when(c,l)}if(s){for(var f in s)if(s.hasOwnProperty(f)){if(r={},r[f]=s[f],ya.event.$dispatcher.add(i,r),t=f.match(u),!t)throw Error("Event query should begin from id of the view (current query: "+f+")");0>o.indexOf(t[1])&&o.push(t[1])}for(n=o.length;n--;)e=ya.view.Manager.get(o[n]),e&&(e.isInDOM()?i.resolveEvents(e):e.addEventListener("render",i.resolveEvents.bind(i)))}return this},resolveEvents:function(t){var e,n,r,i,a,s=this.get("events"),o=function(t,e,n){return t.bind(e,n)},u=RegExp("\\$([^\\s]+)");for(var c in s)if(s.hasOwnProperty(c)&&(e=c.match(u),e&&e[1]===t.getId())){n=s[c],i=c.split(" ").slice(1),r=i.length?t.get("el").querySelectorAll(i.join(" ")):[t.get("el")];for(var l=0,f=r.length;f>l;l++)for(var d in n)n.hasOwnProperty(d)&&(a=o(n[d],this,t),r[l].addEventListener(d,a))}},getRouter:function(){return router},restoreRouter:function(){var t=this;return t.getRouter().restore(),t},redirectTo:function(t){return window.location.hash=t,this}}),ya.Core.$extend({module:"ya",alias:"data.Action","static":{status:{PENDING:0,SUCCESS:1,FAIL:2}},init:function(t){var e,n=this;t=t||{},n.__super(t),e=ya.$merge(n._config,t.config),n.set("initOpts",t),n.set("config",e),n.set("response",{}),n.set("status",ya.data.Action.$status.PENDING),n.initConfig()},setData:function(t){return this.set("data",t),this},getData:function(){return this._data},setOptions:function(t){return this.set("options",t),this},getOptions:function(){return this._options},getOption:function(t){return this._options[t]},setResponse:function(t){return this.set("response",t)},getResponse:function(){return this.get("response")},setStatus:function(t){var e,n=ya.data.Action.$status,r=!1;for(e in n)n.hasOwnProperty(e)&&n[e]===t&&(r=!0);if(!r)throw Error("ya.data.Action: Wrong status");return this.set("status",t)},getStatus:function(){return this.get("status")}}),ya.Core.$extend({module:"ya",alias:"data.Proxy",init:function(t){var e,n=this;t=t||{},n.__super(t),e=ya.$merge(n._config,t.config),n.set("initOpts",t),n.set("config",e),n.initConfig()},read:function(t){var e,n,r=this;if(!(t instanceof ya.data.Action))throw Error("ya.data.Proxy: read argument action should be instance of ya.data.Action");if(e=t.getOptions(),n=e.params&&e.params.id,!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");return n===void 0?r.readBy(t):r.readById(t),r},create:function(t){var e=this;if(!(t instanceof ya.data.Action))throw Error("ya.data.Proxy: create argument action should be instance of ya.data.Action");if(!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("ya.data.Proxy: Data should be object");return e},update:function(t){var e=this;if(!(t instanceof ya.data.Action))throw Error("ya.data.Proxy: update argument action should be instance of ya.data.Action");if(!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("ya.data.Proxy: Data should be object");return e},destroy:function(t){var e=this;if(!(t instanceof ya.data.Action))throw Error("ya.data.Proxy: destroy argument action should be instance of ya.data.Action");if(!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("Data should be pass as object");return e}}),ya.data.Proxy.$extend({module:"ya",alias:"data.proxy.Localstorage","static":{clear:function(t){var e,n=0;if(t)for(Array.isArray(t)||(t=[t]),n=t.length;n--;)e=t[n],delete localStorage[e],delete localStorage[e+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},readBy:function(t){var e,n,r,i,a,s,o,u=this,c=t.getOptions(),l=c.namespace,f=c.callback,d=c.limit||null,h=c.offset||0,p=c.filters||[],g=c.sorters||[],y={},v=[],m=[],_=!0,w=0;return a=function(t,e){var n=""+t[r],i=""+e[r],a=n.toLowerCase(),o=i.toLowerCase();return(a>o?1:o>a?-1:n>i?1:i>n?-1:0)*("desc"===s.toLowerCase()?-1:1)},e=function(){if(localStorage[l]){m=JSON.parse(localStorage[l]);for(var e=0,c=m.length;c>e;e++){for(_=!0,o=p.length;o--;)n=p[o].length>3?p[o][0]:"&&","&&"===n?_=u.executeCondition(m[e],p[o])&&_:"||"===n&&(_=u.executeCondition(m[e],p[o])||_);_&&v.push(m[e])}for(m=v,w=v.length,o=g.length;o--;)i=g[o],r=i[0],s=i[1]||"ASC",m.sort(a);d||(d=m.length-h),(h>0||d)&&(m=m.splice(h,d))}y.total=w,y.result=m,t.setStatus(ya.data.Action.$status.SUCCESS).setResponse(y),f(u,t)},setTimeout(function(){try{e()}catch(n){y.error=n,f(u,t)}},0),u},readById:function(t){var e,n=this,r=t.getOptions(),i=r.params,a=r.namespace,s=r.callback,o=i.id,u=[],c={},l={};return e=function(){if(localStorage[a]){u=JSON.parse(localStorage[a]);for(var e=0,r=u.length;r>e;e++)u[e].id===o&&(c=u[e]);if(c.id!==void 0)return l.total=1,l.result=c,t.setStatus(ya.data.Action.$status.SUCCESS).setResponse(l),s(n,t),n}n.setStatus(ya.data.Action.$status.FAIL),l.error=Error("Not found"),s(n,t)},setTimeout(e,0),n},create:function(t){var e,n,r=this,i=t.getData(),a=t.getOption("namespace"),s=t.getOption("callback"),o=[],u=1,c={};if(r.__super.apply(this,arguments),localStorage[a]&&(o=JSON.parse(localStorage[a]),u=localStorage[a+"$Sequence"]),Array.isArray(i)){e=[];for(var l=0,f=i.length;f>l;l++)i[l].id=u++,delete i[l].__clientId__,o.push(i[l]),e.push(i[l])}else i.id=u++,delete i.__clientId__,o.push(i),e=i;return n=function(){try{localStorage[a]=JSON.stringify(o),localStorage[a+"$Sequence"]=u,c.result=e,t.setStatus(ya.data.Action.$status.SUCCESS).setResponse(c)}catch(n){c.error=n,t.setStatus(ya.data.Action.$status.FAIL).setResponse(c)}s(r,t)},setTimeout(n,0),r},update:function(t){var e,n,r,i,a,s=this,o=t.getData(),u=t.getOption("namespace"),c=t.getOption("callback"),l=[],f={};return a=function(){if(localStorage[u]){if(l=JSON.parse(localStorage[u]),Array.isArray(o))for(e=[],r=o.length;r--;)for(i=l.length,n=o[r].id;i--;)l[i].id===n&&(l[i]=o[r],e.splice(0,0,o[r]));else for(r=l.length,n=o.id;r--;)l[r].id===n&&(e=l[r]=o);try{localStorage[u]=JSON.stringify(l),f.success=!0,f.result=e,t.setStatus(ya.data.Action.$status.SUCCESS).setResponse(f)}catch(a){f.success=!1,f.error=a,t.setStatus(ya.data.Action.$status.FAIL).setResponse(f)}return c(s,t),s}f.success=!1,f.error=Error("Not found"),t.setStatus(ya.data.Action.$status.FAIL).setResponse(f),c(s,t)},setTimeout(a,0),s},destroy:function(t){var e,n,r,i,a=this,s=t.getData(),o=t.getOption("namespace"),u=t.getOption("callback"),c=[],l={};return i=function(){if(localStorage[o]){if(c=JSON.parse(localStorage[o]),Array.isArray(s))for(n=s.length;n--;)for(r=c.length,e=s[n].id;r--;)c[r].id===e&&c.splice(r,1);else for(n=c.length,e=s.id;n--;)c[n].id===e&&c.splice(n,1);try{localStorage[o]=JSON.stringify(c),l.success=!0,t.setStatus(ya.data.Action.$status.SUCCESS).setResponse(l)}catch(i){l.success=!1,l.error=i,t.setStatus(ya.data.Action.$status.FAIL).setResponse(l)}return u(a,t),a}l.success=!1,l.error=Error("Not found"),t.setStatus(ya.data.Action.$status.FAIL).setResponse(l),u(a,t)},setTimeout(i,0),a},executeCondition:function(t,e){var n,r,i,a,s=!1;switch(e.length>3?(r=e[1],n=e[2],i=e[3]):(r=e[0],n=e[1],i=e[2]),n){case">":t[r]>i&&(s=!0);break;case"<":i>t[r]&&(s=!0);break;case">=":t[r]>=i&&(s=!0);break;case"<=":i>=t[r]&&(s=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),a=RegExp(i),a.test(t[r])&&(s=!0)}return s}}),ya.Core.$extend({module:"ya",singleton:!0,alias:"event.$dispatcher",defaults:{delegates:null},init:function(t){var e,n=this;return n.__super(t),t=t||{},e=ya.$merge(n._config,t.config),n.set("initOpts",t),n.set("config",e),n.initConfig(),n},initConfig:function(){var t=this;return t.__super.apply(t,arguments),t.setDelegates([]),t},add:function(t,e){var n=this,r=Object.keys(e).pop();return n.getDelegates().push({selector:r,scope:t,events:e[r]}),n},apply:function(t){for(var e,n,r,i,a=this,s=a.getDelegates(),o=[],u=t,c=[],l=function(t){return t.selector.search(r)>=0},f=ya.mixins.Selector.isQueryMatch,d=ya.mixins.Array.findAllByFn,h=ya.mixins.Array.each;t;)r=RegExp("^\\$"+t.getId()+"[\\s]"),o=d.call(s,l),o.length&&h.call(o,function(r){c.length=0,n=s[r],e=n.selector.split(" "),e.shift(),e.length&&(c=u.querySelectorAll(e.pop()),i=e.slice(),h.call(c,function(e){if(i.length)for(var r=e,s=i.pop();t.getId()!==r.getAttribute("id");){if(f(s,r)){if(0===i.length){a.assignEvents(e,n,t);break}s=i.pop()}r=r.parentNode}else a.assignEvents(e,n,t)}))}),t=t.getParent()},assignEvents:function(t,e,n){var r,i=e.events;for(r in i)i.hasOwnProperty(r)&&t.addEventListener(r,i[r].bind(e.scope,n),!1)},clear:function(){return this.getDelegates().length=0,this}}),ya.Core.$extend({module:"ya",alias:"Model","static":{id:0,idGenerator:function(){return ya.Model.$id++}},defaults:{idProperty:"id",proxy:null},init:function(t){var e,n=this;n.__super(t),t=t||{},e=ya.$merge(n._config,t.config),n.set("initOpts",t),n.set("config",e),n.set("isDirty",!0),n.initConfig(),n.initData()},initConfig:function(){var t=this,e=t._config;if(!e.namespace)throw Error("Model need to have namespace");return e.data||(e.data={}),t.set("clientId",e.namespace+"-"+ya.Model.$idGenerator()),t.__super(),t},initData:function(){var t=this;return t.set("data",t.getData()||{}),t},setDataProperty:function(t,e){var n=this,r=n._data,i=r[t];e!==i&&(r[t]=e,n.set("isDirty",!0),n.fireEvent("data"+t.charAt(0).toUpperCase()+t.slice(1)+"Change",n,e,i))},getDataProperty:function(t){return this.get("data")[t]},data:function(t){var e,n=this,r=arguments.length;if(r>1)this.setDataProperty.apply(this,arguments);else{if("object"!=typeof t)return this.getDataProperty.apply(this,arguments);for(e in t)t.hasOwnProperty(e)&&n.setDataProperty(e,t[e])}return n},clear:function(){var t,e=this,n=e.get("data");for(t in n)n.hasOwnProperty(t)&&e.data(t,null);e.set("data",{}),e.fireEvent("dataChange",e,n)},load:function(t){var e,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.promise.$deferred(),s=new ya.data.Action,o={};if(t[i]===void 0&&r[i]===void 0)throw Error("You need to pass id to load model");return t[i]=r[i],o.namespace=n.getNamespace(),o.params=t,o.callback=function(){e=n.getProxy().getResponse(),"success"===n.getProxy().getStatus()?(n.set("isDirty",!1),n.set("data",e),a.resolve({scope:n,response:e,action:"read"}),n.fireEvent("loaded",n,e,"read")):(a.reject({scope:n,response:e,action:"read"}),n.fireEvent("error",n,e,"read"))},s.setOptions(o),n.getProxy().read(s),a.promise},save:function(){var t,e,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.promise.$deferred(),s=new ya.data.Action,o=n.getProxy(),u={};return n.get("isProcessing")||!n.get("isDirty")?!1:(n.set("isProcessing",!0),u.namespace=n.getNamespace(),u.callback=function(r,i){t=i.getResponse(),n.set("isProcessing",!1),i.getStatus()===ya.data.Action.$status.SUCCESS?(n.set("isDirty",!1),n.set("data",t.result),a.resolve({scope:n,action:i,type:e}),n.fireEvent("saved",n,i,e)):(a.reject({scope:n,action:i,type:e}),n.fireEvent("error",n,i,e))},s.setOptions(u).setData(r),r[i]===void 0?(e="create",o.create(s)):(e="update",o.update(s)),a.promise)},remove:function(){var t,e=this,n=e.get("data"),r=e.getIdProperty(),i=ya.promise.$deferred(),a=new ya.data.Action,s=e.getProxy(),o={};if(n[r]===void 0)throw Error("Can not remove empty model");return o.namespace=e.getNamespace(),o.callback=function(n,r){t=r.getResponse(),r.getStatus()===ya.data.Action.$status.SUCCESS?(e.set("isDirty",!1),e.set("data",{}),i.resolve({scope:e,action:r,type:"remove"}),e.fireEvent("removed",e,"remove")):(i.reject({scope:e,action:r,type:"remove"}),e.fireEvent("error",e,"remove"))},a.setOptions(o).setData(n),s.destroy(a),s.destroy(a),i.promise},hasId:function(){return!!this._data[this._config.idProperty]},setDirty:function(t){return this.set("isDirty",!!t),this},isDirty:function(){return this._isDirty}}),"document"in self&&!("classList"in document.createElement("_"))&&function(t){"use strict";if("Element"in t){var e="classList",n="prototype",r=t.Element[n],i=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},o=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},u=function(t,e){if(""===e)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(t,e)},c=function(t){for(var e=a.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=function(){t.setAttribute("class",""+this)}},l=c[n]=[],f=function(){return new c(this)};if(o[n]=Error[n],l.item=function(t){return this[t]||null},l.contains=function(t){return t+="",-1!==u(this,t)},l.add=function(){var t,e=arguments,n=0,r=e.length,i=!1;do t=e[n]+"",-1===u(this,t)&&(this.push(t),i=!0);while(r>++n);i&&this._updateClassName()},l.remove=function(){var t,e=arguments,n=0,r=e.length,i=!1;do{t=e[n]+"";var a=u(this,t);-1!==a&&(this.splice(a,1),i=!0)}while(r>++n);i&&this._updateClassName()},l.toggle=function(t,e){t+="";var n=this.contains(t),r=n?e!==!0&&"remove":e!==!1&&"add";return r&&this[r](t),!n},l.toString=function(){return this.join(" ")},i.defineProperty){var d={get:f,enumerable:!0,configurable:!0};try{i.defineProperty(r,e,d)}catch(h){-2146823252===h.number&&(d.enumerable=!1,i.defineProperty(r,e,d))}}else i[n].__defineGetter__&&r.__defineGetter__(e,f)}}(self),ya.$set("ya","promise",function(t){"use strict";function e(e){function n(t){return t}function r(t){return c(t)}function s(t){var e=o(),n=0,r=isArray(t)?[]:{};return a(t,function(t,i){n++,u(t).then(function(t){r.hasOwnProperty(i)||(r[i]=t,--n||e.resolve(r))},function(t){r.hasOwnProperty(i)||e.reject(t)})}),0===n&&e.resolve(r),e.promise}var o=function(){var a,s,c=[];return s={resolve:function(e){if(c){var n=c;c=t,a=u(e),n.length&&setTimeout(function(){for(var t,e=0,r=n.length;r>e;e++)t=n[e],a.then(t[0],t[1],t[2])},0)}},reject:function(t){s.resolve(l(t))},notify:function(t){if(c){var e=c;c.length&&setTimeout(function(){for(var n,r=0,i=e.length;i>r;r++)n=e[r],n[2](t)},0)}},promise:{then:function(t,s,u){var l=o(),f=function(r){try{l.resolve((i(t)?t:n)(r))}catch(a){l.reject(a),e(a)}},d=function(t){try{l.resolve((i(s)?s:r)(t))}catch(n){l.reject(n),e(n)}},h=function(t){try{l.notify((i(u)?u:n)(t))}catch(r){e(r)}};return c?c.push([f,d,h]):a.then(f,d,h),l.promise},"catch":function(t){return this.then(null,t)},"finally":function(t){function e(t,e){var n=o();return e?n.resolve(t):n.reject(t),n.promise}function r(r,a){var s=null;try{s=(t||n)()}catch(o){return e(o,!1)}return s&&i(s.then)?s.then(function(){return e(r,a)},function(t){return e(t,!1)}):e(r,a)}return this.then(function(t){return r(t,!0)},function(t){return r(t,!1)})}}}},u=function(t){return t&&i(t.then)?t:{then:function(e){var n=o();return setTimeout(function(){n.resolve(e(t))},0),n.promise}}},c=function(t){var e=o();return e.reject(t),e.promise},l=function(t){return{then:function(n,a){var s=o();return setTimeout(function(){try{s.resolve((i(a)?a:r)(t))}catch(n){s.reject(n),e(n)}}),s.promise}}},f=function(t,a,s,l){var f,d=o(),h=function(t){try{return(i(a)?a:n)(t)}catch(r){return e(r),c(r)}},p=function(t){try{return(i(s)?s:r)(t)}catch(n){return e(n),c(n)}},g=function(t){try{return(i(l)?l:n)(t)}catch(r){e(r)}};return setTimeout(function(){u(t).then(function(t){f||(f=!0,d.resolve(u(t).then(h,p,g)))},function(t){f||(f=!0,d.resolve(p(t)))},function(t){f||d.notify(g(t))})}),d.promise};return{$deferred:o,$reject:c,$when:f,$all:s}}var n,r=window.ya||{},i=function(t){return"function"==typeof t},a=r.mixins.Array.each,s=[];return n=e(function(t){s.push(t)}),n.getStack=function(){return s},n}()),ya.Core.$extend({module:"ya",alias:"Router",init:function(){this.set("routing",{}),this.bindEvents()},bindEvents:function(){return window.onhashchange=this.onHashChange.bind(this),this},onHashChange:function(){var t=this.get("routing"),e=window.location.hash.substr(1),n=e.split("/"),r=n.shift();if(t[r]){var i=[];if(t[r].params)for(var a=0,s=t[r].params.length;s>a;a++){var o=t[r].params[a],u=n[a],c=RegExp(o.substr(1,o.length-2));i.push(u.match(c).input)}t[r].callback.apply(null,i)}return this},restore:function(){return this.onHashChange(),this},when:function(t,e){var n=this.get("routing"),r=t.split("/"),i=r.shift();return n[i]={callback:e,params:r},this.set("routing",n),this}}),function(t){"use strict";function e(t){for(var e={},n=t.split(","),r=0;n.length>r;r++)e[n[r]]=!0;return e}function n(){0===f&&(d=setInterval(r,32)),f=+new Date}function r(){var t,e,n,r=+new Date;if(r-f>=32)for(clearInterval(d),f=0,t=i.views,e=t.length,n=0;e>n;)t[n].getFit()&&t[n].fireEvent("resize",t[n]),n++}var i,a,s,o=window.ya||{},u=document.createElement("style"),c=Array.prototype.slice,l=0,f=0,d=0;s=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),u.innerHTML=".ya.inline {display:inline;} .ya.hidden {display: none !important;}",u.setAttribute("type","text/css"),document.body.appendChild(u),window.addEventListener("resize",n),i={views:[],toRender:[],i:0,add:function(t,e){var n=this;e.getAutoCreate()&&e.render(),n.views.push(e),n.i++},get:function(t){for(var e=this,n=e.views.length;n--&&e.views[n].getId()!==t;);return e.views[n]}},a={tpl:{},add:function(t,e){var n=this;n.tpl[t]=e},get:function(t){var e=this;return e.tpl[t]}},o.$set("ya","view.Manager",i),o.Core.$extend({module:"ya",alias:"View",defaults:{parent:null,fit:!1,hidden:!1,models:null,autoCreate:!1},mixins:[o.mixins.Selector],init:function(t){var e=this;return e.__super(),e.initDefaults(t),e.initConfig(),e.initTemplate(),e.initParent(),i.add(e.getId(),e),e},initDefaults:function(t){var e,n=this;t=t||{},e=o.$merge(n._config,t.config),e.id=e.id||"view-"+i.i,e.children=e.children||[],n.set("initOpts",t),n.set("config",e)},initTemplate:function(){var t,e=this,n=e.get("config"),r=document.createElement("div");if(!n.tpl)throw Error(n.id+": no tpl set");if(n.tpl instanceof o.view.Template)r.innerHTML=n.tpl.getHtml().innerHTML;else if(a.get(n.tpl))r.innerHTML=a.get(n.tpl).innerHTML;else{if(t=document.getElementById(n.tpl),!t)throw Error("no tpl "+n.tpl+" found");a.add(n.tpl,t.parentNode.removeChild(t)),r.innerHTML=a.get(n.tpl).innerHTML}return e.set("tpl",r),e},initParent:function(){var t=this,e=t.getParent();e&&e.getChildren().push(t)},setModel:function(t,e){var n=this,r=n.getModels();return r.push(e),n.setModels(r),n.resolveModelBindings(e),n},getModel:function(t){var e,n=this,r=n.getModels(),i=null;for(e=r.length;e--;)if(r[e].getNamespace()===t){i=r[e];break}return i},render:function(){var e,n,r,i,a,o,u,c,f,d,h=this,p=h._tpl,g=h._config,y=g.renderTo,v=g.parent,m=g.parent,_=[],w=[],C=0,S=0,A=0,E=[];for(h.isInDOM()&&h.removeRendered(),v?v=y&&v.querySelector(y)?v.querySelector(y):v._el:y&&(v=document.querySelector(y)),o=p.cloneNode(!0),u=document.createTreeWalker(o,NodeFilter.SHOW_ALL,null,!1),c=u.nextNode();c;){if(3===c.nodeType){if(e=c.data.match(/\{\{(.*?)\}\}/gi)){var b=c.value||c.data,O=document.createElement("span"),$="v-r-b-"+l++;for(C=0,A=e.length,w=[],O.setAttribute("id",$);A>C;)n=e[C++],r=n.substr(2,n.length-4).split("."),h.getModel(r[0])?(i=h.getModel(r[0]).data(r[1]),i===t&&(i="")):i="",b=b.replace(n,i),w.push(r);O.appendChild(document.createTextNode(b)),_.push({original:c.value||c.data,headers:w,type:3,pointer:O,oldDOM:c})}}else for(E=c.attributes,S=E.length;S--;)if(d=E.item(S),e=d.value&&d.value.match(/\{\{(.*?)\}\}/gi)){var D=d.value,x=s[d.nodeName];for(C=0,A=e.length,w=[],i=x?!0:"";A>C;)n=e[C++],r=n.substr(2,n.length-4).split("."),x?i=i&&h.getModel(r[0]).data(r[1]):(h.getModel(r[0])&&(i=h.getModel(r[0]).data(r[1])||""),d.value=d.value.replace(n,i)),w.push(r);x?i?c.setAttribute(d.nodeName,i):c.removeAttribute(d.nodeName):"css"===d.nodeName&&(a=d.value,d=document.createAttribute("style"),d.value=a,c.removeAttribute("css"),E.setNamedItem(d)),_.push({original:D,headers:w,fillAttr:x||!1,type:2,attrName:d.nodeName,pointer:c})}else"css"===d.nodeName&&(a=d.value,d=document.createAttribute("style"),d.value=a,c.removeAttribute("css"),E.setNamedItem(d));c=u.nextNode()}return 1===o.childNodes.length&&1===o.childNodes.item(0).nodeType?f=o.childNodes.item(0):(f=o,f.classList.add("inline")),f.setAttribute("id",g.id),f.classList.add("ya"),h.set("el",f),h.set("bindings",_),h.resolveBindings(),h.getHidden()&&h.hide(),v&&(v.appendChild(f),m&&0>m.findChild(h.getId())&&m.getChildren().push(h),h.set("isInDOM",!0),h.reAppendChildren(),h.fireEvent("render",null,h)),f},resolveModelBindings:function(t){var e,n,r,i,a,s=this,o=s._bindings,u=0,c=0;for(e=function(t){return function(){s.partialRender(t)}},c=o.length;c--;)for(i=o[c],n=i.headers,u=n.length;u--;)t.getNamespace()===n[u][0]&&(r=n[u][1],a="data"+r.charAt(0).toUpperCase()+r.slice(1)+"Change",i.fn=e(i),t.addEventListener(a,i.fn),i.fn())},resolveBindings:function(){var t,e,n,r,i,a,s=this,o=s._bindings,u=0,c=0;for(t=function(t){return function(){s.partialRender(t)}},c=o.length;c--;)for(i=o[c],n=i.headers,3===i.type&&i.oldDOM&&(i.oldDOM.parentNode.replaceChild(i.pointer,i.oldDOM),delete i.oldDOM),u=n.length;u--;)e=s.getModel(n[u][0]),r=n[u][1],e&&(i.fn=t(i),a="data"+r.charAt(0).toUpperCase()+r.slice(1)+"Change",e.addEventListener(a,i.fn))},partialRender:function(t){for(var e,n=this,r=3===t.type,i=r?t.original:t.fillAttr?!0:t.original,a=t.headers,s=a.length;s--;)e=a[s],i=r||!t.fillAttr?i.replace("{{"+e.join(".")+"}}",n.getModel(e[0]).data(e[1])):i&&n.getModel(e[0]).data(e[1]);
return r?t.pointer.textContent=i:t.fillAttr&&!i?t.pointer.removeAttribute(t.attrName):t.pointer.setAttribute(t.attrName,i),n},removeBindings:function(){for(var t,e,n,r,i,a=this,s=a._bindings,o=s.length;o--;)for(t=s[o],r=t.headers.length;r--;)n=t.headers[r],e=a.getModel(n[0]),i="data"+n[1].charAt(0).toUpperCase()+n[1].slice(1)+"Change",e.removeEventListener(i,t.fn);return a},removeRendered:function(){var t=this;return t._el.parentNode.removeChild(t._el),t.removeBindings(),t.set("el",null),t.set("isInDOM",!1),t},querySelector:function(t){return this.get("el").querySelector(t)||(this.isQueryMatch(t)?this.get("el"):null)},querySelectorAll:function(t){var e=c.call(this.get("el").querySelectorAll(t)||[],0);return this.isQueryMatch(t)&&e.push(this.get("el")),e},addChild:function(t,e){var n=this;return t.appendTo(n,e),o.event.$dispatcher.apply(t),n.fireEvent("elementAdded",n,t),n},getChild:function(t){var e=this;return 0>e.findChild(t)?!1:e.findChild(t)},findChild:function(t){for(var e=this.getChildren(),n=e.length;n--&&e[n].getId()!==t;);return n},removeChild:function(t){for(var e=this.getChildren(),n=e.length,r=[];n--;)e[n].getId()===t&&(r=e.splice(n,1),r[0].clear());return r[0]||null},removeChildren:function(){for(var t=this.getChildren(),e=t.length,n=[];e--;)n.push(t[e].clear());return n},clear:function(){var t=this,e=t._el;return t.isInDOM()&&(e.parentNode.removeChild(e),t.set("isInDOM",!1)),t},isInDOM:function(){return this._isInDOM},appendTo:function(t,e){var n=this,r=n.get("config"),i=n.getId(),a=t.getChildren(),s=r.parent,u=e?t._el.querySelector(e):t._el;return e&&(r.renderTo=e),s?s&&s.getId()!==t.getId()&&s.findChild(i)>-1&&s.getChildren().splice(s.findChild(i),1):r.parent=t,a.push(n),r.parent=t,n.fireEvent("append",null,n,t),!n.isInDOM()&&t.isInDOM()&&(n._el?(u.appendChild(n._el),n.set("isInDOM",!0),n.reAppendChildren(),n.fireEvent("render",null,n)):(n.render(),o.event.$dispatcher.apply(n))),n},reAppendChildren:function(){for(var t=this.getChildren(),e=t.length,n=0;e>n;n++)t[n].appendTo(this);return this},show:function(){var t=this;return t._el?(t._el.classList.remove("hidden"),t.set("visible",!0),t.fireEvent("show",t),t):t},hide:function(){var t=this;return t._el?(t._el.classList.add("hidden"),t.set("visible",!1),t.fireEvent("hide",t),t):t},toggle:function(){var t=this;t._visible?t.hide():t.show()},isVisible:function(){return this.get("visible")&&this.isInDOM()}})}(),ya.Core.$extend({module:"ya",alias:"view.Template",defaults:{tpl:null},init:function(t){var e,n=this;n.__super(t),t=t||{},e=ya.$merge(n._config,t.config),n.set("initOpts",t),n.set("config",e),n.initConfig(),n.initTpl()},initConfig:function(){var t=this,e=t.get("config");if(t.__super(),!e.id)throw Error("ya.view.Template: Template need to have id");return t},initTpl:function(){var t=this,e=t.getTpl(),n=document.createElement("div");Array.isArray(e)&&(e=e.join("")),n.innerHTML=e,t.set("html",n)},getHtml:function(){return this._html}});
//@ sourceMappingURL=YAMVC-v0.2.0.min.js.map