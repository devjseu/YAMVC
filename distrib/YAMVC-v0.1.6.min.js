/*! YAMVC v0.1.6 - 2014-01-04 
 *  License:  */
(function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend({defaults:{proxy:null},init:function(t){e.Parent.init.apply(this,arguments);var r,i=this;t=t||{},r=n.merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.set("set",[]),i.set("cache",[]),i.initConfig(),i.initData()},initData:function(){var t=this,e=t.get("initOpts"),n=(t.get("config"),e.data||[]);return t.set("raw",n),t.prepareData(n),t},count:function(){return this._set.length},clear:function(){var t=this;return t.set("set",[]),t.set("cache",[]),t},clearFilterFn:function(){return this.set("set",this._cache),this},filterFn:function(t){for(var e=this,n=[],r=e._cache,i=0,o=r.length;o>i;i++)t(r[i])&&n.push(r[i]);return e.set("set",n),e},getAt:function(t){return this._set[t]},getTotal:function(){return this._total},load:function(t){var e,n,r=this,i=(r.get("data"),r.get("idProperty"),r.getModelConfig().namespace),o=0;for(n in t)o++;if(0===o)throw Error("You need to pass at least one condition to load model collection");if(!r.getProxy)throw Error("To load collection you need to set proxy");return e=function(){"success"===r.getProxy().getStatus()?r.fireEvent("loaded",r,r.getProxy().getResponse(),"read"):r.fireEvent("error",r,"read")},r.getProxy().read(i,t,e),r},prepareData:function(t,e){var n=this,r=n.getModel(),i=n.getModelConfig?n.getModelConfig():{},o=t.length,s=[];e=e||o;for(var a=0;o>a;a++)s.push(new r({data:t[a],config:i}));return n.set("set",s),n.set("cache",s),n.set("total",e),n},setData:function(){var t=this;return t.setRawData(data),t.prepareData(data),t},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(t){return this.set("raw",t),this}}),t.yamvc=n,t.yamvc.Collection=e})(window),function(t){"use strict";var e,n,r=t.yamvc||{};e=r.Core.extend({init:function(t){var e,i=this;return t=t||{},e=t.config||{},n=n||new r.Router,i.set("initOpts",t),i.set("config",e),i.set("routes",e.routes||{}),i.set("events",e.events||{}),i.set("views",e.views||{}),i.initConfig(),i.renderViews(),i.restoreRouter(),i},initConfig:function(){r.Core.prototype.initConfig.apply(this);var t,e,i=this,o=i.get("routes"),s=i.get("events"),a=i.get("views"),c=/(^\$|,$)/;if(o)for(var u in o)if(o.hasOwnProperty(u)){var f=i[o[u]].bind(i);n.when(u,f)}if(s&&a){for(e in a)a.hasOwnProperty(e)&&a[e].addListener("render",i.resolveEvents.bind(i));for(t in s)if(s.hasOwnProperty(t)&&c.test(t)){if(e=a[t.substr(1)])for(var l in s[t])s[t].hasOwnProperty(l)&&e.addListener(l,s[t][l].bind(i,e));delete s[t]}}return this},renderViews:function(){var t=this,e=t.get("views");for(var n in e)e.hasOwnProperty(n)&&e[n].getAutoCreate&&e[n].getAutoCreate()&&e[n].render()},resolveEvents:function(t){var e,n,r=this.get("events"),i=function(t,e,n){return t.bind(e,n)};for(var o in r)if(r.hasOwnProperty(o)){e=r[o];for(var s=t.get("el").querySelectorAll(o),a=0,c=s.length;c>a;a++)for(var u in e)e.hasOwnProperty(u)&&(n=i(e[u],this,t),s[a].addEventListener(u,n))}},getRouter:function(){return n},restoreRouter:function(){var t=this;return t.getRouter().restore(),t},redirectTo:function(e){return t.location.hash=e,this}}),t.yamvc.Controller=e}(window),function(t){"use strict";function e(){for(var t=0,e=s.length;e>t;t++)s[t]()}function n(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var r,i,o=t.yamvc||{},s=[];o.onReady=function(t){s.push(t),i||"complete"===document.readyState||(i=setInterval(function(){"complete"===document.readyState&&(clearInterval(i),e())},10))},r=o.Core||function(){function t(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}return t.prototype.init=function(){},t.prototype.initConfig=function(){var t,e,n,r=this,i=r.get("config"),o=function(n){t="get"+n.charAt(0).toUpperCase()+n.slice(1),e="set"+n.charAt(0).toUpperCase()+n.slice(1),r[t]=function(){return r.get("config")[n]},r[e]=function(t){var e=r.get("config")[n];t!==e&&(r.get("config")[n]=t,r.fireEvent(n+"Change",this,t,e))}};for(n in i)i.hasOwnProperty(n)&&o(n)},t.prototype.bindMethods=function(t){for(var e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(this[e]=t[e].bind(this),delete t[e])},t.prototype.onChange=function(t,e){return this.addListener(t+"Change",e),this},t.prototype.unbindOnChange=function(t,e){for(var n=this._listeners[t+"Change"]||[],r=0,i=n.length;i>r;r++)n[r]===e&&n.splice(r,1);return this._listeners[t+"Change"]=n,this},t.mixin=function(t,e){var n,r;e?n="function"==typeof t?t.prototype:t:(e="function"==typeof t?t.prototype:t,n=this.prototype);for(r in e)"init"!==r?e.hasOwnProperty(r)&&(n[r]=e[r]):"function"==typeof this&&this.__mixins__.push(e.init)},t.__mixins__=[],t.extend=function(e){e=e||{};var n=this,r=function(){var e;this._config={};for(e in i)a.call(i,e)&&(this._config[e]=i[e]);t.apply(this,arguments)},i=e.defaults||{},o=e.mixins||[],s=e.static||{},a={}.hasOwnProperty,c=function(n,r){function i(){this.constructor=n}for(var c in r)a.call(r,c)&&(n[c]=r[c]);i.prototype=r.prototype,n.Parent=r.prototype,n.prototype=new i,n.extend=t.extend,n.mixin=t.mixin,n.__mixins__=[];for(var u in e)a.call(e,u)&&"function"==typeof e[u]&&(n.prototype[u]=e[u]);for(;o.length;)n.mixin(o.pop());for(var f in s)a.call(s,f)&&(n["$"+f]=s[f]);return n};return c(r,n),r},t.mixin(o.mixins.GetSet),t.mixin(o.mixins.Observable),t}(),o.Core=r,o.merge=n,t.yamvc=o}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend({defaults:{propertyResults:"results"},init:function(t){var r,i=this;e.Parent.init.apply(this,arguments),t=t||{},r=n.merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.initConfig()},initConfig:function(){var t=this;e.Parent.initConfig.call(this),t.set("lastResponse",{})},read:function(t){if(!t)throw Error("namespace should be set")},create:function(t,e){if(!t)throw Error("namespace should be set");if(!e||"object"!=typeof e)throw Error("Data should be pass as object")},update:function(){},destroy:function(){},setResponse:function(t){return this.set("response",t)},getResponse:function(){return this.get("response")}}),t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.Proxy=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.data.Proxy;e=r.extend({"static":{clear:function(t){var e,n=0;if(t)for(Array.isArray(t)||(t=[t]),n=t.length;n--;)e=t[n],delete localStorage[e],delete localStorage[e+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},init:function(){e.Parent.init.apply(this,arguments)},initConfig:function(){e.Parent.initConfig.apply(this)},read:function(t,n,r){var i=this;e.Parent.read.apply(this,arguments),"object"==typeof n?i.readBy(t,n,r):i.readById(t,n,r)},readBy:function(t,e,n){var r,i,o,s,a,c,u=this,f=e.limit||null,l=e.offset||0,p=e.filters||[],d=e.sorters||[],g={},h=[],v=[],y=!0;if(s=function(t,e){var n=""+t[i],r=""+e[i],o=n.toLowerCase(),s=r.toLowerCase();return(o>s?1:s>o?-1:n>r?1:r>n?-1:0)*("desc"===a.toLowerCase()?-1:1)},localStorage[t]){v=JSON.parse(localStorage[t]);for(var m=0,w=v.length;w>m;m++){for(y=!0,c=p.length;c--;)r=p[c].length>3?p[c][0]:"&&","&&"===r?y=u.executeCondition(v[m],p[c])&&y:"||"===r&&(y=u.executeCondition(v[m],p[c])||y);y&&h.push(v[m])}for(v=h,c=d.length;c--;)o=d[c],i=o[0],a=o[1]||"ASC",v.sort(s);f||(f=v.length-l),(l>0||f)&&(v=v.splice(l,f))}return g.success=!0,g.result=v,n(u,g),u},readById:function(t,e,n){var r=this,i=[],o={},s={};if(localStorage[t]){i=JSON.parse(localStorage[t]);for(var a=0,c=i.length;c>a;a++)i[a].id===e&&(o=i[a]);if(o.id!==undefined)return s.success=!0,s.result=o,n(r,s),r}return s.success=!1,s.error=Error("Not found"),n(r,s),r},executeCondition:function(t,e){var n,r,i,o,s=!1;switch(e.length>3?(r=e[1],n=e[2],i=e[3]):(r=e[0],n=e[1],i=e[2]),n){case">":t[r]>i&&(s=!0);break;case"<":i>t[r]&&(s=!0);break;case">=":t[r]>=i&&(s=!0);break;case"<=":i>=t[r]&&(s=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),o=RegExp(i),o.test(t[r])&&(s=!0)}return s},create:function(t,n,r){var i=this,o=[],s=0,a={};if(e.Parent.create.apply(this,arguments),localStorage[t]&&(o=JSON.parse(localStorage[t]),s=localStorage[t+"$Sequence"]),Array.isArray(n))for(var c=0,u=n.length;u>c;c++)n[c].id=s++,o.push(n[c]);else n.id=s++,o.push(n);try{localStorage[t]=JSON.stringify(o),localStorage[t+"$Sequence"]=s,a.success=!0,a.result=n}catch(f){a.success=!1,a.error=f}return i.setResponse(a),r(i,a),i},update:function(t,e,n){var r,i,o,s=this,a=[],c={},u={};if(localStorage[t]){if(a=JSON.parse(localStorage[t]),Array.isArray(e)){for(i=e.length;i--;)for(o=a.length,r=e[i].id;o--;)a[o].id===r&&(a[o]=e[i]);c=a}else for(i=a.length,r=e.id;i--;)a[i].id===r&&(c=a[i]=e);try{localStorage[t]=JSON.stringify(a),u.success=!0,u.result=c}catch(f){u.success=!1,u.error=f}return n(s,u),s}return u.success=!1,u.error=Error("Not found"),n(s,u),s},destroy:function(t,e,n){var r,i,o,s=this,a=[],c={};if(localStorage[t]){if(a=JSON.parse(localStorage[t]),Array.isArray(e))for(i=e.length;i--;)for(o=a.length,r=e[i].id;o--;)a[o].id===r&&a.splice(o,1);else for(i=a.length,r=e.id;i--;)a[i].id===r&&a.splice(i,1);try{localStorage[t]=JSON.stringify(a),c.success=!0}catch(u){c.success=!1,c.error=u}return n(s,c),s}return c.success=!1,c.error=Error("Not found"),n(s,c),s}}),t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Localstorage=e}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.data.Proxy.extend(function(){var t=this;return n.data.Proxy.apply(t,arguments),t}),e.prototype.init=function(t){var e,r=this;return n.data.Proxy.prototype.init.apply(this,arguments),t=t||{},e=t.config||{},e.idProperty="id",r.set("initOpts",t),r.set("config",e),r.initConfig(),r},e.prototype.getStatus=function(){return this.get("status")},e.prototype.getResponse=function(){return this.get("response")},e.prototype.read=function(t,e,n){var r,i,o,s=this;return i=s.getIdProperty(),"object"==typeof e[i]&&console.log(i),r=s.set.bind(s),o=s.getDb().getConnection().get(t,e[i]),o.done(function(t){r("status","success"),e[i]=t,r("response",e),n()}),o.fail(function(t){r("status","error"),r("response",t),n()}),s},e.prototype.create=function(t,e,n){var r,i,o,s=this;return r=s.set.bind(s),i=s.getIdProperty(),o=s.getDb().getConnection().put({name:t,keyPath:i},e),o.done(function(t){r("status","success"),e[i]=t,r("response",e),n()}),o.fail(function(t){r("status","error"),r("response",t),n()}),s},e.prototype.update=function(t,e,n){var r,i,o=this;return r=o.set.bind(o),i=o.getDb().getConnection().put(t,e),i.done(function(){return r("status","success"),r("response",e),n()}),i.fail(function(t){r("status","error"),r("response",t),n()}),o},e.prototype.destroy=function(t,e,n){var r,i,o,s=this;return i=s.getIdProperty(),r=s.set.bind(s),o=s.getDb().getConnection().remove(t,e[i]),o.done(function(){r("status","success"),r("response",{}),n()}),o.fail(function(t){r("status","error"),r("response",t),n()}),s},t.yamvc=n,t.yamvc.data=t.yamvc.data||{},t.yamvc.data.proxy=t.yamvc.data.proxy||{},t.yamvc.data.proxy.Ydn=e}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={set:function(t,e){var n="_"+t,r=this[n];return e!==r&&(this[n]=e,this.fireEvent(t+"Change",this,e,r)),this},get:function(t){return this["_"+t]}},r.GetSet=e,t.yamvc=n,t.yamvc.mixins=r}(window),function(t){"use strict";var e,n=t.yamvc||{},r=n.mixins||{};e={init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(t){if(this._suspendEvents)return!0;var e=!0,n=Array.prototype.shift;n.call(arguments);for(var r=0,i=this._listeners[t]||[],o=i.length;o>r;r++)if(e){var s=n.call(arguments);e=i[r].apply(s,arguments),e=e===undefined?!0:e}return e},addListener:function(t,e){var n=this._listeners[t]||[];return n.push(e),this._listeners[t]=n,this},removeListener:function(t,e){var n,r=this._listeners;if(r)if(e){if("function"==typeof e)for(var i=0,o=r.length;o>i;i++)r[i]===e&&(n=i);else n=e;r.splice(n,1)}else this._listeners=[];return this},suspendEvents:function(t){return t=t||!0,this.set("suspendEvents",t),this}},r.Observable=e,t.yamvc=n,t.yamvc.mixins=r}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend({defaults:{idProperty:"id"},init:function(t){n.Core.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=t.config||{},r.set("initOpts",t),r.set("config",e),r.initConfig(),r.initData()},initConfig:function(){var t=this,e=t.get("config");if(n.Core.prototype.initConfig.apply(this),!e.namespace)throw Error("Model need to have namespace property in your model configuration");return this},initData:function(){var t=this,e=t.get("initOpts");t.get("config"),t.set("data",e.data||{})},setDataProperty:function(t,e){var n=this,r=n._data,i=r[t];e!==i&&(r[t]=e,n.set("isDirty",!0),n.fireEvent("data"+t.charAt(0).toUpperCase()+t.slice(1)+"Change",n,e,i))},getDataProperty:function(t){var e=this;return e.get("data")[t]},property:function(){var t=arguments.length;return t>1?this.setDataProperty.apply(this,arguments):this.getDataProperty.apply(this,arguments)},setData:function(t){var e,n=this,r=n.get("data");for(e in t)t.hasOwnProperty(e)&&n.property(e,t[e]);n.fireEvent("dataChange",n,r)},clear:function(){var t,e=this,n=e.get("data");for(t in n)n.hasOwnProperty(t)&&e.property(t,null);e.set("data",{}),e.fireEvent("dataChange",e,n)},load:function(t){var e,n,r=this,i=r.get("data"),o=r.get("idProperty"),s=0;for(n in t)s++;if(0===s&&i[o]===undefined)throw Error("You need to pass at least one condition to load model");0===s&&(t[o]=i[o]),e=function(){"success"===r.getProxy().getStatus()?(r.set("isDirty",!1),r.set("data",r.getProxy().getResponse()),r.fireEvent("loaded",r,r.getProxy().getResponse(),"read")):r.fireEvent("error",r,"read")},r.getProxy().read(r.getNamespace(),t,e)},save:function(){var t,e,n=this,r=n.get("data"),i=n.get("idProperty");return n.get("isProcessing")?!1:(n.set("isProcessing",!0),t=function(){n.set("isProcessing",!1),"success"===n.getProxy().getStatus()?(n.set("isDirty",!1),n.set("data",n.getProxy().getResponse()),n.fireEvent("saved",n,n.getProxy().getResponse(),e)):n.fireEvent("error",n,e)},r[i]===undefined?(e="create",n.getProxy().create(n.getNamespace(),r,t)):(e="update",n.getProxy().update(n.getNamespace(),r,t)),!0)},remove:function(){var t,e=this,n=e.get("data"),r=e.get("idProperty");if(n[r]===undefined)throw Error("Can not remove empty model");t=function(){"success"===e.getProxy().getStatus()?(delete n[r],e.set("isDirty",!1),e.set("data",{}),e.fireEvent("removed",e,"destroy")):e.fireEvent("error",e,"destroy")},e.getProxy().destroy(e.getNamespace(),n,t)}}),t.yamvc=n,t.yamvc.Model=e}(window),function(t){"use strict";var e,n=t.yamvc||{};e=n.Core.extend({init:function(){this.set("routing",{}),this.bindEvents()},bindEvents:function(){return t.onhashchange=this.onHashChange.bind(this),this},onHashChange:function(){var e=this.get("routing"),n=t.location.hash.substr(1),r=n.split("/"),i=r.shift();if(e[i]){var o=[];if(e[i].params)for(var s=0,a=e[i].params.length;a>s;s++){var c=e[i].params[s],u=r[s],f=RegExp(c.substr(1,c.length-2));o.push(u.match(f).input)}e[i].callback.apply(null,o)}return this},restore:function(){return this.onHashChange(),this},when:function(t,e){var n=this.get("routing"),r=t.split("/"),i=r.shift();return n[i]={callback:e,params:r},this.set("routing",n),this}}),t.yamvc.Router=e}(window),function(t){"use strict";var e,n,r,i=t.yamvc||{};e={views:{},i:0,add:function(t,e){this.views[t]=e,this.i++},get:function(t){return this.views[t]}},n={tpl:{},add:function(t,e){this.tpl[t]=e},get:function(t){return this.tpl[t]}},r=i.Core.extend({init:function(t){i.Core.prototype.init.apply(this);var n,r,o=this;t=t||{},n=i.merge(o._config,t.config),n.id=r=n.id||"view-"+e.i,n.views=n.views||{},o.set("initOpts",t),o.set("config",n),o.initConfig(),e.add(r,o)},initConfig:function(){i.Core.prototype.initConfig.apply(this),this.initTemplate(),this.initModels()},initTemplate:function(){var t,e=this,r=e.get("config"),i=document.createElement("div");if(!r.tpl)throw Error(r.id+": no tpl set");if(!n.get(r.tpl)){if(t=document.getElementById(r.tpl),!t)throw Error("no tpl "+r.tpl+" found");n.add(r.tpl,t.parentNode.removeChild(t))}i.innerHTML=n.get(r.tpl).innerHTML,e.set("tpl",i)},initModels:function(){var t,e,n=this;if(!n.getModels)return n;t=n.getModels();for(e in t)t.hasOwnProperty(e)&&n.setModel(e,t[e]);return n},setModel:function(t,e){var n=this,r=n.getModels();return r[e.getNamespace()]=e,n.setModels(r),n},getModel:function(t){var e=this,n=e.getModels();return n[t]},render:function(t){var e,n,r,i=this,o=i.get("tpl"),s=document.createElement("div"),a=i.get("config"),c=a.renderTo,u=t||a.models,f=a.parent,l=a.parent;if(f?f=c&&f.queryEl(c)?f.queryEl(c):f.get("el"):c&&(f=document.querySelector(c)),r=o.innerHTML,u&&(n=r.match(/\{\{(.*?)\}\}/gi)))for(var p=0,d=n.length;d>p;p++){var g=n[p],h=g.substr(2,g.length-4).split(".");r=u[h[0]]!==undefined&&"function"!=typeof u[h[0]]?r.replace(g,u[h[0]].property(h[1])):r.replace(g,"")}s.innerHTML=r;for(var v=0;o.childNodes.length>v&&1!==o.childNodes.item(v).nodeType;)v++;return e=s.childNodes.item(v),e.setAttribute("yamvc-id",a.id),i.set("el",e),f&&(f.appendChild(e),l&&(l.views=l.views||{},l.views[a.id]=i),i.set("isInDOM",!0),i.reAppendChildren(),i.fireEvent("render",null,i)),e},partialRender:function(t){var e,n=this,r=n.get("tpl"),i=r.querySelector(t),o=n.queryEl(t),s=i.innerHTML,a=n.getModels();if(e=s.match(/\{\{(.*?)\}\}/gi))for(var c=0,u=e.length;u>c;c++){var f=e[c],l=f.substr(2,f.length-4).split(".");s=a[l[0]]!==undefined&&"function"!=typeof a[l[0]]?s.replace(f,a[l[0]].property(l[1])):s.replace(f,"")}return o.innerHTML=s,n.fireEvent("partialRender",null,n,o),n},queryEl:function(t){return this.get("el").querySelector(t)},queryEls:function(t){return this.get("el").querySelectorAll(t)},getChild:function(t){var e=this,n=e.get("config");return!n.views||n.views&&!n.views[t]?!1:n.views[t]},addChild:function(t,e){var n=this;return t.appendTo(n,e),n.fireEvent("elementAdded",n,t),n},removeChildren:function(){for(var t=this.get("config").views||[],e=0,n=t.length;n>e;e++)t[e].clear()},clear:function(){var t=this,e=t.get("el");return t.isInDOM()&&(e.parentNode.removeChild(e),t.set("isInDOM",!1)),t},isInDOM:function(){return this._isInDOM},appendTo:function(t,e){var n=this,r=n.get("config"),i=r.id,o=t.get("config").views,s=e?t.get("el").querySelector(e):t.get("el");return e&&(r.renderTo=e),r.parent?r.parent&&r.parent.get("config").id!==t.get("config").id&&delete r.parent.get("config").views[i]:r.parent=t,!n.isInDOM()&&t.isInDOM()&&(n.get("el")?(s.appendChild(n.get("el")),n.set("isInDOM",!0),n.reAppendChildren(),n.fireEvent("render",null,n)):n.render()),o[i]=n,r.parent=t,n},reAppendChildren:function(){var t=this.get("config").views;for(var e in t)t.hasOwnProperty(e)&&t[e].appendTo(this)},show:function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="block",e.set("visible",!0),e.fireEvent("show",e,t),e):e},hide:function(){var t,e=this;return e.isInDOM()?(t=e.get("el").style,t.display="none",e.set("visible",!1),e.fireEvent("hide",e,t),e):e},isVisible:function(){var t=this;return t.get("visible")&&t.isInDOM()}}),i.ViewManager=e,t.yamvc=i,t.yamvc.View=r}(window);
//@ sourceMappingURL=YAMVC-v0.1.6.min.js.map