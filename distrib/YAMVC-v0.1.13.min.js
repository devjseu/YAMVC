/*! YAMVC v0.1.13 - 2014-02-09 
 *  License:  */
(function(t){"use strict";var e,n=t.ya||{},r=n.mixins||{};e={find:function(t){for(var e,n=this.length,r=arguments.length,i=r>1?arguments[1]:null;n--;)if(e=this[n],r>1){if(e[t]===i)break}else if(e===t)break;return n}},r.Array=e,t.ya=n,t.ya.mixins=r})(window),function(t){"use strict";var e,n=t.ya||{},r=n.mixins||{};e={set:function(t,e){var n="_"+t,r=this[n];return e!==r&&(this[n]=e,this.fireEvent(t+"Change",this,e,r)),this},get:function(t){return this["_"+t]}},r.GetSet=e,t.ya=n,t.ya.mixins=r}(window),function(t){"use strict";var e,n=t.ya||{},r=n.mixins||{};e={init:function(){this.set("listeners",{}),this.set("suspendEvents",!1)},fireEvent:function(){if(this._suspendEvents)return!0;var t,e=!0,n=Array.prototype.shift,r=n.call(arguments);t=n.call(arguments);for(var i=0,a=this._listeners[r]||[],s=a.length;s>i;i++)e&&(e=a[i].apply(t,arguments),e=e===undefined?!0:e);return e},addEventListener:function(t,e){var n=this._listeners[t]||[];return n.push(e),this._listeners[t]=n,this},removeEventListener:function(t,e){var n,r=this._listeners[t]||[];if(r)if(e){if("function"==typeof e)for(var i=0,a=r.length;a>i;i++)r[i]===e&&(n=i);else n=e;r.splice(n,1)}else this._listeners[t]=[];return this},suspendEvents:function(){return this.set("suspendEvents",!0),this},resumeEvents:function(){return this.set("suspendEvents",!1),this}},r.Observable=e,t.ya=n,t.ya.mixins=r}(window),function(t){"use strict";function e(){for(var t=0,e=a.length;e>t;t++)a[t]()}var n,r,i=t.ya||{},a=[];i.$onReady=function(t){a.push(t),r||"complete"===document.readyState||(r=setInterval(function(){"complete"===document.readyState&&(clearInterval(r),e())},10))},i.$merge=function(t,e){var n,r={};for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r},i.$clone=function(t){return JSON.parse(JSON.stringify(t))},n=i.Core||function(){function t(){this.set("listeners",{}),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}return t.prototype.init=function(){},t.prototype.initConfig=function(){var t,e,n,r=this,i=r.get("config"),a=function(n){t="get"+n.charAt(0).toUpperCase()+n.slice(1),e="set"+n.charAt(0).toUpperCase()+n.slice(1),r[t]=function(){return r.get("config")[n]},r[e]=function(t){var e=r.get("config")[n];t!==e&&(r.get("config")[n]=t,r.fireEvent(n+"Change",this,t,e))}};for(n in i)i.hasOwnProperty(n)&&a(n)},t.prototype.bindMethods=function(t){for(var e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(this[e]=t[e].bind(this),delete t[e])},t.prototype.onChange=function(t,e){return this.addEventListener(t+"Change",e),this},t.prototype.unbindOnChange=function(t,e){for(var n=this._listeners[t+"Change"]||[],r=0,i=n.length;i>r;r++)n[r]===e&&n.splice(r,1);return this._listeners[t+"Change"]=n,this},t.$create=function(t){var e=this;return new e(t)},t.$mixin=function(t,e){var n,r;e?n="function"==typeof t?t.prototype:t:(e="function"==typeof t?t.prototype:t,n=this.prototype);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r])},t.__mixins__=[],t.__defaults__={},t.$extend=function(e){e=e||{};var n=this,r=function(){var e;this._config={};for(e in a)u.call(a,e)&&(this._config[e]=a[e]);t.apply(this,arguments)},a=i.$merge(n.__defaults__||{},e.defaults),s=e.mixins||[],o=e.static||{},u={}.hasOwnProperty,c=function(n,r){function i(){this.constructor=n}for(var c in r)u.call(r,c)&&(n[c]=r[c]);i.prototype=r.prototype,n.Parent=r.prototype,n.prototype=new i,n.$extend=t.$extend,n.$mixin=t.$mixin,n.$create=t.$create,n.__mixins__=[],n.__defaults__=a;for(var l in e)u.call(e,l)&&"function"==typeof e[l]&&(n.prototype[l]=e[l]);for(;s.length;)n.mixin(s.pop());for(var f in o)u.call(o,f)&&(n["$"+f]=o[f]);return n};return c(r,n),r},t.$mixin(i.mixins.GetSet),t.$mixin(i.mixins.Observable),t}(),i.Core=n,t.ya=i}(window),function(t){"use strict";var e,n=t.ya||{};e=n.Core.$extend({defaults:{namespace:null,proxy:null},init:function(t){e.Parent.init.apply(this,arguments);var r,i=this;return t=t||{},r=n.$merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.set("set",[]),i.set("cache",[]),i.set("removed",[]),i.set("filters",[]),i.initConfig(),i.initData(),i},initData:function(){var t=this,e=t.getData()||[];return t.set("raw",e),t.prepareData(e),t},forEach:function(t){var e,n,r=this,i=r._set;if(e=Object(i),n=e.length>>>0,"function"!=typeof t)throw new TypeError;for(var a=0;n>a;a++)a in e&&t.call(r,e[a],a,e)},push:function(t){var e,n=this,r=n.getModel(),i=n.getNamespace();for(Array.isArray(t)||(t=[t]);t.length;)e=t.pop(),e=new r({config:{namespace:i,data:e}}),n._cache.push(e),n.fireEvent("pushed",e);return n.filter(),n},count:function(){return this._set.length},clear:function(){var t=this;return t.set("set",[]),t.set("cache",[]),t.set("removed",[]),t},clearFilters:function(){var t=this;return t.set("filters",[]),t.filter(),t},clearFilter:function(t){var e,n,r=this,i=r._filters;for(e=i.length;e--;)if(n=i[e],"function"!=typeof n&&n.id===t){i.splice(e,1);break}return r.filter(),r},filter:function(t){var e,n=this,r=n._filters,i=!0,a=[],s=n._cache,o=0,u=null;arguments.length>1&&(u=arguments[0],t=arguments[1]),"function"==typeof t&&(u?r.push({id:u,fn:t}):r.push(t),n.fireEvent("beforeFilter",n,r));for(var c=0,l=s.length;l>c;c++){for(i=!0,o=r.length;o--;)e="function"==typeof r[o]?r[o]:r[o].fn,i=i&&e(s[c]);i&&a.push(s[c])}return n.set("set",a),n.fireEvent("afterFilter",n,r),n},getAt:function(t){return this._set[t]},getBy:function(t){for(var e=this,n=e._set,r=[],i=0,a=n.length;a>i;i++)t(n[i])&&r.push(n[i]);return r},findOneBy:function(t){for(var e=this,n=e._set,r=n.length;r--&&!t(n[r]););return r},getOneBy:function(t){for(var e,n=this,r=n._set,i=r.length;i--;)if(t(r[i])){e=r[i];break}return e},getTotal:function(){return this._total},load:function(t){var e,r,i=this,a=(i.get("data"),i.get("idProperty"),n.Promise.$deferred()),s=i.getNamespace(),o=new n.data.Action,u=0;for(r in t)u++;if(0===u)throw Error("You need to pass at least one condition to load model collection");if(!i.getProxy())throw Error("To load collection you need to set proxy");return e=function(){"success"===i.getProxy().getStatus()?i.fireEvent("loaded",i,o.getResponse(),"read"):i.fireEvent("error",i,"read")},o.setOptions({callback:e,params:t,namespace:s}),i.getProxy().read(o),a.promise},save:function(){for(var t,e,r,i,a=this,s=n.Promise.$deferred(),o=[],u=[],c=a._removed,l=a._cache,f=a.getNamespace(),d=a.getProxy(),h=0,p=[],g=0,v=l.length;v>g;g++)r=l[g],r._isDirty&&(r.hasId()?u.push(r._data):(r._data.__clientId__=r.get("clientId"),o.push(r._data)));return i=function(t){return function(e){return t.__clientId__?e.data("__clientId__")===t.__clientId__:e.data("id")===t.id}},e=function(t,e){if(h--,e.getStatus()===n.data.Action.Status.SUCCESS){var o,u=e.getResponse(),c=u.result;if(r=c[0],o=c.length,r&&(r.__clientId__||r.id))for(;o--;)r=a.getOneBy(i(c[o])),r.setDirty(!1),delete r._data.__clientId__;else a.set("removed",[])}else p.push(e.getResponse().error);0===h&&(p.length?(a.fireEvent("error",a,p),s.reject({errors:p})):(a.fireEvent("success",a),s.resolve({scope:a})))},o.length&&(h++,t=new n.data.Action,t.setOptions({namespace:f,callback:e}).setData(o),d.create(t)),u.length&&(h++,t=new n.data.Action,t.setOptions({namespace:f,callback:e}).setData(u),d.update(t)),c.length&&(h++,t=new n.data.Action,t.setOptions({namespace:f,callback:e}).setData(c),d.destroy(t)),s.promise},prepareData:function(t,e){var n=this,r=n.getModel(),i={namespace:n.getNamespace()},a=t.length,s=[];e=e||a;for(var o=0;a>o;o++)i.data=t[o],s.push(new r({config:i}));return n.set("cache",s),n.set("total",e),n.filter(),n},setData:function(){var t=this;return t.setRawData(data),t.prepareData(data),t},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(t){return this.set("raw",t),this},isDirty:function(){for(var t=this._cache,e=t.length,n=!1;e--;)t[e]._isDirty&&(n=!0);return this._remove&&(n=!0),n}}),t.ya=n,t.ya.Collection=e}(window),function(t){"use strict";var e,n,r,i=t.ya||{};r={controller:[],i:0,add:function(t,e){this.controller.push(e),this.i++},get:function(t){for(var e=this.controller.length;e--&&this.controller[e].getId()!==t;);return this.controller[e]}},e=i.Core.$extend({init:function(t){var e,a,s=this;return t=t||{},e=i.$merge(s._config,t.config),e.id=a=e.id||"controller-"+r.i,n=n||new i.Router,s.set("initOpts",t),s.set("config",e),s.set("routes",e.routes||{}),s.set("events",e.events||{}),s.set("views",e.views||{}),s.initConfig(),s.renderViews(),s.restoreRouter(),r.add(a,s),s},initConfig:function(){i.Core.prototype.initConfig.apply(this);var t,e,r=this,a=r.get("routes"),s=r.get("events"),o=r.get("views"),u=/(^\$|,$)/;if(a)for(var c in a)if(a.hasOwnProperty(c)){var l=r[a[c]].bind(r);n.when(c,l)}if(s&&o){for(e in o)o.hasOwnProperty(e)&&o[e].addEventListener("render",r.resolveEvents.bind(r));for(t in s)if(s.hasOwnProperty(t)&&u.test(t)){if(e=o[t.substr(1)])for(var f in s[t])s[t].hasOwnProperty(f)&&e.addEventListener(f,s[t][f].bind(r,e));delete s[t]}}return this},renderViews:function(){var t=this,e=t.get("views");for(var n in e)e.hasOwnProperty(n)&&e[n].getAutoCreate&&e[n].getAutoCreate()&&e[n].render()},resolveEvents:function(t){var e,n,r,i=this.get("events"),a=function(t,e,n){return t.bind(e,n)};for(var s in i)if(i.hasOwnProperty(s)){e=i[s],n=t.get("el").querySelectorAll(s);for(var o=0,u=n.length;u>o;o++)for(var c in e)e.hasOwnProperty(c)&&(r=a(e[c],this,t),n[o].addEventListener(c,r))}},getRouter:function(){return n},restoreRouter:function(){var t=this;return t.getRouter().restore(),t},redirectTo:function(e){return t.location.hash=e,this}}),t.ya.controllerManager=r,t.ya.Controller=e}(window),function(t){"use strict";var e,n,r=t.ya||{};n={PENDING:0,SUCCESS:1,FAIL:2},e=r.Core.$extend({init:function(t){var i,a=this;e.Parent.init.apply(this,arguments),t=t||{},i=r.$merge(a._config,t.config),a.set("initOpts",t),a.set("config",i),a.set("response",{}),a.set("status",n.PENDING),a.initConfig()},setData:function(t){return this.set("data",t),this},getData:function(){return this._data},setOptions:function(t){return this.set("options",t),this},getOptions:function(){return this._options},getOption:function(t){return this._options[t]},setResponse:function(t){return this.set("response",t)},getResponse:function(){return this.get("response")},setStatus:function(t){var e,r=!1;for(e in n)n.hasOwnProperty(e)&&n[e]===t&&(r=!0);if(!r)throw Error("ya.data.Action: Wrong status");return this.set("status",t)},getStatus:function(){return this.get("status")}}),e.Status=n,t.ya=r,t.ya.data=t.ya.data||{},t.ya.data.Action=e}(window),function(t){"use strict";var e,n=t.ya||{};e=n.Core.$extend({init:function(t){var r,i=this;e.Parent.init.apply(this,arguments),t=t||{},r=n.$merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.initConfig()},read:function(t){var e,r,i=this;if(!(t instanceof n.data.Action))throw Error("ya.data.Proxy: read argument action should be instance of ya.data.Action");if(e=t.getOptions(),r=e.params&&e.params.id,!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");return r===undefined?i.readBy(t):i.readById(t),i},create:function(t){var e=this;if(!(t instanceof n.data.Action))throw Error("ya.data.Proxy: create argument action should be instance of ya.data.Action");if(!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("ya.data.Proxy: Data should be object");return e},update:function(t){var e=this;if(!(t instanceof n.data.Action))throw Error("ya.data.Proxy: update argument action should be instance of ya.data.Action");if(!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("ya.data.Proxy: Data should be object");return e},destroy:function(t){var e=this;if(!(t instanceof n.data.Action))throw Error("ya.data.Proxy: destroy argument action should be instance of ya.data.Action");if(!t.getOption("namespace"))throw Error("ya.data.Proxy: namespace should be set");if(!t.getData()||"object"!=typeof t.getData())throw Error("Data should be pass as object");return e}}),t.ya=n,t.ya.data=t.ya.data||{},t.ya.data.Proxy=e}(window),function(t){"use strict";var e,n=t.ya||{},r=n.data.Proxy,i=n.data.Action;e=r.$extend({"static":{clear:function(t){var e,n=0;if(t)for(Array.isArray(t)||(t=[t]),n=t.length;n--;)e=t[n],delete localStorage[e],delete localStorage[e+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},readBy:function(t){var e,r,i,a,s,o,u,c=this,l=t.getOptions(),f=l.namespace,d=l.callback,h=l.limit||null,p=l.offset||0,g=l.filters||[],v=l.sorters||[],y={},m=[],_=[],E=!0,w=0;return s=function(t,e){var n=""+t[i],r=""+e[i],a=n.toLowerCase(),s=r.toLowerCase();return(a>s?1:s>a?-1:n>r?1:r>n?-1:0)*("desc"===o.toLowerCase()?-1:1)},e=function(){if(localStorage[f]){_=JSON.parse(localStorage[f]);for(var e=0,l=_.length;l>e;e++){for(E=!0,u=g.length;u--;)r=g[u].length>3?g[u][0]:"&&","&&"===r?E=c.executeCondition(_[e],g[u])&&E:"||"===r&&(E=c.executeCondition(_[e],g[u])||E);E&&m.push(_[e])}for(_=m,w=m.length,u=v.length;u--;)a=v[u],i=a[0],o=a[1]||"ASC",_.sort(s);h||(h=_.length-p),(p>0||h)&&(_=_.splice(p,h))}y.total=w,y.result=_,t.setStatus(n.data.Action.Status.SUCCESS).setResponse(y),d(c,t)},setTimeout(function(){try{e()}catch(n){y.error=n,d(c,t)}},0),c},readById:function(t){var e,r=this,i=t.getOptions(),a=i.params,s=i.namespace,o=i.callback,u=a.id,c=[],l={},f={};return e=function(){if(localStorage[s]){c=JSON.parse(localStorage[s]);for(var e=0,i=c.length;i>e;e++)c[e].id===u&&(l=c[e]);if(l.id!==undefined)return f.total=1,f.result=l,t.setStatus(n.data.Action.Status.SUCCESS).setResponse(f),o(r,t),r}r.setStatus(n.data.Action.Status.FAIL),f.error=Error("Not found"),o(r,t)},setTimeout(e,0),r},executeCondition:function(t,e){var n,r,i,a,s=!1;switch(e.length>3?(r=e[1],n=e[2],i=e[3]):(r=e[0],n=e[1],i=e[2]),n){case">":t[r]>i&&(s=!0);break;case"<":i>t[r]&&(s=!0);break;case">=":t[r]>=i&&(s=!0);break;case"<=":i>=t[r]&&(s=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),a=RegExp(i),a.test(t[r])&&(s=!0)}return s},create:function(t){var n,r,a=this,s=t.getData(),o=t.getOption("namespace"),u=t.getOption("callback"),c=[],l=1,f={};if(e.Parent.create.apply(this,arguments),localStorage[o]&&(c=JSON.parse(localStorage[o]),l=localStorage[o+"$Sequence"]),Array.isArray(s)){n=[];for(var d=0,h=s.length;h>d;d++)s[d].id=l++,delete s[d].__clientId__,c.push(s[d]),n.push(s[d])}else s.id=l++,delete s.__clientId__,c.push(s),n=s;return r=function(){try{localStorage[o]=JSON.stringify(c),localStorage[o+"$Sequence"]=l,f.result=n,t.setStatus(i.Status.SUCCESS).setResponse(f)}catch(e){f.error=e,t.setStatus(i.Status.FAIL).setResponse(f)}u(a,t)},setTimeout(r,0),a},update:function(t){var e,n,r,a,s,o=this,u=t.getData(),c=t.getOption("namespace"),l=t.getOption("callback"),f=[],d={};return s=function(){if(localStorage[c]){if(f=JSON.parse(localStorage[c]),Array.isArray(u))for(e=[],r=u.length;r--;)for(a=f.length,n=u[r].id;a--;)f[a].id===n&&(f[a]=u[r],e.splice(0,0,u[r]));else for(r=f.length,n=u.id;r--;)f[r].id===n&&(e=f[r]=u);try{localStorage[c]=JSON.stringify(f),d.success=!0,d.result=e,t.setStatus(i.Status.SUCCESS).setResponse(d)}catch(s){d.success=!1,d.error=s,t.setStatus(i.Status.FAIL).setResponse(d)}return l(o,t),o}d.success=!1,d.error=Error("Not found"),t.setStatus(i.Status.FAIL).setResponse(d),l(o,t)},setTimeout(s,0),o},destroy:function(t){var e,n,r,a,s=this,o=t.getData(),u=t.getOption("namespace"),c=t.getOption("callback"),l=[],f={};return a=function(){if(localStorage[u]){if(l=JSON.parse(localStorage[u]),Array.isArray(o))for(n=o.length;n--;)for(r=l.length,e=o[n].id;r--;)l[r].id===e&&l.splice(r,1);else for(n=l.length,e=o.id;n--;)l[n].id===e&&l.splice(n,1);try{localStorage[u]=JSON.stringify(l),f.success=!0,t.setStatus(i.Status.SUCCESS).setResponse(f)}catch(a){f.success=!1,f.error=a,t.setStatus(i.Status.FAIL).setResponse(f)}return c(s,t),s}f.success=!1,f.error=Error("Not found"),t.setStatus(i.Status.FAIL).setResponse(f),c(s,t)},setTimeout(a,0),s}}),t.ya=n,t.ya.data=t.ya.data||{},t.ya.data.proxy=t.ya.data.proxy||{},t.ya.data.proxy.Localstorage=e}(window),function(t){"use strict";var e,n=t.ya||{},r=n.mixins.Array.find;e=n.Core.$extend({defaults:{delegates:null},init:function(t){var r,i=this;return e.Parent.init.apply(this,arguments),t=t||{},r=n.$merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.initConfig(),i},initConfig:function(){var t=this;return e.Parent.initConfig.apply(this,arguments),t.setDelegates([]),t},add:function(t,e){var n,i,a=this,s=Object.keys(e).pop(),o=e[s],u={};return s=s.split(" "),i=s.shift(),0===i.search(/\$/)&&(i=i.replace("$",""),s=s.join(" "),n=a.findGroup(i),n>=0?(u=a.getDelegatesGroup(n),n=r.call(u.selectors,"selector",s),n>=0?u.selectors[0].events.push(o):u.selectors.push({selector:s,events:[o]})):(u.viewId=i,u.selectors=[{selector:s,events:[o]}],a.getDelegates().push(u))),a},findGroup:function(t){for(var e,n=this.getDelegates(),r=n.length;r--&&(e=n[r],e.viewId!==t););return r},getDelegatesGroup:function(t){return this.getDelegates()[t]},dispatch:function(){}}),t.ya=n,t.ya.event=t.ya.event||{},t.ya.event.dispatcher=e.$create()}(window),function(t){"use strict";var e,n=t.ya||{},r=0;e=n.Core.$extend({defaults:{idProperty:"id",proxy:null},init:function(t){n.Core.prototype.init.apply(this,arguments);var e,r=this;t=t||{},e=n.$merge(r._config,t.config),r.set("initOpts",t),r.set("config",e),r.set("isDirty",!0),r.initConfig(),r.initData()},initConfig:function(){var t=this,n=t._config;if(!n.namespace)throw Error("Model need to have namespace");return n.data||(n.data={}),t.set("clientId",n.namespace+"-"+r++),e.Parent.initConfig.apply(this),t},initData:function(){var t=this;return t.set("data",t.getData()||{}),t},setDataProperty:function(t,e){var n=this,r=n._data,i=r[t];e!==i&&(r[t]=e,n.set("isDirty",!0),n.fireEvent("data"+t.charAt(0).toUpperCase()+t.slice(1)+"Change",n,e,i))},getDataProperty:function(t){return this.get("data")[t]},data:function(t){var e,n=this,r=arguments.length;if(r>1)this.setDataProperty.apply(this,arguments);else{if("object"!=typeof t)return this.getDataProperty.apply(this,arguments);for(e in t)t.hasOwnProperty(e)&&n.setDataProperty(e,t[e])}return n},clear:function(){var t,e=this,n=e.get("data");for(t in n)n.hasOwnProperty(t)&&e.data(t,null);e.set("data",{}),e.fireEvent("dataChange",e,n)},load:function(t){var e,r=this,i=r.get("data"),a=r.getIdProperty(),s=n.Promise.$deferred(),o=new n.data.Action,u={};if(t[a]===undefined&&i[a]===undefined)throw Error("You need to pass id to load model");return t[a]=i[a],u.namespace=r.getNamespace(),u.params=t,u.callback=function(){e=r.getProxy().getResponse(),"success"===r.getProxy().getStatus()?(r.set("isDirty",!1),r.set("data",e),s.resolve({scope:r,response:e,action:"read"}),r.fireEvent("loaded",r,e,"read")):(s.reject({scope:r,response:e,action:"read"}),r.fireEvent("error",r,e,"read"))},o.setOptions(u),r.getProxy().read(o),s.promise},save:function(){var t,e,r=this,i=r.get("data"),a=r.getIdProperty(),s=n.Promise.$deferred(),o=new n.data.Action,u=r.getProxy(),c={};return r.get("isProcessing")||!r.get("isDirty")?!1:(r.set("isProcessing",!0),c.namespace=r.getNamespace(),c.callback=function(i,a){t=a.getResponse(),r.set("isProcessing",!1),a.getStatus()===n.data.Action.Status.SUCCESS?(r.set("isDirty",!1),r.set("data",t.result),s.resolve({scope:r,action:a,type:e}),r.fireEvent("saved",r,a,e)):(s.reject({scope:r,action:a,type:e}),r.fireEvent("error",r,a,e))},o.setOptions(c).setData(i),i[a]===undefined?(e="create",u.create(o)):(e="update",u.update(o)),s.promise)},remove:function(){var t,e=this,r=e.get("data"),i=e.getIdProperty(),a=n.Promise.$deferred(),s=new n.data.Action,o=e.getProxy(),u={};if(r[i]===undefined)throw Error("Can not remove empty model");return u.namespace=e.getNamespace(),u.callback=function(r,i){t=i.getResponse(),i.getStatus()===n.data.Action.Status.SUCCESS?(e.set("isDirty",!1),e.set("data",{}),a.resolve({scope:e,action:i,type:"remove"}),e.fireEvent("removed",e,"remove")):(a.reject({scope:e,action:i,type:"remove"}),e.fireEvent("error",e,"remove"))},s.setOptions(u).setData(r),o.destroy(s),o.destroy(s),a.promise},hasId:function(){return!!this._data[this._config.idProperty]},setDirty:function(t){return this.set("isDirty",!!t),this},isDirty:function(){return this._isDirty}}),t.ya=n,t.ya.Model=e}(window),"document"in self&&!("classList"in document.createElement("_"))&&function(t){"use strict";if("Element"in t){var e="classList",n="prototype",r=t.Element[n],i=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},o=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},u=function(t,e){if(""===e)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(t,e)},c=function(t){for(var e=a.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=function(){t.setAttribute("class",""+this)}},l=c[n]=[],f=function(){return new c(this)};if(o[n]=Error[n],l.item=function(t){return this[t]||null},l.contains=function(t){return t+="",-1!==u(this,t)},l.add=function(){var t,e=arguments,n=0,r=e.length,i=!1;do t=e[n]+"",-1===u(this,t)&&(this.push(t),i=!0);while(r>++n);i&&this._updateClassName()},l.remove=function(){var t,e=arguments,n=0,r=e.length,i=!1;do{t=e[n]+"";var a=u(this,t);-1!==a&&(this.splice(a,1),i=!0)}while(r>++n);i&&this._updateClassName()},l.toggle=function(t,e){t+="";var n=this.contains(t),r=n?e!==!0&&"remove":e!==!1&&"add";return r&&this[r](t),!n},l.toString=function(){return this.join(" ")},i.defineProperty){var d={get:f,enumerable:!0,configurable:!0};try{i.defineProperty(r,e,d)}catch(h){-2146823252===h.number&&(d.enumerable=!1,i.defineProperty(r,e,d))}}else i[n].__defineGetter__&&r.__defineGetter__(e,f)}}(self),function(t){"use strict";var e,n,r,i=t.ya||{};n={PENDING:0,FULFILLED:1,REJECTED:2},e=function(t){var e,i,a=this;a._state=n.PENDING,a._queue=[],e=function(t){r(a,t)},i=function(t){a.transition(n.REJECTED,t)},t&&t(e,i)},e.prototype.transition=function(t,e){var r=this;return r._state==t||r._state!==n.PENDING||t!=n.FULFILLED&&t!=n.REJECTED||2>arguments.length?!1:(r._state=t,r._value=e,r.run(),undefined)},e.prototype.run=function(){var t,e,i,a=this;e=function(t){return t},i=function(t){throw t},a._state!=n.PENDING&&setTimeout(function(){for(;a._queue.length;){var s=a._queue.shift();try{t=(a._state==n.FULFILLED?s.fulfill||e:s.reject||i)(a._value)}catch(o){s.promise.transition(n.REJECTED,o);continue}r(s.promise,t)}},0)},e.prototype.then=function(t,n){var r=this,i=new e;return r._queue.push({fulfill:"function"==typeof t&&t,reject:"function"==typeof n&&n,promise:i}),r.run(),i},e.prototype.resolve=function(t,i){if(t===i)t.transition(n.REJECTED,new TypeError);else if(i&&i.constructor==e)i.state==n.PENDING?i.then(function(e){r(t,e)},function(e){t.transition(n.REJECTED,e)}):t.transition(i.state,i.value);else if("object"!=typeof i&&"function"!=typeof i||null===i)t.transition(n.FULFILLED,i);else{var a=!1;try{var s=i.then;"function"==typeof s?s.call(i,function(e){a||(r(t,e),a=!0)},function(e){a||(t.transition(n.REJECTED,e),a=!0)}):t.transition(n.FULFILLED,i)}catch(o){a||t.transition(n.REJECTED,o)}}},e.prototype.getState=function(){return this._state},r=e.prototype.resolve,e.State=n,e.$create=function(t){var e=this;return new e(t)},e.$resolved=function(t){return new e(function(e){e(t)})},e.$rejected=function(t){return new e(function(e,n){n(t)})},e.$deferred=function(){var t,n;return{promise:e.$create(function(e,r){t=e,n=r}),resolve:t,reject:n}},i.Promise=e,t.ya=i}(window),function(t){"use strict";var e,n=t.ya||{};e=n.Core.$extend({init:function(){this.set("routing",{}),this.bindEvents()},bindEvents:function(){return t.onhashchange=this.onHashChange.bind(this),this},onHashChange:function(){var e=this.get("routing"),n=t.location.hash.substr(1),r=n.split("/"),i=r.shift();if(e[i]){var a=[];if(e[i].params)for(var s=0,o=e[i].params.length;o>s;s++){var u=e[i].params[s],c=r[s],l=RegExp(u.substr(1,u.length-2));a.push(c.match(l).input)}e[i].callback.apply(null,a)}return this},restore:function(){return this.onHashChange(),this},when:function(t,e){var n=this.get("routing"),r=t.split("/"),i=r.shift();return n[i]={callback:e,params:r},this.set("routing",n),this}}),t.ya.Router=e}(window),function(t,e){"use strict";function n(t){for(var e={},n=t.split(","),r=0;n.length>r;r++)e[n[r]]=!0;return e}function r(){0===d&&(h=setInterval(i,32)),d=+new Date}function i(){var t,e,n,r=+new Date;if(r-d>=32)for(clearInterval(h),d=0,t=a.views,e=t.length,n=0;e>n;)t[n].getFit()&&t[n].fireEvent("resize",t[n]),n++}var a,s,o,u,c=t.ya||{},l=document.createElement("style"),f=0,d=0,h=0;u=n("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),l.innerHTML=".ya.inline {display:inline;} .ya.hidden {display: none !important;}",l.setAttribute("type","text/css"),document.body.appendChild(l),t.addEventListener("resize",r),a={views:[],i:0,add:function(t,e){this.views.push(e),this.i++},get:function(t){for(var e=this.views.length;e--&&this.views[e].getId()!==t;);return this.views[e]}},s={tpl:{},add:function(t,e){this.tpl[t]=e},get:function(t){return this.tpl[t]}},o=c.Core.$extend({defaults:{parent:null,fit:!1,hidden:!1,models:null},init:function(t){c.Core.prototype.init.apply(this);var e,n,r=this;return t=t||{},e=c.$merge(r._config,t.config),e.id=n=e.id||"view-"+a.i,e.children=e.children||[],r.set("initOpts",t),r.set("config",e),r.initConfig(),a.add(n,r),r},initConfig:function(){return c.Core.prototype.initConfig.apply(this),this.initTemplate(),this.initModels(),this},initTemplate:function(){var t,e=this,n=e.get("config"),r=document.createElement("div");if(!n.tpl)throw Error(n.id+": no tpl set");if(n.tpl instanceof c.view.Template)r.innerHTML=n.tpl.getHtml().innerHTML;else if(s.get(n.tpl))r.innerHTML=s.get(n.tpl).innerHTML;else{if(t=document.getElementById(n.tpl),!t)throw Error("no tpl "+n.tpl+" found");s.add(n.tpl,t.parentNode.removeChild(t)),r.innerHTML=s.get(n.tpl).innerHTML}return e.set("tpl",r),e},initModels:function(){var t=this;return t},setModel:function(t,e){var n=this,r=n.getModels();return r.push(e),n.setModels(r),n.resolveModelBindings(e),n},getModel:function(t){var e,n=this,r=n.getModels(),i=null;for(e=r.length;e--;)if(r[e].getNamespace()===t){i=r[e];break}return i},render:function(){var t,n,r,i,a,s,o,c,l,d,h=this,p=h._tpl,g=h._config,v=g.renderTo,y=g.parent,m=g.parent,_=[],E=[],w=0,C=0,S=0,D=[];for(h.isInDOM()&&h.removeRendered(),y?y=v&&y.queryEl(v)?y.queryEl(v):y._el:v&&(y=document.querySelector(v)),s=p.cloneNode(!0),o=document.createTreeWalker(s,NodeFilter.SHOW_ALL,null,!1),c=o.nextNode();c;){if(3===c.nodeType){if(t=c.data.match(/\{\{(.*?)\}\}/gi)){var b=c.value||c.data,A=document.createElement("span"),O="v-r-b-"+f++;for(w=0,S=t.length,E=[],A.setAttribute("id",O);S>w;)n=t[w++],r=n.substr(2,n.length-4).split("."),h.getModel(r[0])?(i=h.getModel(r[0]).data(r[1]),i===e&&(i="")):i="",b=b.replace(n,i),E.push(r);A.appendChild(document.createTextNode(b)),_.push({original:c.value||c.data,headers:E,type:3,pointer:A,oldDOM:c})}}else for(D=c.attributes,C=D.length;C--;)if(d=D.item(C),t=d.value&&d.value.match(/\{\{(.*?)\}\}/gi)){var P=d.value,x=u[d.nodeName];for(w=0,S=t.length,E=[],i=x?!0:"";S>w;)n=t[w++],r=n.substr(2,n.length-4).split("."),x?i=i&&h.getModel(r[0]).data(r[1]):(h.getModel(r[0])&&(i=h.getModel(r[0]).data(r[1])||""),d.value=d.value.replace(n,i)),E.push(r);x?i?c.setAttribute(d.nodeName,i):c.removeAttribute(d.nodeName):"css"===d.nodeName&&(a=d.value,d=document.createAttribute("style"),d.value=a,c.removeAttribute("css"),D.setNamedItem(d)),_.push({original:P,headers:E,fillAttr:x||!1,type:2,attrName:d.nodeName,pointer:c})}else"css"===d.nodeName&&(a=d.value,d=document.createAttribute("style"),d.value=a,c.removeAttribute("css"),D.setNamedItem(d));c=o.nextNode()}return 1===s.childNodes.length&&1===s.childNodes.item(0).nodeType?l=s.childNodes.item(0):(l=s,l.classList.add("inline")),l.setAttribute("id",g.id),l.classList.add("ya"),h.set("el",l),h.set("bindings",_),h.resolveBindings(),h.getHidden()&&h.hide(),y&&(y.appendChild(l),m&&0>m.findChild(h.getId())&&m.getChildren().push(h),h.set("isInDOM",!0),h.reAppendChildren(),h.fireEvent("render",null,h)),l},resolveModelBindings:function(t){var e,n,r,i,a,s=this,o=s._bindings,u=0,c=0;for(e=function(t){return function(){s.partialRender(t)}},c=o.length;c--;)for(i=o[c],n=i.headers,u=n.length;u--;)t.getNamespace()===n[u][0]&&(r=n[u][1],a="data"+r.charAt(0).toUpperCase()+r.slice(1)+"Change",i.fn=e(i),t.addEventListener(a,i.fn),i.fn())},resolveBindings:function(){var t,e,n,r,i,a,s=this,o=s._bindings,u=0,c=0;for(t=function(t){return function(){s.partialRender(t)}},c=o.length;c--;)for(i=o[c],n=i.headers,3===i.type&&i.oldDOM&&(i.oldDOM.parentNode.replaceChild(i.pointer,i.oldDOM),delete i.oldDOM),u=n.length;u--;)e=s.getModel(n[u][0]),r=n[u][1],e&&(i.fn=t(i),a="data"+r.charAt(0).toUpperCase()+r.slice(1)+"Change",e.addEventListener(a,i.fn))},partialRender:function(t){for(var e,n=this,r=3===t.type,i=r?t.original:t.fillAttr?!0:t.original,a=t.headers,s=a.length;s--;)e=a[s],i=r||!t.fillAttr?i.replace("{{"+e.join(".")+"}}",n.getModel(e[0]).data(e[1])):i&&n.getModel(e[0]).data(e[1]);return r?t.pointer.textContent=i:t.fillAttr&&!i?t.pointer.removeAttribute(t.attrName):t.pointer.setAttribute(t.attrName,i),n},removeBindings:function(){for(var t,e,n,r,i,a=this,s=a._bindings,o=s.length;o--;)for(t=s[o],r=t.headers.length;r--;)n=t.headers[r],e=a.getModel(n[0]),i="data"+n[1].charAt(0).toUpperCase()+n[1].slice(1)+"Change",e.removeEventListener(i,t.fn);return a},removeRendered:function(){var t=this;return t._el.parentNode.removeChild(t._el),t.removeBindings(),t.set("el",null),t.set("isInDOM",!1),t},queryEl:function(t){return this.get("el").querySelector(t)},queryEls:function(t){return this.get("el").querySelectorAll(t)},addChild:function(t,e){var n=this;return t.appendTo(n,e),n.fireEvent("elementAdded",n,t),n},getChild:function(t){var e=this;return 0>e.findChild(t)?!1:e.findChild(t)},findChild:function(t){for(var e=this.getChildren(),n=e.length;n--&&e[n].getId()!==t;);return n},removeChild:function(t){for(var e=this.getChildren(),n=e.length,r=[];n--;)e[n].getId()===t&&(r=e.splice(n,1),r[0].clear());return r[0]||null},removeChildren:function(){for(var t=this.getChildren(),e=t.length,n=[];e--;)n.push(t[e].clear());return n},clear:function(){var t=this,e=t._el;return t.isInDOM()&&(e.parentNode.removeChild(e),t.set("isInDOM",!1)),t},isInDOM:function(){return this._isInDOM},appendTo:function(t,e){var n=this,r=n.get("config"),i=n.getId(),a=t.getChildren(),s=r.parent,o=e?t._el.querySelector(e):t._el;return e&&(r.renderTo=e),s?s&&s.getId()!==t.getId()&&s.findChild(i)>-1&&s.getChildren().splice(s.findChild(i),1):r.parent=t,a.push(n),r.parent=t,n.fireEvent("append",null,n,t),!n.isInDOM()&&t.isInDOM()&&(n._el?(o.appendChild(n._el),n.set("isInDOM",!0),n.reAppendChildren(),n.fireEvent("render",null,n)):n.render()),n},reAppendChildren:function(){for(var t=this.getChildren(),e=t.length,n=0;e>n;n++)t[n].appendTo(this);return this},show:function(){var t=this;return t._el?(t._el.classList.remove("hidden"),t.set("visible",!0),t.fireEvent("show",t),t):t},hide:function(){var t=this;return t._el?(t._el.classList.add("hidden"),t.set("visible",!1),t.fireEvent("hide",t),t):t},toggle:function(){var t=this;t._visible?t.hide():t.show()},isVisible:function(){return this.get("visible")&&this.isInDOM()}}),c.viewManager=a,t.ya=c,t.ya.View=o}(window),function(t){"use strict";var e,n=t.ya||{};e=n.Core.$extend({init:function(t){var r,i=this;e.Parent.init.apply(this,arguments),t=t||{},r=n.$merge(i._config,t.config),i.set("initOpts",t),i.set("config",r),i.initConfig(),i.initTpl()
},initConfig:function(){var t=this,n=t.get("config");if(e.Parent.initConfig.apply(this),!n.id)throw Error("ya.data.Template: Template need to have id");return t},initTpl:function(){var t=this,e=t.getTpl(),n=document.createElement("div");Array.isArray(e)&&(e=e.join("")),n.innerHTML=e,t.set("html",n)},getHtml:function(){return this._html}}),t.ya=n,t.ya.view=t.ya.view||{},t.ya.view.Template=e}(window);
//@ sourceMappingURL=YAMVC-v0.1.13.min.js.map