/*! yam v0.2.0 - 2014-03-25 
 *  License:  */
(function(){"use strict";function e(){for(var e=0,t=i.length;t>e;e++)i[e]()}var t,n=window.ya||{},r="app",i=[];n.$onReady=function(n){i.push(n),t||"complete"===document.readyState||(t=setInterval(function(){"complete"===document.readyState&&(clearInterval(t),e())},10))},n.$merge=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&t[n]!==undefined&&(e[n]=t[n]);return e},n.$clone=function(e){return JSON.parse(JSON.stringify(e))},n.$set=function(){for(var e,t=3>arguments.length?r:arguments[0],n=3>arguments.length?arguments[0].split("."):arguments[1].split("."),i=3>arguments.length?arguments[1]:arguments[2],a=window[t]=window[t]||{};n.length;)e=n.shift(),0===n.length?a[e]=i:a=a[e]=a[e]||{};return this},n.$get=function(){var e,t=2>arguments.length?r:arguments[0],n=2>arguments.length?arguments[0]:arguments[1],i=n?n.search(/\./)>0?n.split("."):[n]:[],a=null;for(i.length&&(a=window[t]=window[t]||{});i.length;)if(e=i.shift(),a[e])a=a[e];else{if(!(e in window)){a=null;break}a=window[e]}return a},n.$factory=function(e){var t,i,a;if(!e.alias)throw n.Error.$create("Factory method needs alias property","YA1");return t=n.$get(e.module||r,e.alias),a=e.methods||{},a.config=e,delete e.alias,delete e.module,delete e.methods,i=t.$create(a)},n.$module=function(){var e=arguments.length?arguments[0]:null;return e&&(r=e),r},window.ya=n})(),ya.$set("ya","mixins.Array",{find:function(e,t){var n,r,i=e.length,a=arguments.length,s=a>2?arguments[2]:null;if(a>1)for(;i--;){for(r=e[i],n=t.split(".");n.length;)r=r[n.shift()];if(r===s)break}else for(;i--&&(r=e[i],r!==t););return i},findAll:function(e,t){for(var n,r=e.length,i=arguments.length,a=i>2?arguments[2]:null,s=[];r--;)n=e[r],i>1?n[t]===a&&s.push(r):n===t&&s.push(r);return s},findAllByFn:function(e,t){for(var n=e.length,r=[];n--;)t(e[n])&&r.push(n);return r},each:Array.prototype.forEach?function(e,t){Array.prototype.forEach.call(e,t)}:function(e,t){if(void 0===e||null===e)throw new TypeError;var n=Object(e),r=n.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=0;r>i;i++)i in n&&t.call(e,n[i],i,n)},some:Array.prototype.some?function(e,t){return Array.prototype.some.call(e,t)}:function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1}}),ya.$set("ya","mixins.CoreStatic",{$extend:function(e){e=e||{};var t,n,r=this,i=this.prototype,a=(r.__mixins__||[]).concat(e.mixins||[]),s=e.static||{},o=/xyz/.test(function(){})?/\b__super\b/:/.*/,l=function(e,t){return function(){var n=this.__super;this.__super=i[e];var r=t.apply(this,arguments);return this.__super=n,r}},u={}.hasOwnProperty;return t=function(){var e,n,r=t.__defaults__,i=r.length,a=0,s={};for(this._config={};i>a;)e=r[a],"function"==typeof e&&(e=e()),ya.$merge(s,e),a++;for(n in s)u.call(s,n)&&(this._config[n]=s[n]);ya.Core.apply(this,arguments)},n=function(t,n){function r(){this.constructor=t}for(var c in n)u.call(n,c)&&(t[c]=n[c]);r.prototype=n.prototype,t.prototype=new r,t.prototype.__module__=e.module||ya.$module(),t.prototype.__class__=t.prototype.__module__+"."+e.alias;for(var d in ya.mixins.CoreStatic)ya.mixins.CoreStatic.hasOwnProperty(d)&&(t[d]=ya.mixins.CoreStatic[d]);for(var f in e)t.prototype[f]="function"==typeof e[f]&&"function"==typeof i[f]&&o.test(e[f])?l(f,e[f]):e[f];for(t.__mixins__=a.slice(),t.__defaults__=n.__defaults__.slice(),e.defaults&&t.__defaults__.push(e.defaults);a.length;){var h=a.pop();t.$mixin(h)}for(var p in s)u.call(s,p)&&(t["$"+p]=s[p]);return t},n(t,r),e.alias&&ya.$set(e.module||ya.$module(),e.alias,e.singleton?new t:t),t},$create:function(){var e=this,t=Array.prototype.concat.apply([e],arguments);return new(Function.prototype.bind.apply(e,t))},$mixin:function(e,t){var n,r;t?n="function"==typeof e?e.prototype:e:(t="function"==typeof e?e.prototype:e,n=this.prototype);for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r])}}),function(){"use strict";function e(e){for(var t={},n=e.split(","),r=0;n.length>r;r++)t[n[r]]=!0;return t}var t;t=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),ya.$set("ya","mixins.CSSStyle",{isFillAttr:function(e){return t[e]!==undefined},get:function(){}})}(),ya.$set("ya","mixins.DOM",{isQueryMatch:function(e,t){var n,r,i,a=!0;if(t=this._el||t,-1===e.search(" ")){if(n=e.match(/^[^\.#]+/gi),r=e.match(/#[^\.#]+/gi),i=e.match(/\.[^\.#]+/gi),n&&t.nodeName.toLowerCase()!==n.pop()&&(a=!1),i)for(;i.length;)if(!t.classList.contains(i.pop().substring(1))){a=!1;break}r&&t.getAttribute("id")!==r.pop().substring(1)&&(a=!1)}else a=!1;return a},isElement:function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},removeChildren:function(e){for(var t=document.createDocumentFragment();e.hasChildNodes();)t.appendChild(e.removeChild(e.firstChild));return t},toString:function(e){var t,n=function(e){var t;if("undefined"!=typeof XMLSerializer){var n=new XMLSerializer;t=n.serializeToString(e)}else e.xml&&(t=e.xml);return t},r=0,i="";if(e instanceof DocumentFragment)for(e=e.firstChild;e;)i+=n(e),e=e.nextSibling;else if(e instanceof NodeList)for(t=e.length;t>r;)i+=n(e);else e instanceof HTMLElement&&(i=n(e));return i}}),ya.$set("ya","mixins.GetSet",{set:function(e,t){var n="_"+e,r=this[n];return t!==r&&(this[n]=t,this.fireEvent(e+"Change",this,t,r)),this},get:function(e){return this["_"+e]}}),ya.$set("ya","mixins.Observable",{fireEvent:function(){if(this._suspendEvents)return!0;for(var e=!0,t=Array.prototype.shift,n=t.call(arguments),r=0,i=this._listeners[n]||[],a=i.length;a>r;r++)e&&(e=i[r].apply(i[r],arguments),e=e===void 0?!0:e);return e},addEventListener:function(e,t,n){var r=this._listeners[e]||[];return r.push(n?t.bind(n):t),this._listeners[e]=r,this},removeEventListener:function(e,t){var n,r=this._listeners[e]||[];if(r)if(t){if("function"==typeof t)for(var i=0,a=r.length;a>i;i++)r[i]===t&&(n=i);else n=t;r.splice(n,1)}else this._listeners[e]=[];return this},suspendEvents:function(){var e=this;return e.set("suspendEvents",(e._suspendEvents||0)+1),this},resumeEvents:function(){var e=this;return e.set("suspendEvents",--e._suspendEvents),e}}),ya.$set("ya","Core",function(){"use strict";function e(){this.set("listeners",{}),this.set("suspendEvents",!1),this.bindMethods.apply(this,arguments),this.init.apply(this,arguments)}var t=window.ya;e.prototype.init=function(e){return this.initConfig(e).initDefaults().initRequired()},e.prototype.initConfig=function(){return this},e.prototype.initDefaults=function(){return this},e.prototype.initRequired=function(){return this},e.prototype.initConfig=function(e){var n,r,i,a,s=this,o=function(e){n="get"+e.charAt(0).toUpperCase()+e.slice(1),r="set"+e.charAt(0).toUpperCase()+e.slice(1),s[n]=function(){return s.get("config")[e]},s[r]=function(t){var n=s.get("config")[e];t!==n&&(s.get("config")[e]=t,s.fireEvent(e+"Change",this,t,n))}};e=e||{},i=t.$merge(s._config,e.config),s.set("initOpts",e),s.set("config",i);for(a in i)i.hasOwnProperty(a)&&o(a);return s},e.prototype.bindMethods=function(e){var t=this;for(var n in e)e.hasOwnProperty(n)&&"function"==typeof e[n]&&(t[n]=e[n].bind(t),delete e[n]);return t},e.prototype.onChange=function(e,t){var n=this;return n.addEventListener(e+"Change",t),n},e.prototype.unbindOnChange=function(e,t){for(var n=this,r=n._listeners[e+"Change"]||[],i=0,a=r.length;a>i;i++)r[i]===t&&r.splice(i,1);return this._listeners[e+"Change"]=r,n},e.__mixins__=[],e.__defaults__=[];for(var n in t.mixins.CoreStatic)t.mixins.CoreStatic.hasOwnProperty(n)&&(e[n]=t.mixins.CoreStatic[n]);return e.$mixin(t.mixins.GetSet),e.$mixin(t.mixins.Observable),e}()),ya.Core.$extend({module:"ya",alias:"Error",defaults:{id:null,message:null,stack:null},init:function(){var e=this;e.initConfig(arguments).initDefaults()},initConfig:function(e){var t=this;return t.__super({config:{message:e[0],id:e[1]}}),t},initDefaults:function(){var e=this;return e.setStack(Error(e.getMessage()).stack),e},toString:function(){var e=this;return"ya.Error("+e.getId()+"): "+e.getMessage()}}),ya.Core.$extend({module:"ya",alias:"Manager",defaults:{items:null},mixins:[ya.mixins.Array],initDefaults:function(){var e=this;return e.setItems([]),e},getItem:function(e){var t,n=this,r=n.getItems();return t=n.find(r,"id",e),t>-1?r[t].item:null},getCount:function(){return this.getItems().length},register:function(e,t){var n=this;if(n.isRegistered(e))throw ya.Error.$create(this.__class__+": ID "+e+" already registered.","YVTM1");return n.getItems().push({id:e,item:t}),n.fireEvent("registered",t),n},deregister:function(e){var t,n=this,r=n.getItems();return t=n.find(r,"id",e),t>-1&&n.fireEvent("unregistered",r.slice(t,1)),n},isRegistered:function(e){return this.find(this.getItems(),"id",e)>-1?!0:!1}}),ya.Manager.$extend({module:"ya",alias:"collection.$Manager",singleton:!0}),ya.Manager.$extend({module:"ya",alias:"controller.$Manager",singleton:!0}),ya.Manager.$extend({module:"ya",alias:"view.$Manager",singleton:!0}),ya.Manager.$extend({module:"ya",alias:"view.template.$Manager",singleton:!0}),ya.Core.$extend({module:"ya",alias:"Collection",defaults:{id:null,namespace:null,model:null,proxy:null},init:function(e){var t=this;return t.__super(e).initData(),ya.collection.$Manager.register(t.getId(),t),t},initDefaults:function(){var e=this;return e.setId(e.getId()||"collection-"+ya.collection.$Manager.getCount()),e.setModel(e.getModel()||ya.$get("ya.Model")),e.set("set",[]),e.set("cache",[]),e.set("removed",[]),e.set("filters",[]),e.set("sorters",[]),e.set("raw",e.getData()||[]),e},initData:function(){var e=this;return e.prepareData(e._raw),e},each:function(e){var t,n,r=this,i=r._set;if(t=Object(i),n=t.length>>>0,"function"!=typeof e)throw ya.Error.$create("forEach argument should be a function","COL1");for(var a=0;n>a;a++)a in t&&e.call(r,t[a],a,t);return r},push:function(e){var t,n=this,r=n.getModel(),i=n.getNamespace(),a=[];for(Array.isArray(e)||(e=[e]);e.length;){if(t=e.shift(),t instanceof r||(t=new r({config:{namespace:i,data:t}})),t.getNamespace()!==n.getNamespace())throw ya.Error.$create("Model should have same namespace as collection","COL2");n._cache.push(t),a.push(t)}return n.suspendEvents(),n.filter(),n.sort(),n.resumeEvents(),n.fireEvent("push",n,a),n},remove:function(e){var t,n,r,i=this,a=ya.mixins.Array.some,s=[];for(t=function(e,t){return e._clientId===n._clientId?(r=t,!0):void 0},Array.isArray(e)||(e=[e]);e.length;)n=e.pop(),r=-1,a(i._cache,t),r>=0&&s.push(i._cache.splice(r,1).pop());return i.suspendEvents(),i.filter(),i.resumeEvents(),i.fireEvent("remove",i,s),i},removeAll:function(){var e=this,t=e._cache.slice();return e.set("set",[]),e.set("cache",[]),e.fireEvent("remove",e,t),e},count:function(){return this._set.length},clear:function(){var e=this;return e.set("set",[]),e.set("cache",[]),e.set("removed",[]),e.fireEvent("clear",e),e},filter:function(e){var t,n=this,r=n._filters,i=!0,a=[],s=n._cache,o=0,l=null;arguments.length>1&&(l=arguments[0],e=arguments[1]),"function"==typeof e&&(l?r.push({id:l,fn:e}):r.push(e),n.fireEvent("beforeFilter",n,r));for(var u=0,c=s.length;c>u;u++){for(i=!0,o=r.length;o--;)t="function"==typeof r[o]?r[o]:r[o].fn,i=i&&t(s[u]);i&&a.push(s[u])}return n.set("set",a),n.set("total",a.length),n.fireEvent("filter",n,r),n},clearFilters:function(){var e=this;return e.set("filters",[]),e.filter(),e},clearFilter:function(e){var t,n,r=this,i=r._filters;for(t=i.length;t--;)if(n=i[t],"function"!=typeof n&&n.id===e){i.splice(t,1);break}return r.filter(),r},sort:function(e){var t,n,r,i,a,s=this,o=s._set;for(e=e?s._sorters.concat(e):s._sorters,s._sorters=s._sorters.concat(e),t=function(e,t){var n=""+e.data(i),r=""+t.data(i),s=n.toLowerCase(),o=r.toLowerCase();return(s>o?1:o>s?-1:n>r?1:r>n?-1:0)*("desc"===a.toLowerCase()?-1:1)},n=e.length;n--;)r=e[n],i=r[0],a=r[1]||"ASC",o.sort(t);s.fireEvent("sort",s,e)},clearSorters:function(){var e=this;return e.set("sorters",[]),e.sort(),e},getAt:function(e){return this._set[e]},getBy:function(e){for(var t=this,n=t._set,r=[],i=0,a=n.length;a>i;i++)e(n[i])&&r.push(n[i]);return r},findOneBy:function(e){for(var t=this,n=t._set,r=0,i=n.length;i>r&&!e(n[r]);)r++;return i},getOneBy:function(e){for(var t,n=this,r=n._set,i=0,a=r.length;a>i;){if(e(r[i])){t=r[i];break}i++}return t},getTotal:function(){return this._total},load:function(e){var t,n,r=this,i=ya.$Promise.deferred(),a=r.getNamespace(),s=ya.data.Action.$create(),o=0;for(n in e)o++;if(0===o)throw ya.Error.$create("You need to pass at least one condition to load model collection","COL3");if(!r.getProxy())throw ya.Error.$create("To load collection you need to set proxy","COL4");return t=function(){"success"===r.getProxy().getStatus()?(r.fireEvent("load",r,s.getResponse(),"read"),r.setData(s.getData())):r.fireEvent("error",r,"read")},s.setOptions({callback:t,params:e,namespace:a}),r.getProxy().read(s),i.promise},save:function(){for(var e,t,n,r,i=this,a=ya.$Promise.deferred(),s=[],o=[],l=i._removed,u=i._cache,c=i.getNamespace(),d=i.getProxy(),f=0,h=[],p=0,g=u.length;g>p;p++)n=u[p],n._isDirty&&(n.hasId()?o.push(n._data):(n._data.__clientId__=n.get("clientId"),s.push(n._data)));return r=function(e){return function(t){return e.__clientId__?t.data("__clientId__")===e.__clientId__:t.data("id")===e.id}},t=function(e,t){if(f--,t.getStatus()===ya.data.Action.$status.SUCCESS){var s,o=t.getResponse(),l=o.result;if(n=l[0],s=l.length,n&&(n.__clientId__||n.id))for(;s--;)n=i.getOneBy(r(l[s])),n.setDirty(!1),delete n._data.__clientId__;else i.set("removed",[])}else h.push(t.getResponse().error);0===f&&(h.length?(i.fireEvent("error",i,h),a.reject({errors:h})):(i.fireEvent("save",i),a.resolve({scope:i})))},s.length&&(f++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(s),d.create(e)),o.length&&(f++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(o),d.update(e)),l.length&&(f++,e=ya.data.Action.$create(),e.setOptions({namespace:c,callback:t}).setData(l),d.destroy(e)),a.promise},prepareData:function(e){for(var t=this,n=t.getModel(),r={namespace:t.getNamespace()},i=e.length,a=[],s=0;i>s;s++)r.data=e[s],a.push(new n({config:r}));return t.set("cache",a),t.suspendEvents(!0),t.filter(),t.sort(),t.resumeEvents(),t.fireEvent("prepare"),t},setData:function(){var e=this;return e.setRawData(data),e.prepareData(data),e},getData:function(){return this._set},getRawData:function(){return this._raw},setRawData:function(e){return this.set("raw",e),this},isDirty:function(){for(var e=this._cache,t=e.length,n=!1;t--;)e[t]._isDirty&&(n=!0);return this._remove&&(n=!0),n}}),ya.Core.$extend({module:"ya",alias:"Controller",defaults:{id:null,routes:null,events:null},"static":{router:null,getRouter:function(){return ya.Controller.$router=ya.Controller.$router||new ya.Router,ya.Controller.$router}},init:function(e){var t=this;return t.__super(e).initEvents().initRoutes(),ya.controller.$Manager.register(t.getId(),t),ya.$onReady(function(){t.restoreRouter()}),t},initDefaults:function(){var e=this;return e.setId(e.getId()||"controller-"+ya.controller.$Manager.getCount()),e.set("router",ya.Controller.$getRouter()),e.set("dispatcher",ya.event.$dispatcher),e},initEvents:function(){var e,t,n,r,i,a=this,s=a.getEvents(),o=[],l=RegExp("\\$([^\\s]+)"),u=a._dispatcher;if(s){for(var c in s)if(s.hasOwnProperty(c)){r={},r[c]=i=s[c];for(var d in i)i.hasOwnProperty(d)&&"function"!=typeof i[d]&&(i[d]=a[i[d]]);if(u.add(a,r),e=c.match(l),!e)throw ya.Error.$create(a.__class__+": Event query should begin from id of the view (current query: "+d+")","CTRL1");0>o.indexOf(e[1])&&o.push(e[1])}for(n=o.length;n--;)t=ya.view.$Manager.getItem(o[n]),t&&(t.isInDOM()?a.resolveEvents(t):t.addEventListener("render",a.resolveEvents,a))}return a},initRoutes:function(){var e=this,t=e.getRoutes(),n=e._router;if(t)for(var r in t)if(t.hasOwnProperty(r)){var i=e[t[r]].bind(e);n.when(r,i)}return e},resolveEvents:function(e){var t,n,r,i,a,s=this.getEvents(),o=function(e,t,n){return e.bind(t,n)},l=RegExp("\\$([^\\s]+)");for(var u in s)if(s.hasOwnProperty(u)&&(t=u.match(l),t&&t[1]===e.getId())){n=s[u],i=u.split(" ").slice(1),r=i.length?e.get("el").querySelectorAll(i.join(" ")):[e.get("el")];for(var c=0,d=r.length;d>c;c++)for(var f in n)n.hasOwnProperty(f)&&(a=o(n[f],this,e),r[c].addEventListener(f,a))}},getRouter:function(){return router},getView:function(e){return ya.view.$Manager.getItem(e)},getController:function(e){return ya.controller.$Manager.getItem(e)},getCollection:function(e){return ya.collection.$Manager.getItem(e)},restoreRouter:function(){var e=this;return e.getRouter().restore(),e},redirectTo:function(e){return window.location.hash=e,this}}),ya.Core.$extend({module:"ya",alias:"data.Action","static":{status:{PENDING:0,SUCCESS:1,FAIL:2}},initDefaults:function(){var e=this;return e.set("response",{}),e.set("status",ya.data.Action.$status.PENDING),e},setData:function(e){return this.set("data",e),this},getData:function(){return this._data},setOptions:function(e){return this.set("options",e),this},getOptions:function(){return this._options},getOption:function(e){return this._options[e]},setResponse:function(e){return this.set("response",e)},getResponse:function(){return this.get("response")},setStatus:function(e){var t,n=ya.data.Action.$status,r=!1;for(t in n)n.hasOwnProperty(t)&&n[t]===e&&(r=!0);if(!r)throw ya.Error.$create("ya.data.Action: Wrong status","ACTION1");return this.set("status",e)},getStatus:function(){return this.get("status")}}),ya.Core.$extend({module:"ya",alias:"data.Proxy",read:function(e){var t,n,r=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: read argument action should be instance of ya.data.Action");if(t=e.getOptions(),n=t.params&&t.params.id,!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");return n===void 0?r.readBy(e):r.readById(e),r},create:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: create argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("ya.data.Proxy: Data should be object");return t},update:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: update argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("ya.data.Proxy: Data should be object");return t},destroy:function(e){var t=this;if(!(e instanceof ya.data.Action))throw ya.Error.$create("ya.data.Proxy: destroy argument action should be instance of ya.data.Action");if(!e.getOption("namespace"))throw ya.Error.$create("ya.data.Proxy: namespace should be set");if(!e.getData()||"object"!=typeof e.getData())throw ya.Error.$create("Data should be pass as object");return t}}),ya.data.Proxy.$extend({module:"ya",alias:"data.proxy.Localstorage","static":{clear:function(e){var t,n=0;if(e)for(Array.isArray(e)||(e=[e]),n=e.length;n--;)t=e[n],delete localStorage[t],delete localStorage[t+"$Sequence"];else for(var r in localStorage)delete localStorage[r],delete localStorage[r+"$Sequence"]}},readBy:function(e){var t,n,r,i,a,s,o,l=this,u=e.getOptions(),c=u.namespace,d=u.callback,f=u.limit||null,h=u.offset||0,p=u.filters||[],g=u.sorters||[],y={},m=[],v=[],_=!0,w=0;return a=function(e,t){var n=""+e[r],i=""+t[r],a=n.toLowerCase(),o=i.toLowerCase();return(a>o?1:o>a?-1:n>i?1:i>n?-1:0)*("desc"===s.toLowerCase()?-1:1)},t=function(){if(localStorage[c]){v=JSON.parse(localStorage[c]);for(var t=0,u=v.length;u>t;t++){for(_=!0,o=p.length;o--;)n=p[o].length>3?p[o][0]:"&&","&&"===n?_=l.executeCondition(v[t],p[o])&&_:"||"===n&&(_=l.executeCondition(v[t],p[o])||_);_&&m.push(v[t])}for(v=m,w=m.length,o=g.length;o--;)i=g[o],r=i[0],s=i[1]||"ASC",v.sort(a);f||(f=v.length-h),(h>0||f)&&(v=v.splice(h,f))}y.total=w,y.result=v,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(y),d(l,e)},setTimeout(function(){try{t()}catch(n){y.error=n,d(l,e)}},0),l},readById:function(e){var t,n=this,r=e.getOptions(),i=r.params,a=r.namespace,s=r.callback,o=i.id,l=[],u={},c={};return t=function(){if(localStorage[a]){l=JSON.parse(localStorage[a]);for(var t=0,r=l.length;r>t;t++)l[t].id===o&&(u=l[t]);if(u.id!==void 0)return c.total=1,c.result=u,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(c),s(n,e),n}n.setStatus(ya.data.Action.$status.FAIL),c.error=ya.Error.$create("Not found"),s(n,e)},setTimeout(t,0),n},create:function(e){var t,n,r=this,i=e.getData(),a=e.getOption("namespace"),s=e.getOption("callback"),o=[],l=1,u={};if(r.__super.apply(this,arguments),localStorage[a]&&(o=JSON.parse(localStorage[a]),l=localStorage[a+"$Sequence"]),Array.isArray(i)){t=[];for(var c=0,d=i.length;d>c;c++)i[c].id=l++,delete i[c].__clientId__,o.push(i[c]),t.push(i[c])}else i.id=l++,delete i.__clientId__,o.push(i),t=i;return n=function(){try{localStorage[a]=JSON.stringify(o),localStorage[a+"$Sequence"]=l,u.result=t,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(u)}catch(n){u.error=n,e.setStatus(ya.data.Action.$status.FAIL).setResponse(u)}s(r,e)},setTimeout(n,0),r},update:function(e){var t,n,r,i,a,s=this,o=e.getData(),l=e.getOption("namespace"),u=e.getOption("callback"),c=[],d={};return a=function(){if(localStorage[l]){if(c=JSON.parse(localStorage[l]),Array.isArray(o))for(t=[],r=o.length;r--;)for(i=c.length,n=o[r].id;i--;)c[i].id===n&&(c[i]=o[r],t.splice(0,0,o[r]));else for(r=c.length,n=o.id;r--;)c[r].id===n&&(t=c[r]=o);try{localStorage[l]=JSON.stringify(c),d.success=!0,d.result=t,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(d)}catch(a){d.success=!1,d.error=a,e.setStatus(ya.data.Action.$status.FAIL).setResponse(d)}return u(s,e),s}d.success=!1,d.error=ya.Error.$create("Not found"),e.setStatus(ya.data.Action.$status.FAIL).setResponse(d),u(s,e)},setTimeout(a,0),s},destroy:function(e){var t,n,r,i,a=this,s=e.getData(),o=e.getOption("namespace"),l=e.getOption("callback"),u=[],c={};return i=function(){if(localStorage[o]){if(u=JSON.parse(localStorage[o]),Array.isArray(s))for(n=s.length;n--;)for(r=u.length,t=s[n].id;r--;)u[r].id===t&&u.splice(r,1);else for(n=u.length,t=s.id;n--;)u[n].id===t&&u.splice(n,1);try{localStorage[o]=JSON.stringify(u),c.success=!0,e.setStatus(ya.data.Action.$status.SUCCESS).setResponse(c)}catch(i){c.success=!1,c.error=i,e.setStatus(ya.data.Action.$status.FAIL).setResponse(c)}return l(a,e),a}c.success=!1,c.error=ya.Error.$create("Not found"),e.setStatus(ya.data.Action.$status.FAIL).setResponse(c),l(a,e)},setTimeout(i,0),a},executeCondition:function(e,t){var n,r,i,a,s=!1;switch(t.length>3?(r=t[1],n=t[2],i=t[3]):(r=t[0],n=t[1],i=t[2]),n){case">":e[r]>i&&(s=!0);break;case"<":i>e[r]&&(s=!0);break;case">=":e[r]>=i&&(s=!0);break;case"<=":i>=e[r]&&(s=!0);break;case"like":"%"!==i.charAt(0)&&(i="^"+i),"%"!==i.charAt(i.length-1)&&(i+="$"),i=i.replace(/%/g,""),a=RegExp(i),a.test(e[r])&&(s=!0)}return s}}),ya.Core.$extend({module:"ya",singleton:!0,alias:"event.$dispatcher",defaults:{delegates:null},initDefaults:function(){var e=this;return e.setDelegates([]),e},add:function(e,t){var n=this,r=Object.keys(t).pop();return n.getDelegates().push({selector:r,scope:e,events:t[r]}),n},apply:function(e){for(var t,n,r,i,a=this,s=a.getDelegates(),o=[],l=e,u=[],c=function(e){return e.selector.search(r)>=0},d=ya.mixins.DOM.isQueryMatch,f=ya.mixins.Array.findAllByFn,h=ya.mixins.Array.each;e;)r=RegExp("^\\$"+e.getId()+"[\\s]"),o=f(s,c),o.length&&h(o,function(r){u.length=0,n=s[r],t=n.selector.split(" "),t.shift(),t.length&&(u=l.querySelectorAll(t.pop()),i=t.slice(),h(u,function(t){if(i.length)for(var r=t,s=i.pop();e.getId()!==r.getAttribute("id");){if(d(s,r)){if(0===i.length){a.assignEvents(t,n,e);break}s=i.pop()}r=r.parentNode}else a.assignEvents(t,n,e)}))}),e=e.getParent()},assignEvents:function(e,t,n){var r,i=t.events;for(r in i)i.hasOwnProperty(r)&&e.addEventListener(r,i[r].bind(t.scope,n),!1)},clear:function(){return this.getDelegates().length=0,this}}),ya.Core.$extend({module:"ya",alias:"Job","static":{id:0,INFINITY:"infinity"},defaults:{id:null,delay:0,tasks:null,repeat:1,spawn:!1,results:null,maxTime:null},initRequired:function(){var e=this;if(!e.getTasks()&&!e._config.task)throw ya.Error.$create("At least one task should be defined","YJ1");return e},initDefaults:function(){var e=this,t=e._config,n=t.tasks||[],r=t.task;return r&&n.push(r),e.setId(ya.Job.$id++),e.setTasks(n.reverse()),e.setResults([]),e.set("semaphore",n.length),e},doit:function(){var e,t,n,r=this,i=ya.$Promise.deferred();return e=r.getRepeat()>1||r.getRepeat()===ya.Job.$INFINITY?{terminate:function(e,t){return clearInterval(r._clear),i.reject({id:e,message:t})}}:{terminate:function(e,t){return clearInterval(r._clear),i.reject({id:e,message:t})}},e.run=function(e,t){r.set("clear",setInterval(e,t))},e.finish=function(){return r.getTasks().splice(n,1),r._semaphore--,0===r._semaphore||0>r.getRepeat()?(clearInterval(r._clear),i.resolve({success:!0,message:"Task finished",results:r.getResults()})):void 0},t=function(){var t,i=r.getRepeat(),a=r.getTasks(),s=r.getMaxTime(),o=[];if(s&&+new Date-r._start>s)return e.terminate("YJ3","Timeout");for(i!==ya.Job.$INFINITY&&(r.setRepeat(--i),0>i&&e.finish()),t=a.length;t--;)n=t,o.push(a[t].call(e));r.getResults().push(o)},r.set("engine",e),r.set("start",+new Date),e.run(t,r.getDelay()),i.promise},terminate:function(){return this._engine.terminate("YJ2","Task terminated after "+(+new Date-this._start)/1e3+" seconds of execution")}}),ya.Core.$extend({module:"ya",alias:"Model","static":{id:0,idGenerator:function(){return ya.Model.$id++}},defaults:{idProperty:"id",proxy:null,namespace:null,data:null},initRequired:function(){var e=this;if(!e.getNamespace())throw ya.Error.$create("Model need to have namespace");return e},initDefaults:function(){var e=this;return e.set("isDirty",!0),e.set("clientId",e.getNamespace()+"-"+ya.Model.$idGenerator()),e.set("data",e.getData()||{}),e},setDataProperty:function(e,t){var n=this,r=n._data,i=r[e];t!==i&&(r[e]=t,n.set("isDirty",!0),n.fireEvent("data"+e.charAt(0).toUpperCase()+e.slice(1)+"Change",n,t,i))},getDataProperty:function(e){return this.get("data")[e]},data:function(e){var t,n=this,r=arguments.length;if(r>1)this.setDataProperty.apply(this,arguments);else{if("object"!=typeof e)return this.getDataProperty.apply(this,arguments);for(t in e)e.hasOwnProperty(t)&&n.setDataProperty(t,e[t])}return n},clear:function(){var e,t=this,n=t.get("data");for(e in n)n.hasOwnProperty(e)&&t.data(e,null);t.set("data",{}),t.fireEvent("dataChange",t,n)},load:function(e){var t,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.$Promise.deferred(),s=new ya.data.Action,o={};if(e[i]===void 0&&r[i]===void 0)throw ya.Error.$create("You need to pass id to load model");return e[i]=r[i],o.namespace=n.getNamespace(),o.params=e,o.callback=function(){t=n.getProxy().getResponse(),"success"===n.getProxy().getStatus()?(n.set("isDirty",!1),n.set("data",t),a.resolve({scope:n,response:t,action:"read"}),n.fireEvent("loaded",n,t,"read")):(a.reject({scope:n,response:t,action:"read"}),n.fireEvent("error",n,t,"read"))},s.setOptions(o),n.getProxy().read(s),a.promise},save:function(){var e,t,n=this,r=n.get("data"),i=n.getIdProperty(),a=ya.$Promise.deferred(),s=new ya.data.Action,o=n.getProxy(),l={};return n.get("isProcessing")||!n.get("isDirty")?!1:(n.set("isProcessing",!0),l.namespace=n.getNamespace(),l.callback=function(r,i){e=i.getResponse(),n.set("isProcessing",!1),i.getStatus()===ya.data.Action.$status.SUCCESS?(n.set("isDirty",!1),n.set("data",e.result),a.resolve({scope:n,action:i,type:t}),n.fireEvent("saved",n,i,t)):(a.reject({scope:n,action:i,type:t}),n.fireEvent("error",n,i,t))},s.setOptions(l).setData(r),r[i]===void 0?(t="create",o.create(s)):(t="update",o.update(s)),a.promise)},remove:function(){var e,t=this,n=t.get("data"),r=t.getIdProperty(),i=ya.$Promise.deferred(),a=new ya.data.Action,s=t.getProxy(),o={};if(n[r]===void 0)throw ya.Error.$create("Can not remove empty model");return o.namespace=t.getNamespace(),o.callback=function(n,r){e=r.getResponse(),r.getStatus()===ya.data.Action.$status.SUCCESS?(t.set("isDirty",!1),t.set("data",{}),i.resolve({scope:t,action:r,type:"remove"}),t.fireEvent("removed",t,"remove")):(i.reject({scope:t,action:r,type:"remove"}),t.fireEvent("error",t,"remove"))},a.setOptions(o).setData(n),s.destroy(a),s.destroy(a),i.promise},hasId:function(){return!!this._data[this._config.idProperty]},setDirty:function(e){return this.set("isDirty",!!e),this},isDirty:function(){return this._isDirty}}),ya.Core.$extend({module:"ya",alias:"Module",defaults:function(){return{maxLoadingTime:1e4,module:null,requires:[],modules:[],bus:{}}},init:function(e){return this.__super(e).initDependencies()},initDefaults:function(){var e=this;return e.setModule(e.getModule()||e.__module__),e.__super()},initRequired:function(){var e=this;if(!e.getModule())throw ya.Error.$create(e.__class__+": Module name is required","YM1");return e},initDependencies:function(){var e=this,t=[];return t.push(function(){e.initRequires(this)}),t.push(function(){e.initModules(this)}),ya.Job.$create({config:{tasks:t,delay:16,repeat:ya.Job.$INFINITY,maxTime:e.getMaxLoadingTime()}}).doit().then(function(){e.continueInit()})["catch"](function(){e.onError.apply(e,arguments)}),e},initRequires:function(e){var t,n,r,i,a,s,o=this,l=ya.mixins.Array.each,u=o.getRequires(),c=u.length,d=!0,f=0,h=[];for(t=function(e){switch(e){case"-i":h.push(r.$create());break;case"-p":n.push(r);break;case"-ip":s=r.$create(),n.push(s),h.push(s)}};c>f;)r=ya.$get(o.getModule()+"."+u[f].split(" ").shift()),null===r&&(d=!1),f++;if(d){for(n=[],f=0;c>f;)r=u[f].split(" "),i=r.shift(),a=r.join("").match(/-(\w+)/g),r=ya.$get(o.getModule()+"."+i),a&&l(a,t),f++;o.set("initialized",h),o.set("args",n),e.finish()}},initModules:function(e){var t=this;return e.finish(),t},continueInit:function(){var e=this;return e.initBus().onReady.apply(e,e._args),e},initBus:function(){var e,t,n,r,i,a,s=this,o=s.getBus();for(var l in o)if(o.hasOwnProperty(l)){if(r=o[l].split(":"),n=l.split(":"),i=n.pop(),a=r.pop(),e=s.findConn(n),t=s.findConn(r),0>e||0>t)continue;n=s._initialized[e],r=s._initialized[t],n.addEventListener(i,r[a])}return s},findConn:function(e){var t,n,r,i=this;return t=e.pop(),n=e.pop()||i.__module__,r=[n,t].join("."),ya.mixins.Array.find(i._initialized,"__class__",r)},onReady:function(){},onError:function(){}}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),"document"in self&&!("classList"in document.createElement("_"))&&function(e){"use strict";if("Element"in e){var t="classList",n="prototype",r=e.Element[n],i=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},o=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},u=function(e){for(var t=a.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",""+this)}},c=u[n]=[],d=function(){return new u(this)};if(o[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",-1!==l(this,e)
},c.add=function(){var e,t=arguments,n=0,r=t.length,i=!1;do e=t[n]+"",-1===l(this,e)&&(this.push(e),i=!0);while(r>++n);i&&this._updateClassName()},c.remove=function(){var e,t=arguments,n=0,r=t.length,i=!1;do{e=t[n]+"";var a=l(this,e);-1!==a&&(this.splice(a,1),i=!0)}while(r>++n);i&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),!n},c.toString=function(){return this.join(" ")},i.defineProperty){var f={get:d,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,f)}catch(h){-2146823252===h.number&&(f.enumerable=!1,i.defineProperty(r,t,f))}}else i[n].__defineGetter__&&r.__defineGetter__(t,d)}}(self),window.matchMedia||(window.matchMedia=function(){"use strict";var e=window.styleMedia||window.media;if(!e){var t=document.createElement("style"),n=document.getElementsByTagName("script")[0],r=null;t.type="text/css",t.id="matchmediajs-test",n.parentNode.insertBefore(t,n),r="getComputedStyle"in window&&window.getComputedStyle(t,null)||t.currentStyle,e={matchMedium:function(e){var n="@media "+e+"{ #matchmediajs-test { width: 1px; } }";return t.styleSheet?t.styleSheet.cssText=n:t.textContent=n,"1px"===r.width}}}return function(t){return{matches:e.matchMedium(t||"all"),media:t||"all"}}}()),function(){"use strict";if(window.matchMedia&&window.matchMedia("all").addListener)return!1;var e=window.matchMedia,t=e("only all").matches,n=!1,r=0,i=[],a=function(){clearTimeout(r),r=setTimeout(function(){for(var t=0,n=i.length;n>t;t++){var r=i[t].mql,a=i[t].listeners||[],s=e(r.media).matches;if(s!==r.matches){r.matches=s;for(var o=0,l=a.length;l>o;o++)a[o].call(window,r)}}},30)};window.matchMedia=function(r){var s=e(r),o=[],l=0;return s.addListener=function(e){t&&(n||(n=!0,window.addEventListener("resize",a,!0)),0===l&&(l=i.push({mql:s,listeners:o})),o.push(e))},s.removeListener=function(e){for(var t=0,n=o.length;n>t;t++)o[t]===e&&o.splice(t,1)},s}}(),ya.$set("ya","$Promise",function(e){"use strict";function t(t){function n(e){return e}function r(e){return u(e)}function s(e){var t=o(),n=0,r=isArray(e)?[]:{};return a(e,function(e,i){n++,l(e).then(function(e){r.hasOwnProperty(i)||(r[i]=e,--n||t.resolve(r))},function(e){r.hasOwnProperty(i)||t.reject(e)})}),0===n&&t.resolve(r),t.promise}var o=function(){var a,s,u=[];return s={resolve:function(t){if(u){var n=u;u=e,a=l(t),n.length&&setTimeout(function(){for(var e,t=0,r=n.length;r>t;t++)e=n[t],a.then(e[0],e[1],e[2])},0)}},reject:function(e){s.resolve(c(e))},notify:function(e){if(u){var t=u;u.length&&setTimeout(function(){for(var n,r=0,i=t.length;i>r;r++)n=t[r],n[2](e)},0)}},promise:{then:function(e,s,l){var c=o(),d=function(r){try{c.resolve((i(e)?e:n)(r))}catch(a){c.reject(a),t(a)}},f=function(e){try{c.resolve((i(s)?s:r)(e))}catch(n){c.reject(n),t(n)}},h=function(e){try{c.notify((i(l)?l:n)(e))}catch(r){t(r)}};return u?u.push([d,f,h]):a.then(d,f,h),c.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=o();return t?n.resolve(e):n.reject(e),n.promise}function r(r,a){var s=null;try{s=(e||n)()}catch(o){return t(o,!1)}return s&&i(s.then)?s.then(function(){return t(r,a)},function(e){return t(e,!1)}):t(r,a)}return this.then(function(e){return r(e,!0)},function(e){return r(e,!1)})}}}},l=function(e){return e&&i(e.then)?e:{then:function(t){var n=o();return setTimeout(function(){n.resolve(t(e))},0),n.promise}}},u=function(e){var t=o();return t.reject(e),t.promise},c=function(e){return{then:function(n,a){var s=o();return setTimeout(function(){try{s.resolve((i(a)?a:r)(e))}catch(n){s.reject(n),t(n)}}),s.promise}}},d=function(e,a,s,c){var d,f=o(),h=function(e){try{return(i(a)?a:n)(e)}catch(r){return t(r),u(r)}},p=function(e){try{return(i(s)?s:r)(e)}catch(n){return t(n),u(n)}},g=function(e){try{return(i(c)?c:n)(e)}catch(r){t(r)}};return setTimeout(function(){l(e).then(function(e){d||(d=!0,f.resolve(l(e).then(h,p,g)))},function(e){d||(d=!0,f.resolve(p(e)))},function(e){d||f.notify(g(e))})}),f.promise};return{deferred:o,reject:u,when:d,all:s}}var n,r=window.ya||{},i=function(e){return"function"==typeof e},a=r.mixins.Array.each,s=[];return n=t(function(e){s.push(e)}),n.getStack=function(){return s},n}()),ya.Core.$extend({module:"ya",alias:"Router",init:function(e){var t=this;return t.__super(e).bindEvents(),t},initDefaults:function(){var e=this;return e.set("routing",{}),e},bindEvents:function(){var e=this;return window.onhashchange=e.onHashChange.bind(e),this},onHashChange:function(){var e=this.get("routing"),t=window.location.hash.substr(1),n=t.split("/"),r=n.shift();if(e[r]){var i=[];if(e[r].params)for(var a=0,s=e[r].params.length;s>a;a++){var o=e[r].params[a],l=n[a],u=RegExp(o.substr(1,o.length-2));i.push(l.match(u).input)}e[r].callback.apply(null,i)}return this},restore:function(){return this.onHashChange(),this},when:function(e,t){var n=this,r=n.get("routing"),i=e.split("/"),a=i.shift();return r[a]={callback:t,params:i},n.set("routing",r),n}}),function(){"use strict";function e(){0===a&&(s=setInterval(t,32)),a=+new Date}function t(){var e,t,r,i=+new Date;if(i-a>=32)for(clearInterval(s),a=0,e=n.view.$Manager.getItems(),t=e.length,r=0;t>r;)e[r].item.getFit()&&e[r].item.fireEvent("resize",e[r]),r++}var n=window.ya,r=document.createElement("style"),i=Array.prototype.slice,a=0,s=0;r.innerHTML=".ya.inline {display:inline;} .ya.hidden {display: none !important;}",r.setAttribute("type","text/css"),document.body.appendChild(r),window.addEventListener("resize",e),n.Core.$extend({module:"ya",alias:"View",defaults:{id:null,parent:null,children:null,fit:!1,hidden:!1,models:null,collections:null,autoCreate:!1,tpl:null},mixins:[n.mixins.Array,n.mixins.DOM],init:function(e){var t=this;return t.__super(e).initModels().initTemplate().initParent(),n.view.$Manager.register(t.getId(),t),t},initRequired:function(){var e=this;if(!e.getTpl())throw n.Error.$create(e.__class__+": no tpl set for "+e.getId(),"YV1");return e},initDefaults:function(){var e=this;return e.setId(e.getId()||"view-"+n.view.$Manager.getCount()),e.setChildren(e.getChildren()||[]),e.setModels(e.getModels()||[]),e.setCollections(e.getCollections()||[]),e},initModels:function(){var e=this;return e.each(e.getModels(),function(t,r,i){if(!(t instanceof n.Model)){t.alias||(t.module="ya",t.alias="Model");try{i[r]=n.$factory(t)}catch(a){throw n.Error.$create(e.__class__+": Can not create model","YV2")}}}),e},initTemplate:function(){var e=this,t=e.getTpl();return document.createElement("div"),t instanceof n.view.Template||(t instanceof Array||"array"==typeof t||"string"==typeof t||t instanceof String?t=n.$factory({module:"ya",alias:"view.Template",tpl:t}):(t instanceof Object||"object"==typeof t)&&(t.alias||(t.module="ya",t.alias="view.Template"),t=n.$factory(t))),e.setTpl(t),e},initParent:function(){var e=this,t=e.getParent();t&&t.getChildren().push(e)},setModel:function(e){var t=this,r=t.getModels();return e instanceof n.Model||(e.alias||(e.module="ya",e.alias="Model"),e=n.$factory(e)),t.hasModel(e.getNamespace())||(r.push(e),t.setModels(r)),t},hasModel:function(e){var t,n=this.getModels();for(t=n.length;t--;)if(n[t].getNamespace()===e)return!0;return!1},getModel:function(e){var t,n=this,r=n.getModels(),i=null;for(t=r.length;t--;)if(r[t].getNamespace()===e){i=r[t];break}return i},setCollection:function(e){var t=this,r=t.getCollections();return e instanceof n.Collection||(e.alias||(e.module="ya",e.alias="Model"),e=n.$factory(e)),t.hasCollection(e.getId())||(r.push(e),t.setCollections(r)),t},hasCollection:function(e){var t,n=this.getCollections();for(t=n.length;t--;)if(n[t].getId()===e)return!0;return!1},getCollection:function(e){var t,n=this,r=n.getCollections(),i=null;for(t=r.length;t--;)if(r[t].getNamespace()===e){i=r[t];break}return r},render:function(){var e,t,n,r=this,i=r._config,a=i.parent,s=i.renderTo;return e=s instanceof HTMLElement?s:r.getParentEl(s,!0),r.isInDOM()&&r.clear(),t=r.getTpl().getTDOMInstance(r),n=t.getEDOM(),r.set("tdom",t),r.set("el",n),r.getHidden()&&r.hide(),e&&(e.appendChild(n),a&&0>a.findChild(r.getId())&&a.getChildren().push(r),r.set("isInDOM",!0),r.reAppendChildren(),r.fireEvent("render",r,a)),n},clear:function(){var e=this;return e.removeFromDOM(),e._tdom.clear(),e.set("el",null),e},querySelector:function(e){return this.get("el").querySelector(e)||(this.isQueryMatch(e)?this.get("el"):null)},querySelectorAll:function(e){var t=i.call(this.get("el").querySelectorAll(e)||[],0);return this.isQueryMatch(e)&&t.push(this.get("el")),t},addChild:function(e,t){var r=this;return e.appendTo(r,t),r.isInDOM()&&n.event.$dispatcher.apply(e),r.fireEvent("childAdded",r,e),r},getChild:function(e){var t=this;return 0>t.findChild(e)?!1:t.findChild(e)},findChild:function(e){for(var t=this.getChildren(),n=t.length;n--&&t[n].getId()!==e;);return n},removeChild:function(e){for(var t=this.getChildren(),n=t.length,r=[];n--;)t[n].getId()===e.getId()&&(r=t.splice(n,1),r[0].removeFromDOM());return r[0]||null},removeChildren:function(){for(var e=this.getChildren(),t=e.length,n=[];t--;)n.push(e[t].removeFromDOM());return n},removeFromDOM:function(){var e=this,t=e._el;return e.isInDOM()&&(t.parentNode.removeChild(t),e.set("isInDOM",!1)),e},isInDOM:function(){return this._isInDOM},getParentEl:function(e,t){var n,r=this,i=r._config.parent;return r.isElement(e)?n=e:i?n=e?i._el.querySelector(e):i._el:t&&(n=document.querySelector(e)),n},appendTo:function(e,t){var n,r=this,i=r._config,a=r.getId(),s=e.getChildren(),o=i.parent;return t=t||i.renderTo,n=t instanceof HTMLElement?t:r.getParentEl(t,!1),i.renderTo=n,o?o&&o.getId()!==e.getId()&&(o.findChild(a)>-1&&o.getChildren().splice(o.findChild(a),1),s.push(r)):(i.parent=e,s.push(r)),i.parent=e,!r.isInDOM()&&e.isInDOM()&&(r._el?(n.appendChild(r._el),r.set("isInDOM",!0),r.reAppendChildren(),r.fireEvent("render",r,e)):r.render()),r.fireEvent("append",r,e),r},reAppendChildren:function(){for(var e=this.getChildren(),t=e.length,n=0;t>n;n++)e[n].appendTo(this);return this},show:function(){var e=this;return e._el?(e._el.classList.remove("hidden"),e.set("visible",!0),e.fireEvent("show",e),e):e},hide:function(){var e=this;return e._el?(e._el.classList.add("hidden"),e.set("visible",!1),e.fireEvent("hide",e),e):e},toggle:function(){var e=this;e._visible?e.hide():e.show()},isVisible:function(){return this.get("visible")&&this.isInDOM()}})}(),ya.Core.$extend({module:"ya",alias:"view.TDOM",defaults:{view:null,DOM:null,bindings:null},mixins:[ya.mixins.Array],init:function(e){var t=this;return t.__super(e).initTDOM(),t},initRequired:function(){var e=this;if(!e.getView())throw ya.Error.$create("ya.view.TDOM requires view object","T2DOM1");if(!e.getDOM())throw ya.Error.$create("ya.view.TDOM requires DOM cloned from template","T2DOM2");if(!e.getBindings())throw ya.Error.$create("ya.view.TDOM requires bindings cloned from template","T2DOM3");return e},initTDOM:function(){var e,t,n,r=this,i=r.getView(),a=r.getBindings(),s=r.getDOM(),o=ya.view.Template.$BindingType;return r.each(a,function(a){switch(a.type){case o.ATTR:a.pointer=s.querySelector('[ya-id="'+a.pointer+'"]').attributes.getNamedItem(a.name),r.each(a.headers,function(s){e=s[0],l=i.getModel(e),l&&(a.models[e]=l,t=function(e){return function(){r.updateAttr(e)}}(a),n="data"+s[1].charAt(0).toUpperCase()+s[1].slice(1)+"Change",a.callbacks.push({namespace:l.getNamespace(),event:n,callback:t}),l.addEventListener(n,t),r.updateAttr(a))}),delete a.name;break;case o.TEXT:var l;a.pointer=s.querySelector('[ya-id="'+a.pointer+'"]'),r.each(a.headers,function(s){e=s[0],l=i.getModel(e),l&&(a.models[e]=l,t=function(e){return function(){r.updateTxt(e)}}(a),n="data"+s[1].charAt(0).toUpperCase()+s[1].slice(1)+"Change",a.callbacks.push({namespace:l.getNamespace(),event:n,callback:t}),l.addEventListener(n,t),r.updateTxt(a))});break;case o.COL:var u,c,d;a.pointer=s.querySelector('[ya-id="'+a.pointer+'"]'),u=a.collection,u.id?u.pointer=ya.collection.$Manager.getItem(u.id):(c=i.getCollections(),r.some(c,u.namespace?function(e){return e.getNamespace()===u.namespace?(u.pointer=e,!0):void 0}:function(e){return e.__class__===u.class?(u.pointer=e,!0):void 0})),u.pointer||(d=u.class.split("."),u.pointer=ya.$factory({module:d.shift(),alias:d.join("."),id:u.id}),i.setCollection(u.pointer)),r.setupCollection(a);break;default:a.pointer=s.querySelector('[ya-id="'+a.pointer+'"]')}}),r.setDOM(s),r.setBindings(a),r},setupCollection:function(e){var t,n,r=this,i=e.collection,a=i.pointer;t=function(e){return function(){r.updateCollection(e)}}(e),n=function(e){return function(t,n){r.removeFromCollection(e,n)}}(e),e.collection.connections=[],a.each(function(t){r.generateView(e,t)}),r.updateCollection(e),a.addEventListener("prepare",t,r),a.addEventListener("filter",t,r),a.addEventListener("sort",t,r),a.addEventListener("push",t,r),a.addEventListener("remove",n,r)},generateView:function(e,t){var n,r=this,i=e.collection,a=ya.view.template.$Manager.getItem(i.tpl);return n=ya.$factory({alias:i.view,renderTo:e.pointer,tpl:a||void 0,models:[t]}),r.getView().addChild(n,e.pointer),i.connections.push({view:n,model:t}),r},updateCollection:function(e){var t,n,r,i,a=this,s=Array.prototype.indexOf,o=ya.mixins.Array.find,l=e.collection.pointer,u=e.pointer,c=u.childNodes,d=e.collection.connections;for(l.each(function(t,l){r=o(d,"model._clientId",t._clientId),r>=0?(n=d[r],a.getView().isInDOM()&&(i=s.call(c,n.view._el),i>-1&&i!==l&&(c.length-1>l?u.insertBefore(c[l],c[i]):u.appendChild(c[i])))):a.generateView(e,t)}),t=d.length;t--;)n=d[t],r=o(l._set,"_clientId",n.model._clientId),0>r&&(d.splice(t,1).pop(),n.view.clear());return a},removeFromCollection:function(e,t){var n,r,i,a,s=this,o=ya.mixins.Array.find;for(n=e.collection.connections;t.length;)a=t.pop(),r=o(n,"model._clientId",a._clientId),i=n[r],n.splice(r,1).pop(),i.view.clear(),i.view=null;return s},updateTxt:function(e){var t,n=this,r=e.original;n.each(e.headers,function(n){t=e.models[n[0]].data(n[1]),t===void 0&&(t=""),r=r.replace("{{"+n.join(".")+"}}",t)}),e.pointer.innerHTML=r},updateAttr:function(e){var t,n=this,r=e.original;n.each(e.headers,function(n){t=e.models[n[0]].data(n[1]),t===void 0&&(t=""),r=r.replace("{{"+n.join(".")+"}}",t)}),e.pointer.value=r},clear:function(){var e,t,n=ya.mixins.Array.each,r=this,i=r.getBindings();return n(i,function(r){t=r.callbacks,t&&n(r.callbacks,function(t){e=r.models[t.namespace],e.removeEventListener(t.event,t.callback)}),r.pointer=null,r.callbacks.length=0,r.models=null}),i.length=0,r},getEDOM:function(){var e,t,n=this,r=n.getDOM();if(r.childNodes.length>1||3===r.firstChild.nodeType){for(e=document.createElement("div");r.childNodes.length;)e.appendChild(r.firstChild);e.setAttribute("class","ya inline"),r.appendChild(e)}return t=r.firstChild,t.setAttribute("id",n.getView().getId()),t}}),ya.Core.$extend({module:"ya",alias:"view.Template","static":{id:0,DOM4:function(){return!document.createAttribute("rel")instanceof Node},BindingType:{CSS:5,VIEW:4,TEXT:3,ATTR:2,COL:1}},mixins:[ya.mixins.Array],defaults:{id:null,tpl:null,tDOM:null},init:function(e){var t=this;t.__super(e).initRegister().initBindings()},initRequired:function(){var e=this;if(!e.getTpl())throw ya.Error.$create("ya.view.Template: Missing tpl property in configuration object","YVT1");if(!e._html.hasChildNodes())throw ya.Error.$create(e.__class__+": Its seems that object doesnt contain any template","YVT2");return e},initDefaults:function(){var e=this,t=e.getTpl(),n=document.createDocumentFragment();if(e.setId(e.getId()||"template-"+ya.view.template.$Manager.getCount()),e.setTDOM(e.getTDOM()||ya.view.TDOM),Array.isArray(t)&&(t=t.join("")),"string"==typeof t||t instanceof String){var r=document.createElement("div");for(r.innerHTML=t;r.hasChildNodes();)n.appendChild(r.firstChild)}else t instanceof DocumentFragment?n=t:t instanceof HTMLElement&&n.appendChild(t.firstChild);return e.set("html",n),e},initRegister:function(){var e=this;return ya.view.template.$Manager.register(e.getId(),e),e},initBindings:function(){var e,t,n=this;return t=n.findAttrsBindings(),e=n.findTextBindings(),n.set("bindings",t.concat(e)),n},findAttrsBindings:function(){var e,t,n,r,i,a=this,s=[],o=[],l=/^ya-(.*)/i,u=[],c=Array.prototype.slice;for(t=document.createTreeWalker(a._html,NodeFilter.SHOW_ELEMENT,null,!1);t.nextNode();)i=t.currentNode,u=c.call(i.attributes),a.isTemplate(i)||(ya.view.Template.$DOM4&&a.each(u,function(e){e.ownerElement=i}),s=s.concat(u));for(;s.length;){switch(r=s.pop(),n=r.nodeName.match(l),n&&n[1]){case"collection":e=a.prepareColBindings(r);break;case"view":e=a.prepareViewBindings(r);break;case"css":e=a.prepareCSSBindings(r);break;default:e=a.prepareAttrBindings(r)}e&&o.push(e)}return o},isTemplate:function(e){for(e=e.parentNode;e.parentNode;){if(e.attributes.getNamedItem("ya-view")||e.attributes.getNamedItem("ya-collection"))return!0;e=e.parentNode}return!1},findTextBindings:function(){var e,t,n=this,r=[];for(t=document.createTreeWalker(n._html,NodeFilter.SHOW_TEXT,null,!1);t.nextNode();)e=n.prepareTextBindings(t.currentNode),e&&r.push(e);return n.each(r,function(e){e.old.parentNode.replaceChild(e.doc,e.old),delete e.doc,delete e.old}),r},prepareTextBindings:function(e){var t,n,r,i,a=e.data.match(/\{\{(.*?)\}\}/gi),s=!1;if(a){var o=document.createElement("span"),l=ya.view.Template.$id++;for(o.setAttribute("ya-id",l),t=0,n=a.length,r=[];n>t;)result=a[t++],i=result.substr(2,result.length-4).split("."),r.push(i);s={original:e.value||e.data,old:e,doc:o,models:{},callbacks:[],headers:r,type:3,pointer:l}}return s},prepareColBindings:function(e){var t,n=e.value.match(/(?:class|id|namespace|model|view)[?!:]([\S]+)/gi),r=e.ownerElement,i=r.getAttribute("ya-id")||ya.view.Template.$id++,a={view:"ya.View","class":"ya.Collection"},s={pointer:i,type:ya.view.Template.$BindingType.COL,collection:a},o=ya.mixins.DOM;for(r.setAttribute("ya-id",i);n&&n.length;)t=n.pop().split(":"),a[t[0]]=t[1];if(r.hasChildNodes()){var l=ya.$factory({module:"ya",alias:"view.Template",tpl:o.removeChildren(r)});a.tpl=l.getId()}return s},prepareViewBindings:function(e){var t,n=e.ownerElement,r=(n.getAttribute("ya-view")||"ya.View",n.getAttribute("ya-id")||ya.view.Template.$id++),i=e.value.match(/(?:class|id)[?!:]([\w\.]+)/gi),a={pointer:r,type:ya.view.Template.$BindingType.VIEW,view:{"class":"ya.View"}};for(n.setAttribute("ya-id",r);i&&i.length;)t=i.pop().split(":"),a.view[t[0]]=t[1];return a},prepareCSSBindings:function(e){var t,n,r,i,a=e.ownerElement,s=e.value&&e.value.match(/\{\{(.*?)\}\}/gi),o=s&&s.length,l=[],u=0;if(i=a.getAttribute("ya-id"),i||(i=ya.view.Template.$id++,a.setAttribute("ya-id",i)),s)for(;o>u;)result=s[u++],r=result.substr(2,result.length-4).split("."),l.push(r);return t=(a.getAttribute("style")||"")+e.value,a.setAttribute("style",t),n={original:t,fillAttr:!1,headers:l,callbacks:[],models:{},name:"style",type:ya.view.Template.$BindingType.ATTR,pointer:i}},prepareAttrBindings:function(e){var t,n,r,i=e.ownerElement,a=e.value&&e.value.match(/\{\{(.*?)\}\}/gi),s=a&&a.length,o=e.value,l=[],u=0;if(a){for(n=i.getAttribute("ya-id"),n||(n=ya.view.Template.$id++,i.setAttribute("ya-id",n));s>u;)result=a[u++],r=result.substr(2,result.length-4).split("."),l.push(r);t={fillAttr:ya.mixins.CSSStyle.isFillAttr(e.name),name:e.name,original:o,models:{},callbacks:[],headers:l,type:ya.view.Template.$BindingType.ATTR,pointer:n}}return a?t:null},getTDOMInstance:function(e){var t=this;return t.getTDOM().$create({config:{view:e,bindings:ya.$clone(t.get("bindings")),DOM:t.get("html").cloneNode(!0)}})}});
//@ sourceMappingURL=yam-v0.2.0.min.js.map